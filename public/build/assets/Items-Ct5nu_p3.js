var O=Object.defineProperty;var Y=(l,s,o)=>s in l?O(l,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[s]=o;var T=(l,s,o)=>Y(l,typeof s!="symbol"?s+"":s,o);import{j as r}from"./AboutHeader-COUW3Uy_.js";import{B as J}from"./Base-B8RZsO4B.js";import{S as m}from"./SwitchFormGroup-BW0W_xEc.js";import{T as K}from"./TextareaFormGroup-BkL9I0bq.js";import{r as n}from"./index-CqkZ-sT_.js";import{c as U}from"./ReactAppend-CtUeIECI.js";import{r as C}from"./DxBox-cK5nOGfM.js";import{S as W}from"./ProductCard-DppMoL6U.js";import{B as X}from"./BasicEditing-BqNQNO7h.js";import{M as Z}from"./Modal-BdGNjleW.js";import{T as ee}from"./Table-CZMIa64L.js";import{I as G}from"./ImageFormGroup-BVKbb_oP.js";import{I as S}from"./InputFormGroup-DSD8AIIl.js";import{Q as re}from"./QuillFormGroup-CqyXyHxb.js";import{S as E}from"./SelectAPIFormGroup-PC6zqttv.js";import{S as P}from"./SelectFormGroup-CHmG_gm0.js";import{R as a,D as _}from"./ReactAppend-BWfdd_H3.js";import{C as te}from"./CreateReactScript-z1QqBgjC.js";import{N as A}from"./Number2Currency-e57Tgsuk.js";import{S as M}from"./SetSelectValue-UxyCmHse.js";import"./Global-FUJSZKZw.js";import"./tippy-react.esm-HYwDmlWP.js";import"./index-VLFqsz8m.js";/* empty css              */import"./main-CkMzf7wF.js";import"./___vite-browser-external_commonjs-proxy-DA7w84js.js";import"./MenuItemContainer-CwCVbbio.js";import"./index.esm-D3ific_m.js";/* empty css               */import"./General-BmbBKdsB.js";class ie extends X{constructor(){super(...arguments);T(this,"path","admin/items");T(this,"hasFiles",!0)}}const u=new ie,ne=({categories:l,brands:s})=>{const o=n.useRef(),g=n.useRef(),h=n.useRef(),x=n.useRef(),b=n.useRef(),j=n.useRef(),R=n.useRef(),v=n.useRef(),y=n.useRef(),w=n.useRef(),F=n.useRef(),p=n.useRef(),d=n.useRef(),N=n.useRef(),[q,k]=n.useState(!1),[V,Q]=n.useState(null),D=e=>{var t,i;e!=null&&e.id?k(!0):k(!1),h.current.value=(e==null?void 0:e.id)||"",$(x.current).val((e==null?void 0:e.category_id)||null).trigger("change"),M(b.current,(t=e==null?void 0:e.subcategory)==null?void 0:t.id,(i=e==null?void 0:e.subcategory)==null?void 0:i.name),$(j.current).val((e==null?void 0:e.brand_id)||null).trigger("change"),R.current.value=(e==null?void 0:e.name)||"",v.current.value=(e==null?void 0:e.summary)||"",y.current.value=(e==null?void 0:e.price)||0,w.current.value=(e==null?void 0:e.discount)||0,M(F.current,(e==null?void 0:e.tags)??[],"id","name"),p.current.value=null,d.current.value=null,p.image.src=`/api/items/media/${(e==null?void 0:e.banner)??"undefined"}`,d.image.src=`/api/items/media/${(e==null?void 0:e.image)??"undefined"}`,N.editor.root.innerHTML=(e==null?void 0:e.description)??"",$(g.current).modal("show")},z=async e=>{e.preventDefault();const t={id:h.current.value||void 0,category_id:x.current.value,subcategory_id:b.current.value,brand_id:j.current.value,name:R.current.value,summary:v.current.value,price:y.current.value,discount:w.current.value,tags:$(F.current).val(),description:N.current.value},i=new FormData;for(const B in t)i.append(B,t[B]);const c=d.current.files[0];c&&i.append("image",c);const I=p.current.files[0];I&&i.append("banner",I),await u.save(i)&&($(o.current).dxDataGrid("instance").refresh(),$(g.current).modal("hide"))},H=async({id:e,value:t})=>{await u.boolean({id:e,field:"visible",value:t})&&$(o.current).dxDataGrid("instance").refresh()},f=async({id:e,field:t,value:i})=>{await u.boolean({id:e,field:t,value:i})&&$(o.current).dxDataGrid("instance").refresh()},L=async e=>{const{isConfirmed:t}=await W.fire({title:"Eliminar curso",text:"¿Estás seguro de eliminar este curso?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await u.delete(e)||$(o.current).dxDataGrid("instance").refresh()};return r.jsxs(r.Fragment,{children:[r.jsx(ee,{gridRef:o,title:"Items",rest:u,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(o.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo curso",hint:"Nuevo curso",onClick:()=>D()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:t})=>{var i,c;e.html(C(r.jsxs(r.Fragment,{children:[r.jsx("b",{className:"d-block",children:(i=t.category)==null?void 0:i.name}),r.jsx("small",{className:"text-muted",children:(c=t.subcategory)==null?void 0:c.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",width:"300px",cellTemplate:(e,{data:t})=>{e.html(C(r.jsxs(r.Fragment,{children:[r.jsx("b",{children:t.name}),r.jsx("br",{}),r.jsx("span",{className:"truncate",children:t.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:t})=>{e.html(C(r.jsxs(r.Fragment,{children:[t.discount>0&&r.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",A(t.price)]}),r.jsxs("span",{children:["S/.",A(t.discount>0?t.discount:t.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{a(e,r.jsx("img",{src:`/api/items/media/${t.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:i=>i.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{a(e,r.jsx(m,{checked:t.is_new,onChange:i=>f({id:t.id,field:"is_new",value:i.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{a(e,r.jsx(m,{checked:t.offering,onChange:i=>f({id:t.id,field:"offering",value:i.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{a(e,r.jsx(m,{checked:t.recommended,onChange:i=>f({id:t.id,field:"recommended",value:i.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{a(e,r.jsx(m,{checked:t.featured,onChange:i=>f({id:t.id,field:"featured",value:i.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{a(e,r.jsx(m,{checked:t.visible,onChange:i=>H({id:t.id,value:i.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(_({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>D(t)})),e.append(_({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>L(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(Z,{modalRef:g,title:q?"Editar curso":"Agregar curso",onSubmit:z,size:"lg",children:[r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:h,type:"hidden"}),r.jsxs("div",{className:"col-md-6",children:[r.jsx(P,{eRef:x,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>Q(e.target.value),children:l.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(E,{eRef:b,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",V],dropdownParent:"#principal-container"}),r.jsx(P,{eRef:j,label:"Marca",required:!0,dropdownParent:"#principal-container",children:s.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(S,{eRef:R,label:"Nombre",required:!0}),r.jsx(K,{eRef:v,label:"Resumen",rows:3,required:!0}),r.jsxs("div",{className:"row",children:[r.jsx(S,{eRef:y,label:"Precio",type:"number",col:"col-sm-6",step:"0.01",required:!0}),r.jsx(S,{eRef:w,label:"Descuento",type:"number",col:"col-sm-6",step:"0.01"})]}),r.jsx(E,{id:"tags",eRef:F,searchAPI:"/api/admin/tags/paginate",searchBy:"name",label:"Tags",dropdownParent:"#principal-container",tags:!0,multiple:!0})]}),r.jsx("div",{className:"col-md-6",children:r.jsxs("div",{className:"row",children:[r.jsx(G,{eRef:p,label:"Banner",aspect:2/1,col:"col-12"}),r.jsx(G,{eRef:d,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[r.jsx("input",{id:"input-item-gallery",type:"file",multiple:!0,accept:"image/",hidden:!0}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("span",{className:"form-label d-block mb-1",htmlFor:"input-item-gallery",children:"Galería"}),r.jsxs("button",{className:"btn btn-white rounded-pill btn-xs",style:{position:"absolute",top:"50%",transform:"translateY(-50%)",right:0},children:[r.jsx("i",{className:"mdi mdi-plus"}),"Agregar"]})]}),r.jsx("div",{className:"w-100 bg-primary",style:{aspectRatio:1}})]})]})})]}),r.jsx("hr",{className:"my-1"}),r.jsx(re,{eRef:N,label:"Descripcion"})]})]})};te((l,s)=>{U(l).render(r.jsx(J,{...s,title:"Items",children:r.jsx(ne,{...s})}))});
