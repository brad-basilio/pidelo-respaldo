import{j as s}from"./AboutSimple-Cf8x2fCZ.js";import{E as he,a as ye,U as be,R as ve,I as ie,T as te,S as Q,Z as je,i as we,h as Ne,g as Ce,f as ke,e as Ee,d as Se,c as $e,C as Pe,k as re,F as Me,b as De,j as oe,l as Re,m as ae,n as le,u as ze,D as Te,H as Ie}from"./index-DaTkk6Oy.js";import{r as h}from"./index-BH53Isel.js";import{C as Ae}from"./chevron-left-B2s3ZsB7.js";import{c as ne}from"./createLucideIcon-Cy5Ya80P.js";import{H as Le}from"./heart-ChuvJi-4.js";import{L as Ve,P as Fe}from"./palette-Bnj905Cx.js";import{T as q}from"./trash-2-DK1wnsDn.js";import{U as He}from"./upload-qgEr5bIl.js";import{P as Be}from"./plus-Bot15Khs.js";import{h as Oe,F as Xe}from"./EditorLayout-BnWGqD7B.js";import"./index-yBjzXJbu.js";import"./index-BSWw-p5k.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=ne("Blend",[["circle",{cx:"9",cy:"9",r:"7",key:"p2h5vp"}],["circle",{cx:"15",cy:"15",r:"7",key:"19ennj"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=ne("SlidersVertical",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=ne("Triangle",[["path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"14u9p9"}]]);function N({children:e,onClick:a,className:n="",variant:t="default",size:o="default",disabled:r=!1,icon:l=null}){const i="inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background",u={default:"bg-purple-600 text-white hover:bg-purple-700",outline:"border border-input hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",secondary:"bg-gray-100 text-gray-800 hover:bg-gray-200"},c={default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md text-sm",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10","icon-sm":"h-8 w-8"};return s.jsxs("button",{className:`${i} ${u[t]} ${c[o]} ${n} gap-2`,onClick:a,disabled:r,children:[l&&s.jsx("span",{className:"w-4 h-4",children:l}),e]})}function We({onExport:e,onPreviewToggle:a,previewMode:n}){return s.jsxs("header",{className:"border-b bg-white p-4 flex items-center justify-between shadow-sm",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs(N,{variant:"ghost",size:"sm",children:[s.jsx(Ae,{className:"h-5 w-5 mr-1"}),"Regresar"]})}),s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Editor de Fotos Profesional"}),s.jsx("h2",{className:"text-lg text-gray-600",children:"Crea collages y diseños impresionantes"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(N,{variant:"secondary",onClick:a,icon:s.jsx(he,{className:"h-4 w-4"}),children:n?"Editar":"Vista previa"}),s.jsx(N,{className:"bg-purple-600 hover:bg-purple-700",icon:s.jsx(ye,{className:"h-4 w-4"}),onClick:e,children:"Exportar"})]})]})}function _e({onUndo:e,onRedo:a,onAddImage:n,onAddText:t,onDeleteElement:o,canUndo:r,canRedo:l,hasSelectedElement:i}){return s.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 flex items-center gap-4",children:[s.jsx(N,{variant:"ghost",size:"icon",onClick:e,disabled:!r,children:s.jsx(be,{className:"h-5 w-5"})}),s.jsx(N,{variant:"ghost",size:"icon",onClick:a,disabled:!l,children:s.jsx(ve,{className:"h-5 w-5"})}),s.jsx("div",{className:"h-6 border-l"}),s.jsx(N,{variant:"ghost",size:"icon",onClick:n,children:s.jsx(ie,{className:"h-5 w-5"})}),s.jsx(N,{variant:"ghost",size:"icon",onClick:t,children:s.jsx(te,{className:"h-5 w-5"})}),s.jsx("div",{className:"h-6 border-l"}),s.jsx(N,{variant:"ghost",size:"icon",onClick:o,disabled:!i,children:s.jsx(q,{className:"h-5 w-5"})})]})}const B=[{id:"layout-1",name:"Cuatro fotos",template:"grid-cols-2 grid-rows-2 gap-4",cells:4,maskCategories:[{name:"Básicas",masks:["none","circle","rounded","square","rounded-sm","rounded-lg","rounded-full","rounded-rect"]},{name:"Formas",masks:["heart","star","hexagon","triangle","diamond","badge","speech","burst"]},{name:"Fotográficos",masks:["polaroid","vintage","frame","wave","diagonal","bevel","poster","inner-frame"]},{name:"Creativas",masks:["leaf","cloud","flower","ornate","blob1","blob2","blob3"]}]}];function Ue({selectedLayout:e,onSelect:a}){return s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium mb-2",children:"Layouts"}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:B.map(n=>s.jsxs("div",{className:`border rounded-md p-1 cursor-pointer hover:border-purple-500 ${e===n.id?"border-purple-500 ring-1 ring-purple-200":""}`,onClick:()=>a(n.id),children:[s.jsx("div",{className:`grid ${n.template} gap-1 h-20`,children:Array.from({length:n.cells}).map((t,o)=>s.jsx("div",{className:"bg-gray-100 rounded-sm flex items-center justify-center",children:s.jsx("span",{className:"text-xs text-gray-400",children:o+1})},o))}),s.jsx("p",{className:"text-xs text-center mt-1 truncate",children:n.name})]},n.id))})]})}function Ge({onAddImage:e,onAddText:a}){const n=()=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=o=>{o.target.files&&o.target.files[0]&&e(o.target.files[0])},t.click()};return s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium mb-2",children:"Añadir"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(N,{variant:"outline",size:"sm",icon:s.jsx(ie,{className:"h-4 w-4"}),onClick:n,children:"Imagen"}),s.jsx(N,{variant:"outline",size:"sm",icon:s.jsx(te,{className:"h-4 w-4"}),onClick:a,children:"Texto"})]})]})}function ce({tabs:e,activeTab:a,onChange:n}){return s.jsx("div",{className:"flex border-b pb-4",children:e.map(t=>s.jsx("button",{className:`flex-1 py-2 text-sm font-medium ${a===t.id?"text-purple-600 border-b-2 border-purple-600":"text-gray-600 hover:text-gray-900"}`,onClick:()=>n(t.id),children:t.label},t.id))})}function T({value:e=[50],min:a=0,max:n=100,step:t=1,onValueChange:o,label:r,unit:l="%"}){const[i,u]=h.useState(e[0]),c=f=>{const d=Number.parseInt(f.target.value);u(d),o&&o([d])};return s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r}),s.jsxs("span",{className:"text-sm text-gray-500",children:[i,l]})]}),s.jsx("div",{className:"relative flex w-full touch-none select-none items-center",children:s.jsx("input",{type:"range",min:a,max:n,step:t,value:i,onChange:c,className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600"})})]})}const se=[{id:"none",name:"Sin máscara",class:"",category:"Básicas",icon:"square"},{id:"circle",name:"Círculo",class:"rounded-full",category:"Básicas",icon:"circle"},{id:"rounded",name:"Redondeado",class:"rounded-xl",category:"Básicas",icon:"square-rounded"},{id:"square",name:"Cuadrado",class:"",category:"Básicas",icon:"square"},{id:"heart",name:"Corazón",class:"mask-heart",category:"Formas",icon:"heart"},{id:"star",name:"Estrella",class:"mask-star-2",category:"Formas",icon:"star"},{id:"hexagon",name:"Hexágono",class:"mask-hexagon",category:"Formas",icon:"hexagon"},{id:"triangle",name:"Triángulo",class:"mask-triangle",category:"Formas",icon:"triangle"},{id:"diamond",name:"Diamante",class:"mask-diamond",category:"Formas",icon:"diamond"},{id:"polaroid",name:"Polaroid",class:"mask-polaroid",category:"Fotográficos",icon:"film"},{id:"vintage",name:"Vintage",class:"mask-vintage",category:"Fotográficos",icon:"feather"},{id:"wave",name:"Onda",class:"mask-wave",category:"Fotográficos",icon:"zap"},{id:"leaf",name:"Hoja",class:"mask-leaf",category:"Creativas",icon:"leaf"},{id:"cloud",name:"Nube",class:"mask-cloud",category:"Creativas",icon:"cloud"},{id:"flower",name:"Flor",class:"mask-flower",category:"Creativas",icon:"flower"}],Ze=({name:e,className:a=""})=>{const t={square:Q,circle:Pe,heart:Le,star:$e,hexagon:Se,triangle:Je,diamond:Ee,film:ke,feather:Ce,cloud:Ne,flower:we,zap:je,"square-rounded":Q}[e]||Q;return s.jsx(t,{className:`${a} ${e==="square-rounded"?"rounded-md":""}`})};function Ke({selectedMask:e,onSelect:a,availableMasks:n=[]}){var l;const[t,o]=h.useState("Básicas"),r={};return se.forEach(i=>{r[i.category]||(r[i.category]=[]),(n.includes(i.id)||i.id==="none")&&r[i.category].push(i)}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium",children:"Máscaras de imagen"}),s.jsx("div",{className:"flex overflow-x-auto pb-2",children:Object.keys(r).map(i=>r[i].length>0&&s.jsx("button",{className:`px-3 py-1 text-sm whitespace-nowrap ${t===i?"border-b-2 border-purple-500 font-medium text-purple-600":"text-gray-600 hover:text-gray-900"}`,onClick:()=>o(i),children:i},i))}),s.jsx("div",{className:"grid grid-cols-3 gap-3",children:(l=r[t])==null?void 0:l.map(i=>s.jsxs("div",{className:`border rounded-md p-2 cursor-pointer hover:border-purple-500 transition-colors ${e===i.id?"border-purple-500 ring-2 ring-purple-200":""}`,onClick:()=>a(i.id),children:[s.jsx("div",{className:"aspect-square bg-gray-100 rounded-md flex items-center justify-center mb-2",children:s.jsx("div",{className:`w-16 h-16 bg-purple-300 ${i.class} flex items-center justify-center`,children:s.jsx(Ze,{name:i.icon,className:"h-8 w-8 text-purple-600"})})}),s.jsx("p",{className:"text-center text-sm",children:i.name})]},i.id))})]})}const Qe=[{name:"Normal",filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0}},{name:"Vintage",filters:{brightness:90,contrast:110,saturation:80,tint:20,hue:10,blur:1}},{name:"Blanco y negro",filters:{brightness:100,contrast:120,saturation:0,tint:0,hue:0,blur:0}},{name:"Brillante",filters:{brightness:120,contrast:90,saturation:120,tint:0,hue:0,blur:0}},{name:"Oscuro",filters:{brightness:80,contrast:120,saturation:90,tint:10,hue:0,blur:1}},{name:"Sepia",filters:{brightness:90,contrast:100,saturation:50,tint:80,hue:0,blur:0}},{name:"Cálido",filters:{brightness:100,contrast:100,saturation:110,tint:15,hue:20,blur:0}},{name:"Frío",filters:{brightness:100,contrast:100,saturation:110,tint:0,hue:200,blur:0}}],es=[{value:"normal",label:"Normal"},{value:"multiply",label:"Multiplicar"},{value:"screen",label:"Pantalla"},{value:"overlay",label:"Superponer"},{value:"darken",label:"Oscurecer"},{value:"lighten",label:"Aclarar"},{value:"color-dodge",label:"Sobreexposición de color"},{value:"color-burn",label:"Subexposición de color"},{value:"hard-light",label:"Luz fuerte"},{value:"soft-light",label:"Luz suave"},{value:"difference",label:"Diferencia"},{value:"exclusion",label:"Exclusión"},{value:"hue",label:"Tono"},{value:"saturation",label:"Saturación"},{value:"color",label:"Color"},{value:"luminosity",label:"Luminosidad"}];function ss({element:e,filterTab:a,onFilterTabChange:n,onFilterChange:t,availableMasks:o=[]}){var l,i,u,c,f,d,x,p,m,y,j,k;const r=g=>{t({filters:{...e.filters,...g}})};return s.jsxs("div",{className:"space-y-6",children:[s.jsx(ce,{tabs:[{id:"basic",label:"Básicos",icon:s.jsx(qe,{size:16})},{id:"transform",label:"Transformar",icon:s.jsx(re,{size:16})},{id:"advanced",label:"Avanzados",icon:s.jsx(Ve,{size:16})}],activeTab:a,onChange:n}),a==="basic"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[s.jsx(Fe,{className:"h-4 w-4"}),"Filtros predefinidos"]}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:Qe.map(g=>s.jsx(N,{variant:"outline",size:"sm",onClick:()=>r(g.filters),children:g.name},g.name))})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium",children:"Ajustes básicos"}),s.jsx(T,{label:"Brillo",value:[((l=e.filters)==null?void 0:l.brightness)||100],min:0,max:200,onValueChange:g=>t({filters:{...e.filters,brightness:g[0]}})}),s.jsx(T,{label:"Contraste",value:[((i=e.filters)==null?void 0:i.contrast)||100],min:0,max:200,onValueChange:g=>t({filters:{...e.filters,contrast:g[0]}})}),s.jsx(T,{label:"Saturación",value:[((u=e.filters)==null?void 0:u.saturation)||100],min:0,max:200,onValueChange:g=>t({filters:{...e.filters,saturation:g[0]}})}),s.jsx(T,{label:"Tono",value:[((c=e.filters)==null?void 0:c.hue)||0],min:0,max:360,unit:"°",onValueChange:g=>t({filters:{...e.filters,hue:g[0]}})}),s.jsx(T,{label:"Sepia",value:[((f=e.filters)==null?void 0:f.tint)||0],min:0,max:100,onValueChange:g=>t({filters:{...e.filters,tint:g[0]}})}),s.jsx(T,{label:"Desenfoque",value:[((d=e.filters)==null?void 0:d.blur)||0],min:0,max:20,unit:"px",onValueChange:g=>t({filters:{...e.filters,blur:g[0]}})})]})]}),a==="transform"&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium",children:"Transformación"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(N,{variant:(x=e.filters)!=null&&x.flipHorizontal?"secondary":"outline",size:"sm",icon:s.jsx(Me,{className:"h-4 w-4"}),onClick:()=>{var g;return t({filters:{...e.filters,flipHorizontal:!((g=e.filters)!=null&&g.flipHorizontal)}})},children:"Voltear H"}),s.jsx(N,{variant:(p=e.filters)!=null&&p.flipVertical?"secondary":"outline",size:"sm",icon:s.jsx(De,{className:"h-4 w-4"}),onClick:()=>{var g;return t({filters:{...e.filters,flipVertical:!((g=e.filters)!=null&&g.flipVertical)}})},children:"Voltear V"})]}),s.jsx(T,{label:"Rotación",value:[((m=e.filters)==null?void 0:m.rotate)||0],min:0,max:360,unit:"°",onValueChange:g=>t({filters:{...e.filters,rotate:g[0]}})}),s.jsx(T,{label:"Escala",value:[(((y=e.filters)==null?void 0:y.scale)||1)*100],min:10,max:200,onValueChange:g=>t({filters:{...e.filters,scale:g[0]/100}})})]}),a==="advanced"&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[s.jsx(Ye,{className:"h-4 w-4"}),"Ajustes avanzados"]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Modo de mezcla"}),s.jsx("select",{className:"w-full border rounded-md p-2 text-sm",value:((j=e.filters)==null?void 0:j.blendMode)||"normal",onChange:g=>t({filters:{...e.filters,blendMode:g.target.value}}),children:es.map(g=>s.jsx("option",{value:g.value,children:g.label},g.value))})]}),s.jsx(T,{label:"Opacidad",value:[((k=e.filters)==null?void 0:k.opacity)||100],min:0,max:100,onValueChange:g=>t({filters:{...e.filters,opacity:g[0]}})})]}),e.type==="image"&&s.jsx(Ke,{selectedMask:e.mask||"none",onSelect:g=>t({mask:g}),availableMasks:o})]})}function ts({activeTab:e,onTabChange:a,selectedLayout:n,onLayoutChange:t,onAddImage:o,onAddText:r,selectedElement:l,onFilterChange:i,getSelectedElement:u,getCurrentLayout:c}){const[f,d]=h.useState("basic");return s.jsx("aside",{className:"w-64 border-r bg-white p-4 overflow-y-auto shadow-sm",children:s.jsxs("div",{className:"space-y-6",children:[s.jsx(ce,{tabs:[{id:"elements",label:"Elementos"},{id:"filters",label:"Filtros"}],activeTab:e,onChange:a}),e==="elements"?s.jsxs(s.Fragment,{children:[s.jsx(Ue,{selectedLayout:n,onSelect:t}),s.jsx(Ge,{onAddImage:o,onAddText:r})]}):l?s.jsx(ss,{element:u(),filterTab:f,onFilterTabChange:d,onFilterChange:i,availableMasks:c().maskCategories.flatMap(x=>x.masks)}):s.jsx("div",{className:"text-center py-8 text-gray-500",children:"Selecciona un elemento para editar sus filtros"})]})})}function as({page:e,layout:a}){return s.jsx("div",{className:"bg-white p-8 rounded-lg shadow-lg page-preview",children:s.jsx("div",{className:`grid ${a.template} gap-6 aspect-[4/3]`,children:e.cells.map(n=>s.jsx("div",{className:"relative bg-gray-50 rounded-lg overflow-hidden",children:n.elements.map(t=>t.type==="image"?s.jsx(ns,{element:t},t.id):s.jsx(is,{element:t},t.id))},n.id))})})}function ns({element:e}){var n,t,o,r,l,i,u,c,f,d,x,p;const a=imageMasks.find(m=>m.id===e.mask)||imageMasks[0];return s.jsx("div",{className:`absolute ${a.class}`,style:{left:`${e.position.x}px`,top:`${e.position.y}px`,width:"100%",height:"100%"},children:s.jsx("img",{src:e.content,alt:"",className:"w-full h-full object-cover",style:{filter:`
              brightness(${(((n=e.filters)==null?void 0:n.brightness)||100)/100})
              contrast(${(((t=e.filters)==null?void 0:t.contrast)||100)/100})
              saturate(${(((o=e.filters)==null?void 0:o.saturation)||100)/100})
              sepia(${(((r=e.filters)==null?void 0:r.tint)||0)/100})
              hue-rotate(${(((l=e.filters)==null?void 0:l.hue)||0)*3.6}deg)
              blur(${((i=e.filters)==null?void 0:i.blur)||0}px)
            `,transform:`scale(${((u=e.filters)==null?void 0:u.scale)||1}) rotate(${((c=e.filters)==null?void 0:c.rotate)||0}deg) ${(f=e.filters)!=null&&f.flipHorizontal?"scaleX(-1)":""} ${(d=e.filters)!=null&&d.flipVertical?"scaleY(-1)":""}`,mixBlendMode:((x=e.filters)==null?void 0:x.blendMode)||"normal",opacity:(((p=e.filters)==null?void 0:p.opacity)||100)/100}})})}function is({element:e}){var a,n,t,o,r,l,i,u,c,f,d,x;return s.jsx("div",{className:"absolute",style:{left:`${e.position.x}px`,top:`${e.position.y}px`,fontFamily:(a=e.style)==null?void 0:a.fontFamily,fontSize:(n=e.style)==null?void 0:n.fontSize,fontWeight:(t=e.style)==null?void 0:t.fontWeight,fontStyle:(o=e.style)==null?void 0:o.fontStyle,textDecoration:(r=e.style)==null?void 0:r.textDecoration,color:(l=e.style)==null?void 0:l.color,textAlign:(i=e.style)==null?void 0:i.textAlign,backgroundColor:((u=e.style)==null?void 0:u.backgroundColor)||"transparent",padding:((c=e.style)==null?void 0:c.padding)||"8px",borderRadius:((f=e.style)==null?void 0:f.borderRadius)||"0px",border:((d=e.style)==null?void 0:d.border)||"none",opacity:((x=e.style)==null?void 0:x.opacity)||1},children:e.content})}function de({items:e}){const[a,n]=h.useState(null),t=r=>{r.preventDefault(),r.stopPropagation(),n({x:r.clientX,y:r.clientY})},o=()=>{n(null)};return s.jsx("div",{onContextMenu:t,children:a&&s.jsx("div",{className:"fixed bg-white shadow-lg rounded-md z-50 py-1 w-48",style:{left:`${a.x}px`,top:`${a.y}px`},onClick:r=>r.stopPropagation(),children:e.map((r,l)=>s.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{r.action(),o()},children:[r.icon,r.label]},l))})})}function rs({element:e,isSelected:a,onSelect:n,onUpdate:t,onDelete:o,availableMasks:r=[]}){var _,X,Y,A,C,P,M,S,R,L,D,z;const[{isDragging:l},i]=oe(()=>({type:"IMAGE_ELEMENT",item:{id:e.id},collect:b=>({isDragging:!!b.isDragging()})})),u=h.useRef(null),[c,f]=h.useState(!1),[d,x]=h.useState({x:0,y:0}),p={filter:`
      brightness(${(((_=e.filters)==null?void 0:_.brightness)||100)/100})
      contrast(${(((X=e.filters)==null?void 0:X.contrast)||100)/100})
      saturate(${(((Y=e.filters)==null?void 0:Y.saturation)||100)/100})
      sepia(${(((A=e.filters)==null?void 0:A.tint)||0)/100})
      hue-rotate(${(((C=e.filters)==null?void 0:C.hue)||0)*3.6}deg)
      blur(${((P=e.filters)==null?void 0:P.blur)||0}px)
    `,transform:`scale(${((M=e.filters)==null?void 0:M.scale)||1}) rotate(${((S=e.filters)==null?void 0:S.rotate)||0}deg) ${(R=e.filters)!=null&&R.flipHorizontal?"scaleX(-1)":""} ${(L=e.filters)!=null&&L.flipVertical?"scaleY(-1)":""}`,mixBlendMode:((D=e.filters)==null?void 0:D.blendMode)||"normal",opacity:(((z=e.filters)==null?void 0:z.opacity)||100)/100},m=se.find(b=>b.id===e.mask)||se[0],y=b=>{a&&(b.stopPropagation(),f(!0),x({x:b.clientX-e.position.x,y:b.clientY-e.position.y}))},j=b=>{if(c&&u.current){const E=u.current.parentElement.getBoundingClientRect(),V=b.clientX-d.x,F=b.clientY-d.y,H=E.width-u.current.offsetWidth,U=E.height-u.current.offsetHeight,G=Math.max(0,Math.min(V,H)),Z=Math.max(0,Math.min(F,U));t({position:{x:G,y:Z}})}},k=()=>{f(!1)},g=()=>{const b=document.createElement("input");b.type="file",b.accept="image/*",b.onchange=E=>{if(E.target.files&&E.target.files[0]){const V=new FileReader;V.onload=F=>{var H;(H=F.target)!=null&&H.result&&t({content:F.target.result})},V.readAsDataURL(E.target.files[0])}},b.click()},J=()=>{const b={...JSON.parse(JSON.stringify(e)),id:`img-${Date.now()}`,position:{x:e.position.x+20,y:e.position.y+20}};t(b,!0)};h.useEffect(()=>(c&&(window.addEventListener("mousemove",j),window.addEventListener("mouseup",k)),()=>{window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",k)}),[c,d]);const O=h.useCallback(b=>{u.current=b,i(b)},[i]),W=[{label:"Reemplazar imagen",icon:s.jsx(Re,{className:"h-4 w-4"}),action:g},{label:"Duplicar",icon:s.jsx(ae,{className:"h-4 w-4"}),action:J},{label:"Reducir opacidad",icon:s.jsx(le,{className:"h-4 w-4"}),action:()=>{var b;return t({filters:{...e.filters,opacity:Math.max(0,(((b=e.filters)==null?void 0:b.opacity)||100)-10)}})}},{label:"Eliminar",icon:s.jsx(q,{className:"h-4 w-4"}),action:o}];return s.jsxs("div",{ref:O,className:`absolute ${m.class} ${a?"ring-2 ring-purple-500":""} ${l?"opacity-50":"opacity-100"}`,style:{left:`${e.position.x}px`,top:`${e.position.y}px`,width:"100%",height:"100%",cursor:a?"move":"pointer"},onClick:b=>{b.stopPropagation(),n()},onMouseDown:y,children:[s.jsx("div",{className:"w-full h-full overflow-hidden",children:s.jsx("img",{src:e.content,alt:"Imagen cargada",className:"w-full h-full object-cover",style:p})}),a&&s.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[s.jsx("button",{className:"bg-white rounded-full p-1 shadow-md hover:bg-gray-100",onClick:b=>{var E;b.stopPropagation(),t({filters:{...e.filters,rotate:(((E=e.filters)==null?void 0:E.rotate)||0)+90}})},children:s.jsx(re,{className:"h-4 w-4 text-gray-700"})}),s.jsx("button",{className:"bg-white rounded-full p-1 shadow-md hover:bg-gray-100",onClick:b=>{b.stopPropagation(),o()},children:s.jsx(q,{className:"h-4 w-4 text-gray-700"})})]}),s.jsx(de,{items:W})]})}function os({element:e,isSelected:a,onSelect:n,onUpdate:t,onDelete:o}){var P,M,S,R,L,D,z,b,E,V,F,H,U,G,Z;const[r,l]=h.useState(!1),i=h.useRef(null),u=h.useRef(null),[{isDragging:c},f]=oe(()=>({type:"TEXT_ELEMENT",item:{id:e.id},collect:v=>({isDragging:!!v.isDragging()})})),[d,x]=h.useState(!1),[p,m]=h.useState({x:0,y:0}),y=()=>{l(!0),setTimeout(()=>{i.current&&(i.current.focus(),i.current.select())},0)},j=()=>{l(!1)},k=v=>{t({content:v.target.value})},g=v=>{v.key==="Enter"&&l(!1)},J=v=>{a&&!r&&(v.stopPropagation(),x(!0),m({x:v.clientX-e.position.x,y:v.clientY-e.position.y}))},O=v=>{if(d&&u.current){const $=u.current.parentElement.getBoundingClientRect(),ue=v.clientX-p.x,ge=v.clientY-p.y,xe=$.width-u.current.offsetWidth,pe=$.height-u.current.offsetHeight,fe=Math.max(0,Math.min(ue,xe)),me=Math.max(0,Math.min(ge,pe));t({position:{x:fe,y:me}})}},W=()=>{x(!1)},_=()=>{const v={...JSON.parse(JSON.stringify(e)),id:`text-${Date.now()}`,position:{x:e.position.x+10,y:e.position.y+10}};t(v,!0)};h.useEffect(()=>(d&&(window.addEventListener("mousemove",O),window.addEventListener("mouseup",W)),()=>{window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",W)}),[d,p]);const X=h.useCallback(v=>{u.current=v,f(v)},[f]),Y=(P=e.style)!=null&&P.textShadow?`${e.style.textShadowX||0}px ${e.style.textShadowY||0}px ${e.style.textShadowBlur||0}px ${e.style.textShadowColor||"rgba(0,0,0,0.5)"}`:"none",A={...e.style,position:"absolute",left:`${e.position.x}px`,top:`${e.position.y}px`,cursor:a&&!r?"move":"pointer",textShadow:Y,zIndex:10},C=[{label:"Editar texto",icon:s.jsx(te,{className:"h-4 w-4"}),action:()=>l(!0)},{label:"Duplicar",icon:s.jsx(ae,{className:"h-4 w-4"}),action:_},{label:"Reducir opacidad",icon:s.jsx(le,{className:"h-4 w-4"}),action:()=>{var v;return t({style:{...e.style,opacity:Math.max(0,(((v=e.style)==null?void 0:v.opacity)||1)-.1)}})}},{label:"Eliminar",icon:s.jsx(q,{className:"h-4 w-4"}),action:o}];return s.jsxs("div",{ref:X,className:`${a?"ring-2 ring-purple-500":""} ${c?"opacity-50":"opacity-100"}`,style:A,onClick:v=>{v.stopPropagation(),n()},onDoubleClick:y,onMouseDown:J,children:[r?s.jsx("input",{ref:i,type:"text",value:e.content,onChange:k,onBlur:j,onKeyDown:g,className:"w-full p-1 border border-gray-300 rounded bg-white",style:{fontFamily:(M=e.style)==null?void 0:M.fontFamily,fontSize:(S=e.style)==null?void 0:S.fontSize,fontWeight:(R=e.style)==null?void 0:R.fontWeight,fontStyle:(L=e.style)==null?void 0:L.fontStyle,textDecoration:(D=e.style)==null?void 0:D.textDecoration,color:(z=e.style)==null?void 0:z.color,textAlign:(b=e.style)==null?void 0:b.textAlign,minWidth:"100px"},autoFocus:!0}):s.jsx("div",{className:"p-2 rounded",style:{backgroundColor:((E=e.style)==null?void 0:E.backgroundColor)||"transparent",padding:((V=e.style)==null?void 0:V.padding)||"8px",borderRadius:((F=e.style)==null?void 0:F.borderRadius)||"0px",border:((H=e.style)==null?void 0:H.border)||"none"},children:e.content||"Editar texto"}),a&&s.jsxs("div",{className:"absolute top-0 right-0 transform translate-y-[-100%] flex gap-1 bg-white rounded-t-md p-1 shadow-sm",children:[s.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:v=>{var $;v.stopPropagation(),t({style:{...e.style,fontWeight:(($=e.style)==null?void 0:$.fontWeight)==="bold"?"normal":"bold"}})},children:s.jsx("span",{className:`text-xs ${((U=e.style)==null?void 0:U.fontWeight)==="bold"?"font-bold":""}`,children:"B"})}),s.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:v=>{var $;v.stopPropagation(),t({style:{...e.style,fontStyle:(($=e.style)==null?void 0:$.fontStyle)==="italic"?"normal":"italic"}})},children:s.jsx("span",{className:`text-xs ${((G=e.style)==null?void 0:G.fontStyle)==="italic"?"italic":""}`,children:"I"})}),s.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:v=>{var $;v.stopPropagation(),t({style:{...e.style,textDecoration:(($=e.style)==null?void 0:$.textDecoration)==="underline"?"none":"underline"}})},children:s.jsx("span",{className:`text-xs ${((Z=e.style)==null?void 0:Z.textDecoration)==="underline"?"underline":""}`,children:"U"})}),s.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:v=>{v.stopPropagation(),o()},children:s.jsx(q,{className:"h-3 w-3 text-gray-700"})})]}),s.jsx(de,{items:C})]})}function ls({id:e,elements:a=[],selectedElement:n,onSelectElement:t,onAddElement:o,availableMasks:r=[]}){const[{isOver:l},i]=ze(()=>({accept:["IMAGE_FILE","TEXT_ELEMENT","IMAGE_ELEMENT"],drop:c=>{if(c.files){const f=new FileReader;f.onload=d=>{var x;if((x=d.target)!=null&&x.result){const p={id:`img-${Date.now()}`,type:"image",content:d.target.result,position:{x:10,y:10},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"};o(p)}},f.readAsDataURL(c.files[0])}},collect:c=>({isOver:!!c.isOver({shallow:!0})})})),u=()=>{const c=document.createElement("input");c.type="file",c.accept="image/*",c.onchange=f=>{if(f.target.files&&f.target.files[0]){const d=new FileReader;d.onload=x=>{var p;if((p=x.target)!=null&&p.result){const m={id:`img-${Date.now()}`,type:"image",content:x.target.result,position:{x:10,y:10},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"};o(m)}},d.readAsDataURL(f.target.files[0])}},c.click()};return s.jsx("div",{ref:i,className:`relative aspect-square bg-gray-50 rounded-lg overflow-hidden ${l?"ring-2 ring-purple-500 bg-purple-50":""}`,onClick:()=>t(null),children:a.length===0?s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-2 cursor-pointer hover:bg-gray-100 transition-colors",onClick:u,children:[s.jsx(He,{className:"h-8 w-8 text-gray-400"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Haz clic o arrastra una imagen"})]}):a.map(c=>s.jsx("div",{className:"absolute inset-0",children:c.type==="image"?s.jsx(rs,{element:c,isSelected:n===c.id,onSelect:()=>t(c.id),availableMasks:r}):s.jsx(os,{element:c,isSelected:n===c.id,onSelect:()=>t(c.id)})},c.id))})}function cs({page:e,layout:a,selectedElement:n,selectedCell:t,onSelectElement:o,onSelectCell:r,onAddElement:l,onUpdateElement:i,onDeleteElement:u,onUndo:c,onRedo:f,canUndo:d,canRedo:x,onAddImage:p,onAddText:m}){return s.jsxs("div",{className:"space-y-6",children:[s.jsx(_e,{onUndo:c,onRedo:f,onAddImage:p,onAddText:m,onDeleteElement:()=>{n&&t&&u(t,n)},canUndo:d,canRedo:x,hasSelectedElement:!!n}),s.jsx("div",{className:`bg-white rounded-lg shadow-lg overflow-hidden page-preview ${a.cells<=4?"aspect-[4/3]":""}`,children:s.jsx("div",{className:`grid ${a.template} gap-4 h-full p-4`,children:e.cells.map(y=>s.jsx(ls,{id:y.id,elements:y.elements,selectedElement:t===y.id?n:null,onSelectElement:j=>{o(j),r(y.id)},onAddElement:l,onUpdateElement:(j,k,g)=>{i(y.id,j,k,g)},onDeleteElement:j=>{u(y.id,j)},availableMasks:a.maskCategories.flatMap(j=>j.masks)},y.id))})})]})}function ds({currentPage:e,pages:a,selectedElement:n,selectedCell:t,onSelectElement:o,onSelectCell:r,onAddElement:l,onUpdateElement:i,onDeleteElement:u,getCurrentLayout:c,previewMode:f}){return s.jsx("main",{className:"flex-1 overflow-auto bg-gray-100 p-6",children:s.jsx("div",{className:"max-w-4xl mx-auto",children:f?s.jsx(as,{page:a[e],layout:c()}):s.jsx(cs,{page:a[e],layout:c(),selectedElement:n,selectedCell:t,onSelectElement:o,onSelectCell:r,onAddElement:l,onUpdateElement:i,onDeleteElement:u})})})}function us({pages:e,currentPage:a,onPageChange:n,onAddPage:t,onDuplicatePage:o,onDeletePage:r}){return s.jsx("aside",{className:"w-56 border-l bg-white p-4 overflow-y-auto shadow-sm",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"font-medium",children:"Páginas"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx(N,{variant:"ghost",size:"icon-sm",onClick:o,children:s.jsx(ae,{})}),s.jsx(N,{variant:"ghost",size:"icon-sm",onClick:r,disabled:e.length<=1,children:s.jsx(q,{className:"h-4 w-4"})})]})]}),s.jsxs("div",{className:"grid gap-3",children:[e.map((l,i)=>s.jsx(gs,{page:l,index:i,isActive:a===i,onClick:()=>n(i)},l.id)),s.jsx(N,{variant:"outline",size:"sm",icon:s.jsx(Be,{className:"h-4 w-4"}),onClick:t,children:"Añadir página"})]})]})})}function gs({page:e,index:a,isActive:n,onClick:t}){return s.jsx("div",{className:`border rounded-md p-2 cursor-pointer hover:border-purple-500 transition-colors ${n?"border-purple-500 ring-2 ring-purple-200":""}`,onClick:t,children:s.jsxs("div",{className:"bg-gray-100 aspect-[4/3] rounded-sm flex items-center justify-center text-xs text-gray-500 relative",children:["Pág. ",a+1,e.cells.some(o=>o.elements.some(r=>r.type==="image"&&r.content))&&s.jsx("div",{className:"absolute inset-0 grid grid-cols-2 grid-rows-2 gap-1 p-1",children:Array.from({length:4}).map((o,r)=>{const l=e.cells[r],i=l==null?void 0:l.elements.find(u=>u.type==="image"&&u.content);return s.jsx("div",{className:"bg-gray-200 rounded-sm overflow-hidden",children:i&&s.jsx("img",{src:i.content,alt:"",className:"w-full h-full object-cover"})},r)})})]})})}function xs(e){const[a,n]=h.useState([JSON.stringify(e)]),[t,o]=h.useState(0),r=f=>{const d=[...a.slice(0,t+1),JSON.stringify(f)];n(d),o(d.length-1)},l=()=>t>0?(o(t-1),JSON.parse(a[t-1])):null,i=()=>t<a.length-1?(o(t+1),JSON.parse(a[t+1])):null,u=t>0,c=t<a.length-1;return{currentState:JSON.parse(a[t]),addToHistory:r,undo:l,redo:i,canUndo:u,canRedo:c}}var K,ps=new Uint8Array(16);function fs(){if(!K&&(K=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!K))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return K(ps)}const ms=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function hs(e){return typeof e=="string"&&ms.test(e)}var w=[];for(var ee=0;ee<256;++ee)w.push((ee+256).toString(16).substr(1));function ys(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(w[e[a+0]]+w[e[a+1]]+w[e[a+2]]+w[e[a+3]]+"-"+w[e[a+4]]+w[e[a+5]]+"-"+w[e[a+6]]+w[e[a+7]]+"-"+w[e[a+8]]+w[e[a+9]]+"-"+w[e[a+10]]+w[e[a+11]]+w[e[a+12]]+w[e[a+13]]+w[e[a+14]]+w[e[a+15]]).toLowerCase();if(!hs(n))throw TypeError("Stringified UUID is invalid");return n}function I(e,a,n){e=e||{};var t=e.random||(e.rng||fs)();return t[6]=t[6]&15|64,t[8]=t[8]&63|128,ys(t)}function bs(e=[]){const a=h.useCallback((d=B[0].id)=>{const x=B.find(p=>p.id===d)||B[0];return{id:I(),layout:x.id,cells:Array.from({length:x.cells}).map(()=>({id:I(),elements:[]}))}},[]),[n,t]=h.useState(e.length?e:[a()]),[o,r]=h.useState(0),l=h.useCallback(d=>{const x=a(d);return t(p=>[...p,x]),r(p=>p+1),x},[a]),i=h.useCallback(d=>{const x=n[d],p={...JSON.parse(JSON.stringify(x)),id:I(),cells:x.cells.map(m=>({...m,id:I(),elements:m.elements.map(y=>({...y,id:I()}))}))};return t(m=>[...m,p]),r(n.length),p},[n]),u=h.useCallback(d=>{n.length<=1||(t(x=>x.filter((p,m)=>m!==d)),r(x=>Math.min(x,n.length-2)))},[n.length]),c=h.useCallback((d,x)=>{const p=B.find(m=>m.id===x);p&&t(m=>m.map((y,j)=>j!==d?y:{...y,layout:x,cells:Array.from({length:p.cells}).map((k,g)=>y.cells[g]||{id:I(),elements:[]})}))},[]),f=h.useCallback(()=>B.find(d=>{var x;return d.id===((x=n[o])==null?void 0:x.layout)})||B[0],[o,n]);return{pages:n,currentPageIndex:o,setCurrentPageIndex:r,addPage:l,duplicatePage:i,deletePage:u,changeLayout:c,currentPage:n[o],getCurrentLayout:f}}function vs(e=[]){const[a,n]=h.useState(e),[t,o]=h.useState(null),[r,l]=h.useState(null),i=(p,m={x:10,y:10})=>{const y=p==="image"?d(m):x(m);return n([...a,y]),o(y.id),y},u=(p,m)=>{n(a.map(y=>y.id===p?{...y,...m}:y))},c=p=>{n(a.filter(m=>m.id!==p)),t===p&&o(null)},f=p=>{const m=a.find(j=>j.id===p);if(!m)return;const y={...JSON.parse(JSON.stringify(m)),id:I(),position:{x:m.position.x+10,y:m.position.y+10}};return n([...a,y]),o(y.id),y},d=p=>({id:I(),type:"image",content:"",position:p,filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal",flipHorizontal:!1,flipVertical:!1},mask:"none"}),x=p=>({id:I(),type:"text",content:"Haz clic para editar",position:p,style:{fontSize:"16px",fontFamily:"Arial, sans-serif",color:"#000000",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"8px",borderRadius:"0px",border:"none",opacity:1,textShadow:"none",textShadowX:0,textShadowY:0,textShadowBlur:0,textShadowColor:"rgba(0,0,0,0.5)"}});return{elements:a,selectedElement:t,selectedCell:r,setSelectedElement:o,setSelectedCell:l,addElement:i,updateElement:u,deleteElement:c,duplicateElement:f}}const js=async(e,a="diseño-pagina")=>{const n=document.getElementById(e);if(!n)return;const t=document.createElement("canvas"),o=n.offsetWidth,r=n.offsetHeight;t.width=o*2,t.height=r*2;const l=t.getContext("2d");l.scale(2,2),l.fillStyle="white",l.fillRect(0,0,o,r);try{(await Oe(n,{scale:2,backgroundColor:null,canvas:t,logging:!1,useCORS:!0})).toBlob(u=>{Xe.saveAs(u,`${a}.png`)})}catch(i){console.error("Error al exportar la página:",i)}};function Is(){const{pages:e,currentPageIndex:a,setCurrentPageIndex:n,addPage:t,duplicatePage:o,deletePage:r,changeLayout:l,currentPage:i,getCurrentLayout:u}=bs(),{elements:c,selectedElement:f,selectedCell:d,setSelectedElement:x,setSelectedCell:p,addElement:m,deleteElement:y}=vs(),{addToHistory:j}=xs(e),[k,g]=h.useState(!1),[J,O]=h.useState("elements"),[W,_]=h.useState("basic"),X=h.useCallback(()=>{js("page-preview",`diseño-pagina-${a+1}`)},[a]),Y=h.useCallback(()=>{g(C=>!C)},[]),A=h.useCallback((C,P,M)=>{const S=e.map((R,L)=>L!==a?R:{...R,cells:R.cells.map(D=>D.id!==C?D:{...D,elements:D.elements.map(z=>z.id!==P?z:{...z,...M})})});setPages(S),j(S)},[e,a,j]);return s.jsx(Te,{backend:Ie,children:s.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-50 mx-auto max-w-7xl",children:[s.jsx(We,{onExport:X,onPreviewToggle:Y,previewMode:k}),s.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[s.jsx(ts,{activeTab:J,onTabChange:O,selectedLayout:i.layout,onLayoutChange:C=>{l(a,C),j(e)},onAddImage:C=>{const P=new FileReader;P.onload=M=>{var S;(S=M.target)!=null&&S.result&&m("image",{content:M.target.result})},P.readAsDataURL(C)},onAddText:()=>{m("text")},selectedElement:f,onFilterChange:A,getSelectedElement:()=>c.find(C=>C.id===f),getCurrentLayout:u}),s.jsx(ds,{currentPage:a,pages:e,selectedElement:f,selectedCell:d,onSelectElement:x,onSelectCell:p,onAddElement:m,onUpdateElement:A,onDeleteElement:y,getCurrentLayout:u,previewMode:k}),s.jsx(us,{pages:e,currentPage:a,onPageChange:n,onAddPage:()=>{t(),j(e)},onDuplicatePage:()=>{o(a),j(e)},onDeletePage:()=>{r(a),j(e)}})]})]})})}export{Is as default};
