var se=Object.defineProperty;var ne=(s,a,n)=>a in s?se(s,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[a]=n;var D=(s,a,n)=>(ne(s,typeof a!="symbol"?a+"":a,n),n);import{j as e}from"./AboutHeader-CpM0iYLI.js";import{r as o}from"./index-B80Lgev0.js";import{c as te}from"./ReactAppend-CBRQCQGz.js";import{C as re}from"./CreateReactScript-wgaspG1d.js";import{i as W}from"./tippy-react.esm-CHhA99mn.js";import{m as E}from"./main-B2CtU6ez.js";import{B as ie}from"./BasicEditing-Co4zseXw.js";import{S as ae}from"./SwitchFormGroup-DbO3fJgb.js";import{G as Z}from"./Global-mC9lKANG.js";import{S as V}from"./SortByAfterField-BaS5rBg8.js";import{I as Q}from"./InputFormGroup-aNCWUTCq.js";import{M as J}from"./Modal-Dbgjpj-3.js";import{S as A}from"./SelectFormGroup-Dk0mAUCB.js";import{S as le}from"./SetSelectValue-UxyCmHse.js";import{a as ce,M as K}from"./MenuItemContainer-DGfKOLAz.js";import"./index-DO3Aws4m.js";import"./index.esm-Cu-mVv1q.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";/* empty css               *//* empty css              */class _ extends ie{constructor(){super(...arguments);D(this,"path","admin/system");D(this,"savePage",async(n={})=>{try{const{status:t,result:r}=await E.Fetch(`/api/${this.path}/page`,{method:"POST",body:JSON.stringify(n)});if(!t)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return r.data??[]}catch(t){return E.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:t.message,type:"danger"}),null}});D(this,"updateOrder",async n=>{try{const{status:t,result:r}=await E.Fetch(`/api/${this.path}/order`,{method:"PATCH",body:JSON.stringify(n)});if(!t)throw new Error((r==null?void 0:r.message)??"Ocurrio un error inesperado");return!0}catch(t){E.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:t.message,type:"danger"})}});D(this,"deletePage",async n=>{try{const{status:t,result:r}=await E.Fetch(`/api/${this.path}/page/${n}`,{method:"DELETE"});if(!t)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return r.data??!0}catch(t){return E.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:t.message,type:"danger"}),!1}});D(this,"exportBK",async()=>{try{const{status:n,result:t}=await E.Fetch(`/api/${this.path}/backup`);if(!n)throw new Error((t==null?void 0:t.message)||"Ocurrio un error inesperado");return t}catch(n){return E.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:n.message,type:"danger"}),null}});D(this,"importBK",async n=>{try{const t=await fetch(`/api/${this.path}/backup`,{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(E.Cookies.get("XSRF-TOKEN"))},body:n}),r=JSON.parseable(await t.text());if(!t.ok)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return r??!0}catch(t){return E.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:t.message,type:"danger"}),null}})}}const q=(s="")=>{s=s.replace(/[^a-zA-Z0-9_{}]/g,"");const a=/{([^}]+)}/g,n=[];let t;for(;(t=a.exec(s))!==null;)n.push(t[1]);return n},z=new _,oe=s=>{const{id:a,name:n,path:t,extends_base:r=!1,setPages:l,onSEOClicked:c,onParamsClicked:m}=s,[f,u]=o.useState(!1),[y,v]=o.useState(!1),[g,j]=o.useState(!1),w=async x=>{if(n===x.target.value)return u(!1);z.savePage({id:a,name:x.target.value})&&(u(!1),l(p=>p.map(d=>d.id===a?{...d,name:x.target.value}:d)))},R=async x=>{if(t===x.target.value)return v(!1);z.savePage({id:a,path:x.target.value})&&(v(!1),l(p=>p.map(d=>d.id===a?{...d,path:x.target.value}:d)))},B=async x=>{const k=x.target.checked;z.savePage({id:a,extends_base:k})&&(j(!1),l(d=>d.map(i=>i.id===a?{...i,extends_base:k}:i)))},M=async x=>{await z.deletePage(x.id)&&(l(p=>p.filter(d=>d.id!=x.id)),$('[data-bs-toggle="tab"]').removeClass("active"),$(".tab-pane").removeClass("active"),$("#base-template-link").addClass("active"),$("#base-template").addClass("active"))},C=q(t);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dropdown float-end",children:[e.jsx("a",{href:"#",className:"dropdown-toggle arrow-none card-drop","data-bs-toggle":"dropdown","aria-expanded":"false",children:e.jsx("i",{className:"mdi mdi-dots-vertical"})}),e.jsxs("div",{className:"dropdown-menu dropdown-menu-end",children:[e.jsxs("button",{className:"dropdown-item",onClick:()=>c(s),children:[e.jsx("i",{className:"mdi mdi-cloud-search-outline me-1"}),"Editar SEO"]}),C.length>0&&e.jsxs("button",{className:"dropdown-item",onClick:()=>m(s),children:[e.jsx("i",{className:"mdi mdi-code-braces me-1"}),"Parámetros"]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{className:"dropdown-item",onClick:()=>M(s),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar página"]})]})]}),e.jsxs("div",{children:[f?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:n,onBlur:w,autoFocus:!0}):e.jsx(W,{content:"Editar nombre",placement:"left",children:e.jsx("h4",{className:"header-title mb-1 d-block",onClick:()=>u(!0),style:{minWidth:"200px",cursor:"pointer"},children:n||"Sin nombre"})}),y?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:t,style:{minHeight:27,fieldSizing:"content"},onBlur:R,autoFocus:!0}):e.jsx(W,{content:"Editar ruta",placement:"left",children:e.jsx("small",{className:"text-muted d-block mb-1",onClick:()=>v(!0),style:{minWidth:"200px",cursor:"pointer"},children:t||"Sin ruta"})}),e.jsx(ae,{label:"Extiende de base",checked:r,onChange:B,disabled:g})]})]})},L=({col:s,label:a,eRef:n,placeholder:t,required:r=!1,rows:l=3,value:c,onChange:m})=>e.jsxs("div",{className:`form-group ${s} mb-2`,children:[e.jsxs("label",{htmlFor:"",children:[a," ",r&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{ref:n,className:"form-control",placeholder:t,required:r,rows:l,defaultValue:c,style:{minHeight:l*27,fieldSizing:"content"},onChange:m})]}),me=new _,de=({dataLoaded:s,setDataLoaded:a,modalRef:n})=>{const t=o.useRef(null),r=o.useRef(null),l=o.useRef(null),c=async m=>{m.preventDefault(),await me.savePage({id:s.id,description:r.current.value,keywords:$(l.current).val()})&&(a(null),$(n.current).modal("hide"))};return o.useEffect(()=>{t.current.value=`${s==null?void 0:s.name} | ${Z.APP_NAME}`,r.current.value=(s==null?void 0:s.description)??"",le(l.current,(s==null?void 0:s.keywords)??[])},[s]),e.jsx(J,{modalRef:n,title:`Editar SEO - ${s==null?void 0:s.name}`,size:"sm",onSubmit:c,children:e.jsxs("div",{id:"seo-container",children:[e.jsx(Q,{eRef:t,label:"Título",disabled:!0}),e.jsx(L,{eRef:r,label:"Descripción",rows:2}),e.jsx(A,{eRef:l,label:"Palabras clave",tags:!0,multiple:!0,dropdownParent:"#seo-container"})]})})},X=({className:s,system:a,component:n,onComponentClicked:t,onDeleteClicked:r,onEditDataClicked:l})=>{var f;const c=(n==null?void 0:n.options)??[],m=c.find(u=>u.id==a.value);return e.jsxs("div",{className:`dropdown ${s}`,"data-id":a.id,children:[e.jsxs("div",{className:"btn btn-light dropdown-toggle text-truncate w-100 text-start",type:"button",id:`dd-${a.id}`,"data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true",children:[e.jsx("i",{className:"mdi mdi-chevron-down ms-1 float-end"}),e.jsxs("span",{className:"handle-sortable",style:{cursor:"move"},children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"})]}),e.jsx("span",{className:"ms-1",children:a.name})]}),e.jsxs("div",{className:"dropdown-menu","aria-labelledby":`dd-${a.id}`,"data-popper-placement":"bottom-start",children:[c.length>1&&e.jsxs(e.Fragment,{children:[c.filter(u=>u.id!=a.value).map(u=>e.jsxs("button",{className:"dropdown-item",onClick:()=>t({...a,name:`${n.name} - ${u.name}`,value:u.id}),children:[n.name," - ",u.name]})),e.jsx("div",{className:"dropdown-divider"})]}),(((f=m==null?void 0:m.using)==null?void 0:f.filters)||(m==null?void 0:m.data))&&e.jsxs("button",{className:"dropdown-item",onClick:()=>l(a,m),children:[e.jsx("i",{className:"mdi mdi-pencil me-1"}),"Configurar datos"]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>r(a),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar"]})]})]})},ue=new _,pe=({dataLoaded:s,setDataLoaded:a,setSystems:n,modalRef:t})=>{var f,u,y,v,g,j,w,R,B,M,C,x,k;const[r,l]=o.useState((s==null?void 0:s.data)||{}),c={};c.model=o.useRef(null),c.filters=o.useRef(null);const m=async p=>{p.preventDefault();const d=await ue.save({id:s.id,data:r,filters:$(c.filters.current).val()});d&&(a(null),$(t.current).modal("hide"),n(i=>i.map(h=>h.id==s.id?d.data:h)))};return o.useEffect(()=>{var d,i,h;const p={};(d=s==null?void 0:s.component)==null||d.data.forEach(b=>{var N;p[b]=((N=s==null?void 0:s.data)==null?void 0:N[b])??""}),l(p),c.model.current.value=((h=(i=s==null?void 0:s.component)==null?void 0:i.using)==null?void 0:h.model)??"",$(c.filters.current).val((s==null?void 0:s.filters)??[]).trigger("change")},[s]),e.jsxs(J,{modalRef:t,title:s==null?void 0:s.name,onSubmit:m,children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered",children:[e.jsx("li",{className:"nav-item",hidden:!((u=(f=s==null?void 0:s.component)==null?void 0:f.data)!=null&&u.length),children:e.jsx("a",{href:"#tab-info","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link active",children:"Información"})}),e.jsx("li",{className:"nav-item",hidden:!((v=(y=s==null?void 0:s.component)==null?void 0:y.using)!=null&&v.filters),children:e.jsx("a",{href:"#tab-db","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Base de datos"})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"tab-info",hidden:!((j=(g=s==null?void 0:s.component)==null?void 0:g.data)!=null&&j.length),children:(R=(w=s==null?void 0:s.component)==null?void 0:w.data)==null?void 0:R.map((p,d)=>e.jsx(L,{label:p,value:r[p]??"",rows:1,onChange:i=>l({...r,[p]:i.target.value})},d))}),e.jsxs("div",{className:"tab-pane show",id:"tab-db",children:[e.jsx(Q,{eRef:c.model,label:"Modelo",disabled:!0}),e.jsx(A,{eRef:c.filters,label:"Filtros",multiple:!0,dropdownParent:"#tab-db",hidden:!((M=(B=s==null?void 0:s.component)==null?void 0:B.using)!=null&&M.filters),children:(k=(x=(C=s==null?void 0:s.component)==null?void 0:C.using)==null?void 0:x.filters)==null?void 0:k.map((p,d)=>e.jsx("option",{value:p,children:p},d))})]})]})]})},Y=new _,he=({components:s,onClick:a})=>e.jsx("div",{className:"left-side-menu top-0 pt-2",children:e.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[e.jsx("div",{id:"sidebar-menu",className:"show",children:e.jsxs("ul",{id:"side-menu",children:[e.jsx("li",{className:"menu-title",children:"Lista de componentes"}),s.filter(n=>n.options.length>0).map((n,t)=>e.jsx(ce,{title:n.name,children:n.options.map((r,l)=>e.jsx(K,{name:r.name,icon:r.image,onClick:()=>{const c=$(".tab-pane:visible .components-container > div").last().data("id");a({name:`${n.name} - ${r.name}`,component:n.id,value:r.id,after_component:c})},children:r.name},l))},t)),e.jsx("li",{className:"menu-title",children:"Sistema de respaldo"}),e.jsx(K,{icon:"mdi mdi-cloud-download",onClick:async()=>{const n=await Y.exportBK(),t=new Blob([JSON.stringify(n)],{type:"application/json"}),r=URL.createObjectURL(t),l=document.createElement("a");l.href=r,l.download="backup.json",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r)},children:"Exportar Backup"}),e.jsx("input",{type:"file",id:"file-input",accept:"application/json",style:{display:"none"},onChange:async n=>{const t=n.target.files[0];if(n.target.value=null,t){const r=new FormData;if(r.append("backup",t),!await Y.importBK(r))return;location.reload()}}}),e.jsx(K,{icon:"mdi mdi-backup-restore",onClick:()=>{document.getElementById("file-input").click()},children:"Importar Backup"})]})}),e.jsx("div",{className:"clearfix"})]})}),fe=({param:s,models:a})=>{var u,y,v;const n=o.useRef(),t=o.useRef(),r=o.useRef(),[l,c]=o.useState(null),m=g=>{const j=g.target.value,w=a.find(R=>R.name==j)??null;c(w)};o.useEffect(()=>{$(n.current).val(null).trigger("change")},[s]),o.useEffect(()=>{$(r.current).trigger("change")},[l]);const f=`${s}-container`;return e.jsxs("div",{id:f,className:"row",children:[e.jsxs("label",{className:"form-label",children:["Parámetro ",e.jsx("code",{children:s})]}),e.jsx(A,{eRef:n,label:"Modelo",col:"col-md-6",dropdownParent:`#${f}`,onChange:m,children:a.map((g,j)=>e.jsx("option",{children:g.name},j))}),e.jsx(A,{eRef:t,label:"Campo",col:"col-md-6",dropdownParent:`#${f}`,children:(u=l==null?void 0:l.fields)==null?void 0:u.map((g,j)=>e.jsx("option",{children:g},j))}),e.jsx("div",{hidden:(((y=l==null?void 0:l.relations)==null?void 0:y.length)??0)==0,children:e.jsx(A,{eRef:r,label:"Relaciones",multiple:!0,dropdownParent:`#${f}`,children:(v=l==null?void 0:l.relations)==null?void 0:v.map((g,j)=>e.jsx("option",{children:g},j))})})]})},xe=new _,be=({dataLoaded:s,setDataLoaded:a,modalRef:n,models:t})=>{const r=async c=>{c.preventDefault(),await xe.savePage({id:s.id,description:descriptionRef.current.value,keywords:$(keywordsRef.current).val()})&&(a(null),$(n.current).modal("hide"))},l=q((s==null?void 0:s.path)??"");return e.jsx(J,{modalRef:n,title:`Editar parámetros de URL - ${s==null?void 0:s.name}`,onSubmit:r,children:l.map((c,m)=>e.jsx(fe,{param:c,models:t},m))})},G=new _,ge=({systems:s,pages:a,components:n,models:t})=>{const r=o.useRef(null),l=o.useRef(null),c=o.useRef(null),[m,f]=o.useState(s),[u,y]=o.useState(a),[v,g]=o.useState(!1),[j,w]=o.useState(null),[R,B]=o.useState(null),M=async()=>{g(!0);const i=await G.savePage();i&&(g(!1),y(i))},C=async i=>{const b=$(".tab-pane:visible").data("id")??null;i.page_id=b;const N=await G.save(i);if(!N)return;const P=N.data;f(O=>O.some(S=>S.id===P.id)?O.map(S=>S.id===P.id?P:S):[...O,P])},x=async i=>{await G.delete(i.id)&&f(b=>b.filter(N=>N.id!=i.id))};o.useEffect(()=>{document.title=`Sistema | ${Z.APP_NAME}`},[null]),o.useEffect(()=>{const i=$("iframe:visible");i&&$(i).attr("src",i.attr("src"))},[m,u]);const k=async i=>{w(i),$(r.current).modal("show")},p=async i=>{w(i),$(l.current).modal("show")},d=async(i,h)=>{B({...i,component:h}),$(c.current).modal("show")};return o.useEffect(()=>{[...$(".components-container")].forEach(h=>{$(h).sortable({connectWith:".components-container",handle:".handle-sortable",forcePlaceholderSize:!0,update:async function(b,N){const P=[...$(h).children()],O={};if(P.forEach(T=>{const S=$(T).data("id"),F=$(T).prev().data("id")??null,I=m.find(U=>U.id==S);(I==null?void 0:I.after_component)!==F&&(O[S]=F)}),Object.keys(O).length>0){if(!await G.updateOrder(O))return;f(S=>{const F=[...S];return Object.entries(O).forEach(([I,U])=>{const H=F.findIndex(ee=>ee.id==I);H!==-1&&(F[H]={...F[H],after_component:U})}),F})}}}).disableSelection()})},[u,m]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"wrapper",children:[e.jsx(he,{components:n,onClick:C}),e.jsx("div",{className:"content-page mt-2 pb-3",style:{height:"max-content"},children:e.jsx("div",{className:"content mt-2",children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("button",{className:"button-menu-mobile d-lg-none d-md-block position-absolute ",style:{zIndex:1,border:"none",borderRadius:"0 50% 50% 0",backgroundColor:"#fff",color:"#343a40",top:"50%",left:"0",transform:"translateY(-50%)",padding:"24px 0px 20px 6px ",fontWeight:"bold"},children:"〉"}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card mb-0",children:e.jsxs("div",{className:"card-body",style:{height:"calc(100vh - 48px)"},children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered flex-nowrap",style:{overflowX:"auto",overflowY:"hidden"},children:[e.jsx("li",{className:"nav-item",children:e.jsx("a",{id:"base-template-link",href:"#base-template","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active h-100",children:"Base"})}),u.map((i,h)=>e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:`#page-${i.id}`,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link h-100",style:{whiteSpace:"nowrap"},children:[i.name,e.jsx("small",{className:"d-block text-muted",style:{fontWeight:"normal"},children:i.path})]})},h)),e.jsx("li",{className:"nav-item d-flex justify-content-center align-items-center px-2",children:e.jsx(W,{content:"Agregar página",children:e.jsx("button",{className:"nav-link btn btn-xs btn-white rounded-pill",onClick:M,disabled:v,children:v?e.jsx("i",{className:"mdi mdi-loading mdi-spin"}):e.jsx("i",{className:"mdi mdi-plus"})})})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"base-template",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"d-flex flex-column gap-2",children:V(m).filter(i=>i.page_id==null).map(i=>{const h=n.find(b=>b.id==i.component);if(h==null||h.options,i.component=="content")return e.jsxs("button",{"data-id":i.id,className:"btn btn-light text-truncate w-100 text-start",type:"button",children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("span",{className:"ms-1",children:i.name})]});{const b=n.find(N=>N.id==i.component);return e.jsx(X,{className:"",system:i,component:b,onComponentClicked:C,onDeleteClicked:x,onEditDataClicked:d},i.id)}})})}),e.jsx("div",{className:"col-md-8",children:e.jsx("iframe",{src:"/base-template",className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 185px)",borderRadius:"4px"}})})]})}),u.map((i,h)=>e.jsx("div",{className:"tab-pane",id:`page-${i.id}`,"data-id":i.id,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx(oe,{...i,models:t,setPages:y,onSEOClicked:k,onParamsClicked:p}),e.jsx("hr",{className:"my-2"}),e.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":i.id,children:V(m).filter(b=>b.page_id==i.id).map(b=>{const N=n.find(P=>P.id==b.component);return e.jsx(X,{className:"",system:b,component:N,onComponentClicked:C,onDeleteClicked:x,onEditDataClicked:d},b.id)})})]}),e.jsx("div",{className:"col-md-8",children:e.jsx("iframe",{src:i.path,className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 185px)",borderRadius:"4px"}})})]})},h))]})]})})})})]})})})]}),e.jsx(de,{dataLoaded:j,setDataLoaded:w,modalRef:r}),e.jsx(be,{dataLoaded:j,setDataLoaded:w,modalRef:l,models:t}),e.jsx(pe,{dataLoaded:R,setDataLoaded:B,setSystems:f,modalRef:c})]})};re((s,a)=>{te(s).render(e.jsx(ge,{...a}))});
