var ge=Object.defineProperty;var he=(p,l,u)=>l in p?ge(p,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):p[l]=u;var B=(p,l,u)=>he(p,typeof l!="symbol"?l+"":l,u);import{j as t}from"./ModalImportItem-ClKiNAEV.js";import{B as xe}from"./Base-CnoP34n1.js";import{S}from"./SwitchFormGroup-Cml5JQCF.js";import{T as be}from"./TextareaFormGroup-CR14ptGz.js";import{r as n}from"./index-DFv2mRv-.js";import{c as je}from"./ReactAppend-D9rqaU78.js";import{r as E}from"./DxBox-BT4PRiTu.js";import{S as ve}from"./ProductCard-KWJbgLTG.js";import{B as ye}from"./BasicEditing-DktVQ8WO.js";import{M as U}from"./Modal-CBWw_MM9.js";import{T as Re}from"./Table-559VE-tL.js";import{I as z}from"./ImageFormGroup-Besihcks.js";import{I as k}from"./InputFormGroup-CVp-FvWe.js";import{Q as we}from"./QuillFormGroup-DuHWQ9Xf.js";import{S as J}from"./SelectAPIFormGroup-BX6gvwc9.js";import{S as V}from"./SelectFormGroup-Be-r3F_2.js";import{D as Q}from"./DxButton-CsjWvhyj.js";import{C as Ce}from"./CreateReactScript-C556Y6YC.js";import{N as H}from"./Number2Currency-e57Tgsuk.js";import{R as C}from"./ReactAppend-BsNWeF6w.js";import{S as X}from"./SetSelectValue-UxyCmHse.js";import{a as Se}from"./index.esm-Cw4Q9yGE.js";import"./Global-BM4Id4Pw.js";import"./tippy-react.esm-CGYKl-Jd.js";import"./index-Sd7so-oN.js";/* empty css              */import"./Logout-CnsEv7kI.js";import"./main-rZoj-gSW.js";import"./___vite-browser-external_commonjs-proxy-BQdpDcDf.js";import"./MenuItemContainer-DimihTIG.js";/* empty css               */import"./General-BmbBKdsB.js";const K=({label:p,structure:l,onChange:u,typeOptions:R=[]})=>{const[m,f]=n.useState([]),x=()=>{f(typeof l=="object"?[...m,{...l}]:[...m,""])},y=a=>{const c=m.filter((d,i)=>i!==a);f(c),u(c)},b=(a,c,d)=>{const i=[...m];typeof i[a]=="object"?i[a][c]=d:i[a]=d,f(i),u(i)};return t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:p}),m.map((a,c)=>{const d=m.length%2!==0&&c===m.length-1;return t.jsxs("div",{className:"row g-2 mb-2",children:[typeof a=="object"?Object.keys(l).map(i=>t.jsx("div",{className:d?"col-9":"col-6",children:i==="type"?t.jsxs("select",{className:"form-select",value:a[i],onChange:g=>b(c,i,g.target.value),children:[t.jsx("option",{value:"",children:"Seleccionar..."}),R.map(g=>t.jsx("option",{value:g,children:g},g))]}):t.jsx("input",{type:"text",className:"form-control",value:a[i],onChange:g=>b(c,i,g.target.value),placeholder:i})},i)):t.jsx("div",{className:d?"col-9":"col-6",children:t.jsx("input",{type:"text",className:"form-control",value:a,onChange:i=>b(c,null,i.target.value),placeholder:"Característica"})}),t.jsx("div",{className:"col-3",children:t.jsx("button",{type:"button",className:"btn btn-danger w-100",onClick:()=>y(c),children:"X"})})]},c)}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:x,children:"+ Agregar"})]})};class Ne extends ye{constructor(){super(...arguments);B(this,"path","admin/items");B(this,"hasFiles",!0)}}const Fe=()=>{const[l,u]=n.useState(null),[R,m]=n.useState(!1),[f,x]=n.useState(""),y=a=>{u(a.target.files[0])},b=async()=>{var c,d;if(!l){x("Por favor, selecciona un archivo.");return}const a=new FormData;a.append("file",l),m(!0);try{const i=await Se.post("undefined/import-items",a,{headers:{"Content-Type":"multipart/form-data"}});x(i.data.message)}catch(i){x("Error al importar: "+((d=(c=i.response)==null?void 0:c.data)==null?void 0:d.error)||i.message)}m(!1)};return t.jsx("div",{className:"bg-white",children:t.jsxs("div",{className:"modal-content",children:[t.jsx("h2",{children:"Importar Datos"}),t.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:y}),t.jsx("button",{onClick:b,disabled:R,children:R?"Subiendo...":"Subir Archivo"}),f&&t.jsx("p",{children:f})]})})},N=new Ne,Ie=({categories:p,brands:l})=>{//!FALTA EDIT AND DELETEDE GALERIA
const[u,R]=n.useState([]),m=n.useRef(),f=n.useRef(),x=n.useRef(),y=n.useRef(),b=n.useRef(),a=n.useRef(),c=n.useRef(),d=n.useRef(),i=n.useRef(),g=n.useRef(),A=n.useRef(),F=n.useRef(),I=n.useRef(),G=n.useRef(),_=n.useRef(),W=n.useRef([]),Y=n.useRef([]),[Z,P]=n.useState(!1),[ee,te]=n.useState(null),[D,v]=n.useState([]),O=n.useRef(),re=e=>{const s=Array.from(e.target.files).map(o=>({file:o,url:URL.createObjectURL(o)}));v(o=>[...o,...s])},se=e=>{e.preventDefault();const s=Array.from(e.dataTransfer.files).map(o=>({file:o,url:URL.createObjectURL(o)}));v(o=>[...o,...s])},ne=e=>{e.preventDefault()},ie=(e,r)=>{e.preventDefault(),D[r].id?v(o=>o.map((j,w)=>w===r?{...j,toDelete:!0}:j)):v(o=>o.filter((j,w)=>w!==r))};n.useEffect(()=>{if(u&&u.images){const e=u.images.map(r=>({id:r.id,url:`/storage/images/item_image/${r.url}`}));v(e)}},[u]);const M=e=>{var r,s;if(console.log(e),R(e||null),e!=null&&e.id?P(!0):P(!1),x.current.value=(e==null?void 0:e.id)||"",$(y.current).val((e==null?void 0:e.category_id)||null).trigger("change"),X(b.current,(r=e==null?void 0:e.subcategory)==null?void 0:r.id,(s=e==null?void 0:e.subcategory)==null?void 0:s.name),$(a.current).val((e==null?void 0:e.brand_id)||null).trigger("change"),c.current.value=(e==null?void 0:e.name)||"",d.current.value=(e==null?void 0:e.summary)||"",i.current.value=(e==null?void 0:e.price)||0,g.current.value=(e==null?void 0:e.discount)||0,X(A.current,(e==null?void 0:e.tags)??[],"id","name"),F.current.value=null,I.current.value=null,F.image.src=`/storage/images/item/${(e==null?void 0:e.banner)??"undefined"}`,I.image.src=`/storage/images/item/${(e==null?void 0:e.image)??"undefined"}`,G.editor.root.innerHTML=(e==null?void 0:e.description)??"",e!=null&&e.images){const o=e.images.map(j=>({id:j.id,url:`/api/items/gallery/media/${j.url}`}));v(o)}else v([]);_.current.value=e==null?void 0:e.stock,$(f.current).modal("show")},oe=async e=>{e.preventDefault();const r={id:x.current.value||void 0,category_id:y.current.value,subcategory_id:b.current.value,brand_id:a.current.value,name:c.current.value,summary:d.current.value,price:i.current.value,discount:g.current.value,tags:$(A.current).val(),description:G.current.value,sotck:_.current.value},s=new FormData;for(const h in r)s.append(h,r[h]);s.append("features",JSON.stringify(ce)),s.append("specifications",JSON.stringify(ue));const o=I.current.files[0];o&&s.append("image",o);const j=F.current.files[0];j&&s.append("banner",j),D.forEach((h,q)=>{h.toDelete||(h.file?s.append(`gallery[${q}]`,h.file):s.append(`gallery_ids[${q}]`,h.id))});const w=D.filter(h=>h.toDelete).map(h=>parseInt(h.id,10));w.length>0&&s.append("deleted_images",JSON.stringify(w)),console.log(s),await N.save(s)&&($(m.current).dxDataGrid("instance").refresh(),$(f.current).modal("hide"),v([]))},le=async({id:e,value:r})=>{await N.boolean({id:e,field:"visible",value:r})&&$(m.current).dxDataGrid("instance").refresh()},T=async({id:e,field:r,value:s})=>{await N.boolean({id:e,field:r,value:s})&&$(m.current).dxDataGrid("instance").refresh()},ae=async e=>{const{isConfirmed:r}=await ve.fire({title:"Eliminar curso",text:"¿Estás seguro de eliminar este curso?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await N.delete(e)||$(m.current).dxDataGrid("instance").refresh()},[ce,me]=n.useState([]),[ue,pe]=n.useState([]),de=["General","Principal","Otro"],[De,Te]=n.useState(!1),L=n.useRef(),fe=()=>{$(L.current).modal("show")};return t.jsxs(t.Fragment,{children:[t.jsx(Re,{gridRef:m,title:"Items",rest:N,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(m.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>M()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Importar Datos",hint:"Importar Datos",onClick:()=>fe()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:r})=>{var s,o;e.html(E(t.jsxs(t.Fragment,{children:[t.jsx("b",{className:"d-block",children:(s=r.category)==null?void 0:s.name}),t.jsx("small",{className:"text-muted",children:(o=r.subcategory)==null?void 0:o.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",width:"300px",cellTemplate:(e,{data:r})=>{e.html(E(t.jsxs(t.Fragment,{children:[t.jsx("b",{children:r.name}),t.jsx("br",{}),t.jsx("span",{className:"truncate",children:r.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:r})=>{e.html(E(t.jsxs(t.Fragment,{children:[r.discount>0&&t.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",H(r.price)]}),t.jsxs("span",{children:["S/.",H(r.discount>0?r.discount:r.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:r})=>{C(e,t.jsx("img",{src:`/storage/images/item/${r.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:s=>s.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{C(e,t.jsx(S,{checked:r.is_new,onChange:s=>T({id:r.id,field:"is_new",value:s.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{C(e,t.jsx(S,{checked:r.offering,onChange:s=>T({id:r.id,field:"offering",value:s.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{C(e,t.jsx(S,{checked:r.recommended,onChange:s=>T({id:r.id,field:"recommended",value:s.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{C(e,t.jsx(S,{checked:r.featured,onChange:s=>T({id:r.id,field:"featured",value:s.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{C(e,t.jsx(S,{checked:r.visible,onChange:s=>le({id:r.id,value:s.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(Q({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>M(r)})),e.append(Q({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>ae(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsxs(U,{modalRef:f,title:Z?"Editar curso":"Agregar curso",onSubmit:oe,size:"xl",children:[t.jsxs("div",{className:"row",id:"principal-container",children:[t.jsx("input",{ref:x,type:"hidden"}),t.jsxs("div",{className:"col-md-3",children:[t.jsx(V,{eRef:y,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>te(e.target.value),children:p.map((e,r)=>t.jsx("option",{value:e.id,children:e.name},r))}),t.jsx(J,{eRef:b,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",ee],dropdownParent:"#principal-container"}),t.jsx(V,{eRef:a,label:"Marca",required:!0,dropdownParent:"#principal-container",children:l.map((e,r)=>t.jsx("option",{value:e.id,children:e.name},r))}),t.jsx(k,{label:"Stock",eRef:_,type:"number"}),t.jsx(k,{eRef:i,label:"Precio",type:"number",step:"0.01",required:!0}),t.jsx(k,{eRef:g,label:"Descuento",type:"number",step:"0.01"}),t.jsx(J,{id:"tags",eRef:A,searchAPI:"/api/admin/tags/paginate",searchBy:"name",label:"Tags",dropdownParent:"#principal-container",tags:!0,multiple:!0})]}),t.jsxs("div",{className:"col-md-4",children:[t.jsx(k,{eRef:c,label:"Nombre",required:!0}),t.jsx(be,{eRef:d,label:"Resumen",rows:3,required:!0}),t.jsx(K,{ref:W,label:"Características",structure:"",onChange:me}),t.jsx(K,{ref:Y,label:"Especificaciones",structure:{type:"",title:"",description:""},onChange:pe,typeOptions:de})]}),t.jsx("div",{className:"col-md-5",children:t.jsxs("div",{className:"row",children:[t.jsx(z,{eRef:F,label:"Banner",aspect:2/1,col:"col-12"}),t.jsx(z,{eRef:I,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),t.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[t.jsx("label",{className:"form-label",children:"Galeria"}),t.jsx("input",{id:"input-item-gallery",ref:O,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:re}),t.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"209px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>O.current.click(),onDrop:se,onDragOver:ne,children:t.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),t.jsx("div",{className:"col-md-12 col-sm-6",children:t.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:D.map((e,r)=>t.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[t.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),t.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:s=>ie(s,r),children:"×"})]},r))})})]})})]}),t.jsx("hr",{className:"my-1"}),t.jsx(we,{eRef:G,label:"Descripcion"})]}),t.jsx(U,{modalRef:L,title:"Importar Datos",size:"xl",children:t.jsx(Fe,{})})]})};Ce((p,l)=>{je(p).render(t.jsx(xe,{...l,title:"Items",children:t.jsx(Ie,{...l})}))});
