var le=Object.defineProperty;var ce=(s,n,r)=>n in s?le(s,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[n]=r;var I=(s,n,r)=>(ce(s,typeof n!="symbol"?n+"":n,r),r);import{j as e}from"./AboutHeader-Bdo2C3ON.js";import{r as u}from"./index-DFv2mRv-.js";import{c as oe}from"./ReactAppend-CwiwA4iz.js";import{C as me}from"./CreateReactScript-BWpReUmk.js";import{i as Z}from"./tippy-react.esm-BVvHiWwH.js";import{m as P}from"./main-BBbUrZUL.js";import{B as se}from"./BasicEditing-Ce9hwHaI.js";import{S as Q}from"./SwitchFormGroup-CHRdLToT.js";import{G as te}from"./Global-mC9lKANG.js";import{S as q}from"./SortByAfterField-BaS5rBg8.js";import{I as ne}from"./InputFormGroup-Di7UVG_e.js";import{S as z}from"./SelectFormGroup-BrarcXCi.js";import{S as de}from"./SetSelectValue-UxyCmHse.js";import{a as ue,M as K}from"./MenuItemContainer-BLsVxeJ-.js";import{M as he}from"./Modal-41duzYEO.js";import{G as pe}from"./GalleryRest-B3MJHER6.js";import"./index-DgyC5pTR.js";import"./index.esm-B502ZfUP.js";import"./___vite-browser-external_commonjs-proxy-BQdpDcDf.js";/* empty css               *//* empty css              */import"./General-3RJWnWe_.js";class V extends se{constructor(){super(...arguments);I(this,"path","admin/system");I(this,"savePage",async(r={})=>{try{const{status:i,result:l}=await P.Fetch(`/api/${this.path}/page`,{method:"POST",body:JSON.stringify(r)});if(!i)throw new Error((l==null?void 0:l.message)||"Ocurrio un error inesperado");return l.data??[]}catch(i){return P.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"}),null}});I(this,"updateOrder",async r=>{try{const{status:i,result:l}=await P.Fetch(`/api/${this.path}/order`,{method:"PATCH",body:JSON.stringify(r)});if(!i)throw new Error((l==null?void 0:l.message)??"Ocurrio un error inesperado");return!0}catch(i){P.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"})}});I(this,"deletePage",async r=>{try{const{status:i,result:l}=await P.Fetch(`/api/${this.path}/page/${r}`,{method:"DELETE"});if(!i)throw new Error((l==null?void 0:l.message)||"Ocurrio un error inesperado");return l.data??!0}catch(i){return P.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"}),!1}});I(this,"exportBK",async()=>{try{const{status:r,result:i}=await P.Fetch(`/api/${this.path}/backup`);if(!r)throw new Error((i==null?void 0:i.message)||"Ocurrio un error inesperado");return i}catch(r){return P.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:r.message,type:"danger"}),null}});I(this,"importBK",async r=>{try{const i=await fetch(`/api/${this.path}/backup`,{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(P.Cookies.get("XSRF-TOKEN"))},body:r}),l=JSON.parseable(await i.text());if(!i.ok)throw new Error((l==null?void 0:l.message)||"Ocurrio un error inesperado");return l??!0}catch(i){return P.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"}),null}})}}const W=(s="")=>{s=s.replace(/[^a-zA-Z0-9_{}]/g,"");const n=/{([^}]+)}/g,r=[];let i;for(;(i=n.exec(s))!==null;)r.push(i[1]);return r},fe=(s,n)=>{const r=new RegExp(`[${n}]+$`,"g");return s.replace(r,"")},G=new V,xe=s=>{const{id:n,name:r,path:i,extends_base:l=!1,menuable:m=!1,setPages:a,onSEOClicked:d,onParamsClicked:o}=s,[c,b]=u.useState(!1),[h,j]=u.useState(!1),[C,S]=u.useState(!1),[R,f]=u.useState(!1),x=async p=>{if(r===p.target.value)return b(!1);G.savePage({id:n,name:p.target.value})&&(b(!1),a(w=>w.map(v=>v.id===n?{...v,name:p.target.value}:v)))},k=async p=>{if(i===p.target.value)return j(!1);const g=p.target.value;let w=structuredClone(g);const v=s.using??{model:null,field:null,with:[]};for(const N in W(g))w=w.replace(`{${N}}`,"").replace(`{${N}?}`,""),v[N]=v[N]??{};const t=fe(w,"/");G.savePage({id:n,path:g,pseudo_path:t,using:Object.keys(v).length>0?v:void 0})&&(j(!1),a(N=>N.map(E=>E.id===n?{...E,path:p.target.value}:E)))},O=async p=>{S(!0);const g=p.target.checked,w=G.savePage({id:n,extends_base:g});S(!1),w&&a(v=>v.map(t=>t.id===n?{...t,extends_base:g}:t))},T=async p=>{f(!0);const g=p.target.checked,w=G.savePage({id:n,menuable:g});f(!1),w&&a(v=>v.map(t=>t.id===n?{...t,menuable:g}:t))},B=async p=>{await G.deletePage(p.id)&&(a(w=>w.filter(v=>v.id!=p.id)),$('[data-bs-toggle="tab"]').removeClass("active"),$(".tab-pane").removeClass("active"),$("#base-template-link").addClass("active"),$("#base-template").addClass("active"))},A=W(i);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dropdown float-end",children:[e.jsx("a",{href:"#",className:"dropdown-toggle arrow-none card-drop","data-bs-toggle":"dropdown","aria-expanded":"false",children:e.jsx("i",{className:"mdi mdi-dots-vertical"})}),e.jsxs("div",{className:"dropdown-menu dropdown-menu-end",children:[e.jsxs("button",{className:"dropdown-item",onClick:()=>d(s),children:[e.jsx("i",{className:"mdi mdi-cloud-search-outline me-1"}),"Editar SEO"]}),A.length>0&&e.jsxs("button",{className:"dropdown-item",onClick:()=>o(s),children:[e.jsx("i",{className:"mdi mdi-code-braces me-1"}),"Parámetros"]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{className:"dropdown-item",onClick:()=>B(s),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar página"]})]})]}),e.jsxs("div",{children:[c?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:r,onBlur:x,autoFocus:!0}):e.jsx(Z,{content:"Editar nombre",placement:"left",children:e.jsx("h4",{className:"header-title mb-1 d-block",onClick:()=>b(!0),style:{minWidth:"200px",cursor:"pointer"},children:r||"Sin nombre"})}),h?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:i,style:{minHeight:27,fieldSizing:"content"},onBlur:k,autoFocus:!0}):e.jsx(Z,{content:"Editar ruta",placement:"left",children:e.jsx("small",{className:"text-muted d-block mb-1",onClick:()=>j(!0),style:{minWidth:"200px",cursor:"pointer"},children:i||"Sin ruta"})})]}),e.jsxs("div",{className:"row",children:[e.jsx(Q,{label:"Extiende de base",col:"col-lg-6 col-md-12 col-sm-6",checked:l,onChange:O,disabled:C}),e.jsx(Q,{label:"Mostrar en menu",col:"col-lg-6 col-md-12 col-sm-6",checked:m,onChange:T,disabled:R})]})]})},re=({col:s,label:n,eRef:r,placeholder:i,required:l=!1,rows:m=3,value:a,onChange:d,style:o={}})=>e.jsxs("div",{className:`form-group ${s} mb-2`,children:[e.jsxs("label",{htmlFor:"",children:[n," ",l&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{ref:r,className:"form-control",placeholder:i,required:l,rows:m,defaultValue:a,style:{...o,minHeight:m*27,fieldSizing:"content"},onChange:d})]}),ae=({modalRef:s,title:n="Modal",isStatic:r=!1,size:i="md",children:l,bodyClass:m="",btnCancelText:a,btnSubmitText:d,hideFooter:o,hideButtonSubmit:c,onSubmit:b=h=>{h.preventDefault(),$(s.current).modal("hide")}})=>{const h=r?{"data-bs-backdrop":"static"}:{};return e.jsx("form",{className:"modal fade",ref:s,tabIndex:"-1","aria-hidden":"true",...h,onSubmit:b,autoComplete:"off",children:e.jsx("div",{className:`modal-dialog modal-dialog-centered modal-${i??"md"}`,children:e.jsxs("div",{className:"modal-content ",style:{boxShadow:"0 0 10px rgba(0,0,0,0.25)"},children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h4",{className:"modal-title",children:n}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:`modal-body ${m??""}`,children:l}),!o&&e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-sm btn-danger pull-left",type:"button","data-bs-dismiss":"modal",children:a??"Cerrar"}),!c&&e.jsx("button",{className:"btn btn-sm btn-success pull-right",type:"submit",children:d??"Aceptar"})]})]})})})},be=new V,ge=({dataLoaded:s,setDataLoaded:n,modalRef:r})=>{const i=u.useRef(null),l=u.useRef(null),m=u.useRef(null),a=async d=>{d.preventDefault(),await be.savePage({id:s.id,description:l.current.value,keywords:$(m.current).val()})&&(n(null),$(r.current).modal("hide"))};return u.useEffect(()=>{i.current.value=`${s==null?void 0:s.name} | ${te.APP_NAME}`,l.current.value=(s==null?void 0:s.description)??"",de(m.current,(s==null?void 0:s.keywords)??[])},[s]),e.jsx(ae,{modalRef:r,title:`Editar SEO - ${s==null?void 0:s.name}`,size:"sm",onSubmit:a,children:e.jsxs("div",{id:"seo-container",children:[e.jsx(ne,{eRef:i,label:"Título",disabled:!0}),e.jsx(re,{eRef:l,label:"Descripción",rows:2}),e.jsx(z,{eRef:m,label:"Palabras clave",tags:!0,multiple:!0,dropdownParent:"#seo-container"})]})})},L=({className:s,system:n,component:r,onComponentClicked:i,onDeleteClicked:l,onEditDataClicked:m})=>{var o;const a=(r==null?void 0:r.options)??[],d=a.find(c=>c.id==n.value);return e.jsxs("div",{className:`dropdown ${s}`,"data-id":n.id,children:[e.jsxs("div",{className:"btn btn-light dropdown-toggle text-truncate w-100 text-start",type:"button",id:`dd-${n.id}`,"data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true",children:[e.jsx("i",{className:"mdi mdi-chevron-down ms-1 float-end"}),e.jsxs("span",{className:"handle-sortable",style:{cursor:"move"},children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"})]}),e.jsx("span",{className:"ms-1",children:n.name})]}),e.jsxs("div",{className:"dropdown-menu","aria-labelledby":`dd-${n.id}`,"data-popper-placement":"bottom-start",children:[a.length>1&&e.jsxs(e.Fragment,{children:[a.filter(c=>c.id!=n.value).map(c=>e.jsxs("button",{className:"dropdown-item",onClick:()=>i({...n,name:`${r.name} - ${c.name}`,value:c.id}),children:[r.name," - ",c.name]})),e.jsx("div",{className:"dropdown-divider"})]}),(((o=d==null?void 0:d.using)==null?void 0:o.filters)||(d==null?void 0:d.data))&&e.jsxs("button",{className:"dropdown-item",onClick:()=>m(n,d),children:[e.jsx("i",{className:"mdi mdi-pencil me-1"}),"Configurar datos"]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>l(n),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar"]})]})]})},je=({col:s,label:n,eRef:r,placeholder:i,required:l=!1,rows:m=3,value:a,onChange:d=()=>{}})=>{const[o,c]=u.useState(a),b=u.useRef(),h=u.useRef(null),j=r||b;return u.useEffect(()=>(h.current&&(h.current.toTextArea(),h.current=null),h.current=CodeMirror.fromTextArea(j.current,{mode:"htmlmixed",theme:"sode",indentUnit:2,tabSize:2}),h.current.setValue(a),setTimeout(()=>{h.current.refresh()},125),h.current.on("change",C=>{const S=C.getValue();c(S),d({target:{value:S}})}),()=>{h.current&&(h.current.toTextArea(),h.current=null)}),[j]),u.useEffect(()=>{o!==a&&(c(a),h.current&&(h.current.setValue(a),setTimeout(()=>{h.current.refresh()},125)))},[a]),e.jsxs("div",{className:`form-group ${s} mb-2`,children:[e.jsxs("label",{htmlFor:"",className:"mb-1",children:[n," ",l&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{ref:j,className:"form-control",placeholder:i,required:l,rows:m,defaultValue:a,onChange:C=>c(C.target.value)})]})},ve=new V,Ne=({dataLoaded:s,setDataLoaded:n,setSystems:r,modalRef:i})=>{var o,c,b,h,j,C,S,R,f,x,k,O,T,B,A;const[l,m]=u.useState((s==null?void 0:s.data)||{}),a={};a.model=u.useRef(null),a.filters=u.useRef(null);const d=async p=>{p.preventDefault();const g=await ve.save({id:s.id,data:l,filters:$(a.filters.current).val()});g&&(n(null),$(i.current).modal("hide"),r(w=>w.map(v=>v.id==s.id?g.data:v)))};return u.useEffect(()=>{var g,w,v;const p={};(g=s==null?void 0:s.component)==null||g.data.forEach(t=>{var y;p[t]=((y=s==null?void 0:s.data)==null?void 0:y[t])??""}),m(p),a.model.current.value=((v=(w=s==null?void 0:s.component)==null?void 0:w.using)==null?void 0:v.model)??"",$(a.filters.current).val((s==null?void 0:s.filters)??[]).trigger("change")},[s]),e.jsxs(ae,{modalRef:i,title:s==null?void 0:s.name,onSubmit:d,size:(c=(o=s==null?void 0:s.component)==null?void 0:o.data)!=null&&c.some(p=>p.startsWith("code:"))?"lg":"md",children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered",children:[e.jsx("li",{className:"nav-item",hidden:!((h=(b=s==null?void 0:s.component)==null?void 0:b.data)!=null&&h.length),children:e.jsx("a",{href:"#tab-info","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link active",children:"Información"})}),e.jsx("li",{className:"nav-item",hidden:!((C=(j=s==null?void 0:s.component)==null?void 0:j.using)!=null&&C.filters),children:e.jsx("a",{href:"#tab-db","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Base de datos"})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"tab-info",hidden:!((R=(S=s==null?void 0:s.component)==null?void 0:S.data)!=null&&R.length),children:(x=(f=s==null?void 0:s.component)==null?void 0:f.data)==null?void 0:x.map((p,g)=>p.startsWith("code:")?e.jsx(je,{label:p.replace("code:",""),value:l[p]??"",rows:1,onChange:w=>m({...l,[p]:w.target.value})},g):e.jsx(re,{label:p,value:l[p]??"",rows:1,onChange:w=>m({...l,[p]:w.target.value})},g))}),e.jsxs("div",{className:"tab-pane show",id:"tab-db",children:[e.jsx(ne,{eRef:a.model,label:"Modelo",disabled:!0}),e.jsx(z,{eRef:a.filters,label:"Filtros",multiple:!0,dropdownParent:"#tab-db",hidden:!((O=(k=s==null?void 0:s.component)==null?void 0:k.using)!=null&&O.filters),children:(A=(B=(T=s==null?void 0:s.component)==null?void 0:T.using)==null?void 0:B.filters)==null?void 0:A.map((p,g)=>e.jsx("option",{value:p,children:p},g))})]})]})]})},ee=new V,we=({components:s,onClick:n})=>e.jsx("div",{className:"left-side-menu top-0 pt-2",children:e.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[e.jsx("div",{id:"sidebar-menu",className:"show",children:e.jsxs("ul",{id:"side-menu",children:[e.jsx("li",{className:"menu-title",children:"Lista de componentes"}),s.filter(r=>r.options.length>0).map((r,i)=>e.jsx(ue,{title:r.name,children:r.options.map((l,m)=>e.jsx(K,{name:l.name,icon:l.image,onClick:()=>{const a=$(".tab-pane:visible .components-container > div").last().data("id");n({name:`${r.name} - ${l.name}`,component:r.id,value:l.id,after_component:a})},children:l.name},m))},i)),e.jsx("li",{className:"menu-title",children:"Sistema de respaldo"}),e.jsx(K,{icon:"mdi mdi-cogs",rightBarToggle:!0,children:"Configuraciones"}),e.jsx(K,{icon:"mdi mdi-cloud-download",onClick:async()=>{const r=await ee.exportBK(),i=new Blob([JSON.stringify(r)],{type:"application/json"}),l=URL.createObjectURL(i),m=document.createElement("a");m.href=l,m.download="backup.json",document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(l)},children:"Exportar Backup"}),e.jsx("input",{type:"file",id:"file-input",accept:"application/json",style:{display:"none"},onChange:async r=>{const i=r.target.files[0];if(r.target.value=null,i){const l=new FormData;if(l.append("backup",i),!await ee.importBK(l))return;location.reload()}}}),e.jsx(K,{icon:"mdi mdi-backup-restore",onClick:()=>{document.getElementById("file-input").click()},children:"Importar Backup"})]})}),e.jsx("div",{className:"clearfix"})]})}),ye=({page:s,param:n,models:r,setUsing:i,setPages:l})=>{var C,S,R;const m=u.useRef(),a=u.useRef(),d=u.useRef(),o=s==null?void 0:s.using,[c,b]=u.useState(null),h=f=>{const x=m.current.value,k=r.find(O=>O.name==x)??null;b(k)};u.useEffect(()=>{var f;$(m.current).val((f=o==null?void 0:o[n])==null?void 0:f.model).trigger("change")},[n]),u.useEffect(()=>{var f,x;i(k=>({...k,[n]:{...k[n],model:(c==null?void 0:c.name)??null}})),$(a.current).val(((f=o==null?void 0:o[n])==null?void 0:f.field)??null).trigger("change"),$(d.current).val(((x=o==null?void 0:o[n])==null?void 0:x.relations)??[]).trigger("change")},[c]);const j=`${n}-container`;return e.jsxs("div",{id:j,className:"row",children:[e.jsxs("label",{className:"form-label",children:["Parámetro ",e.jsx("code",{children:n})]}),e.jsx(z,{eRef:m,label:"Modelo",col:"col-md-6",dropdownParent:`#${j}`,onChange:h,children:r.map((f,x)=>e.jsx("option",{value:f.name,children:f.name},x))}),e.jsx(z,{eRef:a,label:"Campo",col:"col-md-6",dropdownParent:`#${j}`,onChange:f=>{i(x=>({...x,[n]:{...x[n],field:f.target.value}}))},children:(C=c==null?void 0:c.fields)==null?void 0:C.map((f,x)=>e.jsx("option",{children:f},x))}),e.jsx("div",{hidden:(((S=c==null?void 0:c.relations)==null?void 0:S.length)??0)==0,children:e.jsx(z,{eRef:d,label:"Relaciones",multiple:!0,dropdownParent:`#${j}`,onChange:f=>{const x=$(f.target).val();i(k=>({...k,[n]:{...k[n],relations:x}}))},children:(R=c==null?void 0:c.relations)==null?void 0:R.map((f,x)=>e.jsx("option",{children:f},x))})})]})},$e=new V,Ce=({dataLoaded:s,setDataLoaded:n,setPages:r,modalRef:i,models:l})=>{const m=W((s==null?void 0:s.path)??""),[a,d]=u.useState({}),o=async c=>{c.preventDefault();const b=await $e.savePage({id:s.id,using:a});b&&(n(null),r(b),$(i.current).modal("hide"))};return u.useEffect(()=>{d((s==null?void 0:s.using)??{})},[s]),e.jsx(he,{modalRef:i,title:`Editar parámetros de URL - ${s==null?void 0:s.name}`,onSubmit:o,onClose:()=>n(null),children:m.map((c,b)=>e.jsx(ye,{page:s,param:c,models:l,using:a,setUsing:d,setPages:r},b))})};class Ee extends se{constructor(){super(...arguments);I(this,"path","admin/colors")}}const Se=new pe,ke=new Ee,Re=({colors:s,setColors:n})=>{const[r,i]=u.useState([{uuid:crypto.randomUUID(),col:"col-4",name:"Icon (1:1)",src:"icon.png",width:"40px"},{uuid:crypto.randomUUID(),col:"col-8",name:"Logo (13:4)",src:"logo.png",width:"130px"}]),l=async a=>{var h;const d=((h=a.target.files)==null?void 0:h[0])??null;if(!d)return;a.target.value=null;const o=a.target.name,c=new FormData;c.append("image",d),c.append("name",o),await Se.save(c)&&i(j=>j.map(C=>(C.src==o&&(C.uuid=crypto.randomUUID()),C)))},m=async a=>{const d=a.target.getAttribute("data-color-id"),o=a.target.name,c=a.target.value;if(s.find(j=>j.id==d)[o]===c)return;const h=await ke.save({id:d,[o]:c});h&&n(j=>j.map(C=>C.id==d?h.data:C))};return e.jsx("div",{className:"right-bar",children:e.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[e.jsxs("div",{className:"rightbar-title",children:[e.jsx("a",{href:"#",className:"right-bar-toggle float-end",children:e.jsx("i",{className:"mdi mdi-close"})}),e.jsx("h4",{className:"font-16 m-0 text-white",children:"Configuraciones"})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("h5",{children:"Imágenes principales"}),e.jsx("div",{className:"row",children:r.map((a,d)=>{const o="file-"+a.uuid;return e.jsxs("div",{className:a.col,children:[e.jsx("input",{id:o,name:a.src,type:"file",accept:"image/png",hidden:!0,onChange:l}),e.jsx("label",{htmlFor:o,className:"form-label d-block mb-1",style:{cursor:"pointer"},children:a.name}),e.jsx("label",{htmlFor:o,style:{cursor:"pointer"},children:e.jsx("img",{className:"border",src:`/assets/resources/${a.src}?v=${a.uuid}`,alt:"",style:{height:"40px",width:a.width,objectFit:"contain",objectPosition:"center"}})})]},d)})}),e.jsx("hr",{className:"my-2"}),e.jsx("h5",{children:"Colores del sistema"}),e.jsx("div",{className:"d-flex flex-column gap-1",children:s.map((a,d)=>e.jsxs("div",{className:"input-group input-group-sm",children:[e.jsx("span",{className:"input-group-text px-1",children:e.jsx("input",{type:"color",name:"description","data-color-id":a.id,className:"p-0",style:{width:"20px",height:"20px",border:"1px solid #ced4da",borderRadius:"4px",cursor:"pointer"},defaultValue:a.description,onBlur:m})}),e.jsx("input",{type:"text",name:"name","data-color-id":a.id,className:"form-control form-control-sm",placeholder:"Color",defaultValue:a.name,onBlur:m,disabled:a.name=="primary",style:{cursor:a.name=="primary"?"not-allowed":"text"}})]},d))})]})]})})},J=new V,Pe=({systems:s=[],pages:n=[],colors:r=[],components:i,models:l})=>{const m=u.useRef(null),a=u.useRef(null),d=u.useRef(null),[o,c]=u.useState(s),[b,h]=u.useState(n),[j,C]=u.useState(r),[S,R]=u.useState(!1),[f,x]=u.useState(null),[k,O]=u.useState(null),T=async()=>{R(!0);const t=await J.savePage();t&&(R(!1),h(t))},B=async t=>{const N=$(".tab-pane:visible").data("id")??null;t.page_id=N;const E=await J.save(t);if(!E)return;const D=E.data;c(M=>M.some(F=>F.id===D.id)?M.map(F=>F.id===D.id?D:F):[...M,D])},A=async t=>{await J.delete(t.id)&&c(N=>N.filter(E=>E.id!=t.id))};u.useEffect(()=>{document.title=`Sistema | ${te.APP_NAME}`},[null]),u.useEffect(()=>{const t=$("iframe:visible");t&&($(t).removeAttr("src"),$(t).attr("src",t.data("path")))},[o,b]);const p=t=>{const y=$(t.target).data("page-id"),N=$(t.target).data("page-path"),E=$(t.target).val();$(`#iframe-${y}`).removeAttr("src"),$(`#iframe-${y}`).attr("src",`${N}/${E}`)},g=async t=>{x(t),$(m.current).modal("show")},w=async t=>{x(t),$(a.current).modal("show")},v=async(t,y)=>{O({...t,component:y}),$(d.current).modal("show")};return u.useEffect(()=>{[...$(".components-container")].forEach(y=>{$(y).sortable({connectWith:".components-container",handle:".handle-sortable",forcePlaceholderSize:!0,update:async function(N,E){const D=[...$(y).children()],M={};if(D.forEach(H=>{const F=$(H).data("id"),_=$(H).prev().data("id")??null,U=o.find(X=>X.id==F);(U==null?void 0:U.after_component)!==_&&(M[F]=_)}),Object.keys(M).length>0){if(!await J.updateOrder(M))return;c(F=>{const _=[...F];return Object.entries(M).forEach(([U,X])=>{const Y=_.findIndex(ie=>ie.id==U);Y!==-1&&(_[Y]={..._[Y],after_component:X})}),_})}}}).disableSelection()})},[b,o]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"wrapper",children:[e.jsx(we,{components:i,onClick:B}),e.jsx("div",{className:"content-page mt-2 pb-3",style:{height:"max-content"},children:e.jsx("div",{className:"content mt-2",children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("button",{className:"button-menu-mobile d-lg-none d-md-block position-absolute ",style:{zIndex:1,border:"none",borderRadius:"0 50% 50% 0",backgroundColor:"#fff",color:"#343a40",top:"50%",left:"0",transform:"translateY(-50%)",padding:"24px 0px 20px 6px ",fontWeight:"bold"},children:"〉"}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card mb-0",children:e.jsxs("div",{className:"card-body",style:{height:"calc(100vh - 48px)"},children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered flex-nowrap",style:{overflowX:"auto",overflowY:"hidden"},children:[e.jsx("li",{className:"nav-item",children:e.jsx("a",{id:"base-template-link",href:"#base-template","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active h-100",children:"Base"})}),b.map((t,y)=>e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:`#page-${t.id}`,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link h-100",style:{whiteSpace:"nowrap"},children:[t.name,e.jsx("small",{className:"d-block text-muted",style:{fontWeight:"normal"},children:t.path})]})},y)),e.jsx("li",{className:"nav-item d-flex justify-content-center align-items-center px-2",children:e.jsx(Z,{content:"Agregar página",children:e.jsx("button",{className:"nav-link btn btn-xs btn-white rounded-pill",onClick:T,disabled:S,children:S?e.jsx("i",{className:"mdi mdi-loading mdi-spin"}):e.jsx("i",{className:"mdi mdi-plus"})})})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"base-template",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":null,children:q(o).filter(t=>t.page_id==null).map(t=>{const y=i.find(N=>N.id==t.component);if(y==null||y.options,t.component=="content")return e.jsxs("button",{"data-id":t.id,className:"btn btn-light text-truncate w-100 text-start",type:"button",children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("span",{className:"ms-1",children:t.name})]});{const N=i.find(E=>E.id==t.component);return e.jsx(L,{className:"",system:t,component:N,onComponentClicked:B,onDeleteClicked:A,onEditDataClicked:v},t.id)}})})}),e.jsx("div",{className:"col-md-8",children:e.jsx("iframe",{src:"/base-template","data-path":"/base-template",className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 185px)",borderRadius:"4px"}})})]})}),b.map((t,y)=>e.jsx("div",{className:"tab-pane",id:`page-${t.id}`,"data-id":t.id,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx(xe,{...t,models:l,setPages:h,onSEOClicked:g,onParamsClicked:w}),e.jsx("hr",{className:"my-2"}),e.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":t.id,children:q(o).filter(N=>N.page_id==t.id).map(N=>{const E=i.find(D=>D.id==N.component);return e.jsx(L,{className:"",system:N,component:E,onComponentClicked:B,onDeleteClicked:A,onEditDataClicked:v},N.id)})})]}),e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"input-group mb-2",children:[e.jsxs("span",{className:"input-group-text",children:[(t==null?void 0:t.pseudo_path)||t.path,W(t==null?void 0:t.path).length>0&&"/"]}),W(t==null?void 0:t.path).length>0&&e.jsx("input",{type:"text",className:"form-control",placeholder:"Parametros","data-page-path":t.pseudo_path,"data-page-id":t.id,onChange:p})]}),e.jsx("iframe",{id:`iframe-${t.id}`,src:(t==null?void 0:t.pseudo_path)||t.path,"data-path":(t==null?void 0:t.pseudo_path)||t.path,className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 185px)",borderRadius:"4px"}})]})]})},y))]})]})})})})]})})})]}),e.jsx(Re,{colors:j,setColors:C}),e.jsx(ge,{dataLoaded:f,setDataLoaded:x,modalRef:m}),e.jsx(Ce,{dataLoaded:f,setDataLoaded:x,setPages:h,modalRef:a,models:l}),e.jsx(Ne,{dataLoaded:k,setDataLoaded:O,setSystems:c,modalRef:d})]})};me((s,n)=>{oe(s).render(e.jsx(Pe,{...n}))});
