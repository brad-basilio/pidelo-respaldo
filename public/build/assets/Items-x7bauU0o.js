var he=Object.defineProperty;var xe=(p,l,m)=>l in p?he(p,l,{enumerable:!0,configurable:!0,writable:!0,value:m}):p[l]=m;var E=(p,l,m)=>xe(p,typeof l!="symbol"?l+"":l,m);import{j as r}from"./AboutHeader-COUW3Uy_.js";import{B as be}from"./Base-Anhozztq.js";import{S as F}from"./SwitchFormGroup-BW0W_xEc.js";import{T as je}from"./TextareaFormGroup-BkL9I0bq.js";import{r as n}from"./index-CqkZ-sT_.js";import{c as ve}from"./ReactAppend-CtUeIECI.js";import{r as O}from"./DxBox-cK5nOGfM.js";import{S as ye}from"./ProductCard-DppMoL6U.js";import"./main-MmatxeHN.js";import{B as Re}from"./ModalImportItem-DkUpH6sg.js";import{M as U}from"./Modal-BdGNjleW.js";import{T as we}from"./Table-CZMIa64L.js";import{I as z}from"./ImageFormGroup-BVKbb_oP.js";import{I as G}from"./InputFormGroup-DSD8AIIl.js";import{Q as Ne}from"./QuillFormGroup-CqyXyHxb.js";import{S as J}from"./SelectAPIFormGroup-D9R2p6Iy.js";import{S as V}from"./SelectFormGroup-CHmG_gm0.js";import{D as Q}from"./DxButton-CsjWvhyj.js";import{C as Se}from"./CreateReactScript-BzhNlYKE.js";import{N as H}from"./Number2Currency-e57Tgsuk.js";import{R as D}from"./ReactAppend-BJMiIIxq.js";import{S as X}from"./SetSelectValue-UxyCmHse.js";import"./Global-BM4Id4Pw.js";import"./tippy-react.esm-HYwDmlWP.js";import"./index-VLFqsz8m.js";/* empty css              */import"./Logout-BNXlXIaj.js";import"./MenuItemContainer-DfN03HXy.js";import"./index.esm-DfKMpHf8.js";import"./___vite-browser-external_commonjs-proxy-DA7w84js.js";/* empty css               */import"./General-BmbBKdsB.js";const K=({label:p,structure:l,onChange:m,typeOptions:h=[]})=>{const[o,x]=n.useState([]),R=()=>{x(typeof l=="object"?[...o,{...l}]:[...o,""])},j=c=>{const u=o.filter((g,i)=>i!==c);x(u),m(u)},v=(c,u,g)=>{const i=[...o];typeof i[c]=="object"?i[c][u]=g:i[c]=g,x(i),m(i)};return r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:p}),o.map((c,u)=>{const g=o.length%2!==0&&u===o.length-1;return r.jsxs("div",{className:"row g-2 mb-2",children:[typeof c=="object"?Object.keys(l).map(i=>r.jsx("div",{className:g?"col-9":"col-6",children:i==="type"?r.jsxs("select",{className:"form-select",value:c[i],onChange:d=>v(u,i,d.target.value),children:[r.jsx("option",{value:"",children:"Seleccionar..."}),h.map(d=>r.jsx("option",{value:d,children:d},d))]}):r.jsx("input",{type:"text",className:"form-control",value:c[i],onChange:d=>v(u,i,d.target.value),placeholder:i})},i)):r.jsx("div",{className:g?"col-9":"col-6",children:r.jsx("input",{type:"text",className:"form-control",value:c,onChange:i=>v(u,null,i.target.value),placeholder:"Característica"})}),r.jsx("div",{className:"col-3",children:r.jsx("button",{type:"button",className:"btn btn-danger w-100",onClick:()=>j(u),children:"X"})})]},u)}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:R,children:"+ Agregar"})]})};class W extends Re{constructor(){super(...arguments);E(this,"path","admin/items");E(this,"hasFiles",!0);E(this,"importData",async m=>{console.log("FormData recibido en importData:",[...m.entries()]);try{const h=await fetch("/api/import-items",{method:"POST",body:m}),o=await h.json();if(console.log("Respuesta del servidor:",o),!h.ok)throw new Error((o==null?void 0:o.error)??(o==null?void 0:o.message)??"Error en la importación");return o}catch(h){throw console.error("Error en importData:",h.message),h}})}}const Ce=new W,De=({gridRef:p,modalRef:l})=>{const[m,h]=n.useState(null),[o,x]=n.useState(!1),[R,j]=n.useState(""),[v,c]=n.useState(!1),u=i=>{h(i.target.files[0])},g=async()=>{var d,N;if(!m){j("Por favor, selecciona un archivo."),c(!0);return}const i=new FormData;i.append("file",m),x(!0);try{const f=await Ce.importData(i);if(console.log(f),f.error){const S=Array.isArray(f.error)?f.error.join(`
`):f.error;j(`Error en la importación:
${S}`),c(!0)}else j(f.message),c(!1),$(p.current).dxDataGrid("instance").refresh(),l.current&&l.current.close()}catch(f){j("Error al importar: "+(((N=(d=f.response)==null?void 0:d.data)==null?void 0:N.error)||f.message)),c(!0)}x(!1)};return r.jsx("div",{className:"bg-white",children:r.jsxs("div",{className:"modal-content",children:[r.jsx("div",{children:r.jsx("input",{className:"form-control",type:"file",accept:".xlsx",onChange:u})}),r.jsx("button",{onClick:g,disabled:o,className:"btn btn-primary mt-2",type:"button",children:o?"Subiendo...":"Subir Archivo"}),R&&r.jsx("div",{className:`alert ${v?"alert-danger":"alert-success"} mt-2`,role:"alert",children:r.jsx("div",{className:"alert-message",children:R})})]})})},I=new W,Fe=({categories:p,brands:l})=>{//!FALTA EDIT AND DELETEDE GALERIA
const[m,h]=n.useState([]),o=n.useRef(),x=n.useRef(),R=n.useRef(),j=n.useRef(),v=n.useRef(),c=n.useRef(),u=n.useRef(),g=n.useRef(),i=n.useRef(),d=n.useRef(),N=n.useRef(),f=n.useRef(),S=n.useRef(),A=n.useRef(),B=n.useRef(),Y=n.useRef([]),Z=n.useRef([]),[ee,P]=n.useState(!1),[re,te]=n.useState(null),[T,w]=n.useState([]),M=n.useRef(),se=e=>{const s=Array.from(e.target.files).map(a=>({file:a,url:URL.createObjectURL(a)}));w(a=>[...a,...s])},ne=e=>{e.preventDefault();const s=Array.from(e.dataTransfer.files).map(a=>({file:a,url:URL.createObjectURL(a)}));w(a=>[...a,...s])},oe=e=>{e.preventDefault()},ie=(e,t)=>{e.preventDefault(),T[t].id?w(a=>a.map((y,C)=>C===t?{...y,toDelete:!0}:y)):w(a=>a.filter((y,C)=>C!==t))};n.useEffect(()=>{if(m&&m.images){const e=m.images.map(t=>({id:t.id,url:`/storage/images/item_image/${t.url}`}));w(e)}},[m]);const L=e=>{var t,s;if(console.log(e),h(e||null),e!=null&&e.id?P(!0):P(!1),R.current.value=(e==null?void 0:e.id)||"",$(j.current).val((e==null?void 0:e.category_id)||null).trigger("change"),X(v.current,(t=e==null?void 0:e.subcategory)==null?void 0:t.id,(s=e==null?void 0:e.subcategory)==null?void 0:s.name),$(c.current).val((e==null?void 0:e.brand_id)||null).trigger("change"),u.current.value=(e==null?void 0:e.name)||"",g.current.value=(e==null?void 0:e.summary)||"",i.current.value=(e==null?void 0:e.price)||0,d.current.value=(e==null?void 0:e.discount)||0,X(N.current,(e==null?void 0:e.tags)??[],"id","name"),f.current.value=null,S.current.value=null,f.image.src=`/storage/images/item/${(e==null?void 0:e.banner)??"undefined"}`,S.image.src=`/storage/images/item/${(e==null?void 0:e.image)??"undefined"}`,A.editor.root.innerHTML=(e==null?void 0:e.description)??"",e!=null&&e.images){const a=e.images.map(y=>({id:y.id,url:`/api/items/gallery/media/${y.url}`}));w(a)}else w([]);B.current.value=e==null?void 0:e.stock,$(x.current).modal("show")},ae=async e=>{e.preventDefault();const t={id:R.current.value||void 0,category_id:j.current.value,subcategory_id:v.current.value,brand_id:c.current.value,name:u.current.value,summary:g.current.value,price:i.current.value,discount:d.current.value,tags:$(N.current).val(),description:A.current.value,sotck:B.current.value},s=new FormData;for(const b in t)s.append(b,t[b]);s.append("features",JSON.stringify(me)),s.append("specifications",JSON.stringify(pe));const a=S.current.files[0];a&&s.append("image",a);const y=f.current.files[0];y&&s.append("banner",y),T.forEach((b,q)=>{b.toDelete||(b.file?s.append(`gallery[${q}]`,b.file):s.append(`gallery_ids[${q}]`,b.id))});const C=T.filter(b=>b.toDelete).map(b=>parseInt(b.id,10));C.length>0&&s.append("deleted_images",JSON.stringify(C)),console.log(s),await I.save(s)&&($(o.current).dxDataGrid("instance").refresh(),$(x.current).modal("hide"),w([]))},le=async({id:e,value:t})=>{await I.boolean({id:e,field:"visible",value:t})&&$(o.current).dxDataGrid("instance").refresh()},k=async({id:e,field:t,value:s})=>{await I.boolean({id:e,field:t,value:s})&&$(o.current).dxDataGrid("instance").refresh()},ce=async e=>{const{isConfirmed:t}=await ye.fire({title:"Eliminar curso",text:"¿Estás seguro de eliminar este curso?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await I.delete(e)||$(o.current).dxDataGrid("instance").refresh()},[me,ue]=n.useState([]),[pe,de]=n.useState([]),fe=["General","Principal","Otro"],[Ie,Te]=n.useState(!1),_=n.useRef(),ge=()=>{$(_.current).modal("show")};return r.jsxs(r.Fragment,{children:[r.jsx(we,{gridRef:o,title:"Items",rest:I,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(o.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>L()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",text:"Importar Datos",hint:"Importar Datos",onClick:()=>ge()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:t})=>{var s,a;e.html(O(r.jsxs(r.Fragment,{children:[r.jsx("b",{className:"d-block",children:(s=t.category)==null?void 0:s.name}),r.jsx("small",{className:"text-muted",children:(a=t.subcategory)==null?void 0:a.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",width:"300px",cellTemplate:(e,{data:t})=>{e.html(O(r.jsxs(r.Fragment,{children:[r.jsx("b",{children:t.name}),r.jsx("br",{}),r.jsx("span",{className:"truncate",children:t.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:t})=>{e.html(O(r.jsxs(r.Fragment,{children:[t.discount>0&&r.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",H(t.price)]}),r.jsxs("span",{children:["S/.",H(t.discount>0?t.discount:t.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{D(e,r.jsx("img",{src:`/storage/images/item/${t.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:s=>s.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{D(e,r.jsx(F,{checked:t.is_new,onChange:s=>k({id:t.id,field:"is_new",value:s.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{D(e,r.jsx(F,{checked:t.offering,onChange:s=>k({id:t.id,field:"offering",value:s.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{D(e,r.jsx(F,{checked:t.recommended,onChange:s=>k({id:t.id,field:"recommended",value:s.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{D(e,r.jsx(F,{checked:t.featured,onChange:s=>k({id:t.id,field:"featured",value:s.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{D(e,r.jsx(F,{checked:t.visible,onChange:s=>le({id:t.id,value:s.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(Q({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>L(t)})),e.append(Q({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>ce(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(U,{modalRef:x,title:ee?"Editar curso":"Agregar curso",onSubmit:ae,size:"xl",children:[r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:R,type:"hidden"}),r.jsxs("div",{className:"col-md-3",children:[r.jsx(V,{eRef:j,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>te(e.target.value),children:p.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(J,{eRef:v,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",re],dropdownParent:"#principal-container"}),r.jsx(V,{eRef:c,label:"Marca",required:!0,dropdownParent:"#principal-container",children:l.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(G,{label:"Stock",eRef:B,type:"number"}),r.jsx(G,{eRef:i,label:"Precio",type:"number",step:"0.01",required:!0}),r.jsx(G,{eRef:d,label:"Descuento",type:"number",step:"0.01"}),r.jsx(J,{id:"tags",eRef:N,searchAPI:"/api/admin/tags/paginate",searchBy:"name",label:"Tags",dropdownParent:"#principal-container",tags:!0,multiple:!0})]}),r.jsxs("div",{className:"col-md-4",children:[r.jsx(G,{eRef:u,label:"Nombre",required:!0}),r.jsx(je,{eRef:g,label:"Resumen",rows:3,required:!0}),r.jsx(K,{ref:Y,label:"Características",structure:"",onChange:ue}),r.jsx(K,{ref:Z,label:"Especificaciones",structure:{type:"",title:"",description:""},onChange:de,typeOptions:fe})]}),r.jsx("div",{className:"col-md-5",children:r.jsxs("div",{className:"row",children:[r.jsx(z,{eRef:f,label:"Banner",aspect:2/1,col:"col-12"}),r.jsx(z,{eRef:S,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[r.jsx("label",{className:"form-label",children:"Galeria"}),r.jsx("input",{id:"input-item-gallery",ref:M,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:se}),r.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"209px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>M.current.click(),onDrop:ne,onDragOver:oe,children:r.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),r.jsx("div",{className:"col-md-12 col-sm-6",children:r.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:T.map((e,t)=>r.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[r.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),r.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:s=>ie(s,t),children:"×"})]},t))})})]})})]}),r.jsx("hr",{className:"my-1"}),r.jsx(Ne,{eRef:A,label:"Descripcion"})]}),r.jsx(U,{modalRef:_,title:"Importar Datos",size:"sm",children:r.jsx(De,{gridRef:o,modalRef:_})})]})};Se((p,l)=>{ve(p).render(r.jsx(be,{...l,title:"Items",children:r.jsx(Fe,{...l})}))});
