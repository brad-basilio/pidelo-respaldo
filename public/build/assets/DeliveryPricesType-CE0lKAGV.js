var ne=Object.defineProperty;var ce=(c,t,l)=>t in c?ne(c,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):c[t]=l;var F=(c,t,l)=>ce(c,typeof t!="symbol"?t+"":t,l);import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{r as i}from"./index-BH53Isel.js";import{c as le}from"./ReactAppend-DTVVXReZ.js";import{s as o}from"./server.browser-Bf4gQIc7.js";import{D as oe}from"./DeliveryPricesRest-CEiqxoNc.js";import"./main-BvVILmTO.js";import{B as ae}from"./BasicRest-C_0LADdJ.js";import{C as pe}from"./CreateReactScript-DXC7x6lV.js";import{S as ue}from"./ProductCard-Bvp3XiVT.js";import{B as me}from"./Base-BFtqwy-4.js";import{D as _}from"./DxButton-CsjWvhyj.js";import{M as B}from"./Modal-CIqmjseY.js";import{T as H}from"./Table-DitbKwtZ.js";import{I as f}from"./InputFormGroup-D5I6zpZc.js";import{S as fe}from"./SelectFormGroup-YqB1XVb8.js";import{S as J}from"./SwitchFormGroup-DUGhyqoj.js";import{T as de}from"./TextareaFormGroup-CdwdsTk2.js";import{C as G,N as I}from"./Number2Currency-DqtNgFrj.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./index.esm-CveLAcri.js";import"./Global-CQLDm_nT.js";/* empty css               *//* empty css              */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./tippy-react.esm-BWiGTO87.js";import"./index-rimy3MAc.js";import"./Logout-7s5dsuEK.js";import"./MenuItemContainer-BwGvRAHs.js";class he extends ae{constructor(){super(...arguments);F(this,"path","admin/types_delivery");F(this,"hasFiles",!0)}}const y=new oe,V=new he,xe=({ubigeo:c=[]})=>{const t=i.useRef(),l=i.useRef(),b=i.useRef(),A=i.useRef(),R=i.useRef(),j=i.useRef(),d=i.useRef(),w=i.useRef(),C=i.useRef(),h=i.useRef(),x=i.useRef(),N=i.useRef(),T=i.useRef(),[M,q]=i.useState(!1),[K,z]=i.useState(!1),[L,Q]=i.useState(!1),[u,D]=i.useState(!1),[g,U]=i.useState(!1),P=e=>{console.log(e),e!=null&&e.id?q(!0):q(!1),j.current.value=(e==null?void 0:e.id)??"",$(d.current).val((e==null?void 0:e.ubigeo)??null).trigger("change"),Q((e==null?void 0:e.price)===null),h.current&&(h.current.checked=(e==null?void 0:e.is_free)??!1,D((e==null?void 0:e.is_free)??!1)),x.current&&(x.current.checked=(e==null?void 0:e.is_agency)??!1,U((e==null?void 0:e.is_agency)??!1)),w.current.value=(e==null?void 0:e.price)??0,N.current.value=(e==null?void 0:e.express_price)??0,T.current.value=(e==null?void 0:e.agency_price)??0,C.current.value=(e==null?void 0:e.description)??"",$(b.current).modal("show")},W=async e=>{e.preventDefault();const s=c.find(m=>m.reniec==d.current.value),n={id:j.current.value||void 0,name:`${s.distrito}, ${s.departamento}`.toTitleCase(),price:L||u?null:w.current.value,is_free:h.current.checked,is_agency:x.current.checked,express_price:N.current.value,agency_price:T.current.value,description:C.current.value,ubigeo:d.current.value};await y.save(n)&&($(t.current).dxDataGrid("instance").refresh(),$(b.current).modal("hide"))},E=i.useRef(),S=i.useRef(),k=i.useRef(),[a,p]=i.useState([{value:""}]),X=()=>{p([...a,{value:""}])},Y=(e,s)=>{const n=[...a];n[e].value=s,p(n)},Z=e=>{if(a.length<=1)return;const s=a.filter((n,v)=>v!==e);p(s)},ee=()=>{$(A.current).modal("show")},re=e=>{e!=null&&e.id?z(!0):z(!1),E.current.value=(e==null?void 0:e.id)??"",S.current.value=(e==null?void 0:e.name)??"",k.current.value=(e==null?void 0:e.description)??"",e!=null&&e.characteristics&&e.characteristics.length>0?p(e.characteristics.map(s=>({value:s}))):p([{value:""}]),$(R.current).modal("show")},se=async e=>{e.preventDefault();const s=new FormData;s.append("name",S.current.value),s.append("description",k.current.value),K&&s.append("id",E.current.value);const n=a.map(m=>m.value.trim()).filter(m=>m.length>0);s.append("characteristics",JSON.stringify(n)),await V.save(s)&&($(l.current).dxDataGrid("instance").refresh(),$(R.current).modal("hide"),p([{value:""}]))},ie=async e=>{const{isConfirmed:s}=await ue.fire({title:"Eliminar registro",text:"¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!s||!await y.delete(e)||$(t.current).dxDataGrid("instance").refresh()},O=e=>$(o.renderToString(r.jsxs("span",{children:[r.jsx("span",{className:"d-block w-100 text-truncate",children:e.text.replace(e.id,"")}),r.jsxs("small",{className:"d-block",children:["Ubigeo: ",e.id]})]}))),te=async e=>{const s=e.target.files[0];if(!s)return;e.target.value=null;const n=new FormData;n.append("excel",s),await y.upload(n)&&$(t.current).dxDataGrid("instance").refresh()};return r.jsxs(r.Fragment,{children:[r.jsx("input",{id:"file-input",type:"file",accept:".xlsx, .xls",style:{display:"none"},onChange:te}),r.jsx(H,{gridRef:t,title:"Costos de envío",rest:y,exportable:!0,exportableName:"delivery.prices",toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",hint:"Cargar archivo Excel",onClick:()=>document.getElementById("file-input").click()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(t.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo registro",hint:"Nuevo registro",onClick:()=>P()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",text:"Actualizar datos de Delivery",hint:"Actualizar datos de Delivery",onClick:()=>ee()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"ubigeo",caption:"Ubigeo (RENIEC)",width:"150px"},{dataField:"name",caption:"Envío a",width:"200px",allowExporting:!1},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:s})=>{e.html(s.description||'<i class="text-muted">- Sin descripción -</i>')}},{dataField:"is_free",dataType:"number",caption:"Tipo Envio",cellTemplate:(e,{data:s})=>{s.is_free?e.html(o.renderToString(r.jsxs("div",{className:"d-flex gap-2",children:[r.jsx("span",{className:"text-muted font-italic",children:"Delivery Gratis"}),r.jsx("span",{className:"text-muted font-italic",children:"Delivery Express"})]}))):s.is_agency?e.html(o.renderToString(r.jsx("span",{className:"text-muted font-italic",children:"Recojo en agencia"}))):e.html(o.renderToString(r.jsx("span",{className:"text-muted font-italic",children:"Delivery"})))}},{dataField:"price",caption:"Precio",dataType:"number",width:"150px",cellTemplate:(e,{data:s})=>{s.is_free?e.html(o.renderToString(r.jsxs("div",{className:"row",children:[" ",r.jsx("span",{className:"text-muted font-italic",children:"Delivery Gratis"}),r.jsxs("span",{className:"text-muted",children:["Express:"," ",r.jsxs("span",{className:"font-monospace text-reset",children:[G(),I(s.express_price)]})]})]}))):s.price>0?e.html(o.renderToString(r.jsxs("span",{children:[G(),I(s.price)]}))):s.is_agency>0?e.html(o.renderToString(r.jsxs("span",{children:[G(),I(s.agency_price)]}))):e.text("Gratis")}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:s})=>{e.css("text-overflow","unset"),e.append(_({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>P(s)})),e.append(_({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>ie(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(B,{modalRef:b,title:M?"Editar Costo de envío":"Agregar Costo de envío",onSubmit:W,size:"md",children:[r.jsx("input",{ref:j,type:"hidden"}),r.jsxs("div",{id:"form-container",className:"row",children:[r.jsx(fe,{eRef:d,label:"Distrito/Ubigeo",templateResult:O,templateSelection:O,dropdownParent:"#form-container",required:!0,children:c.map((e,s)=>r.jsxs("option",{value:e.reniec,children:[e.reniec," ",e.distrito," ",e.provincia," ",e.departamento]},s))}),r.jsxs("div",{className:"row",children:[r.jsx(J,{eRef:h,label:"¿Delivery gratis?",col:"col-6",onChange:e=>D(e.target.checked),checked:u,refreshable:[u]}),r.jsx(J,{eRef:x,label:"¿Recogo en agencia?",col:"col-6",onChange:e=>{U(e.target.checked),D(!1)},checked:g,refreshable:[g]})]}),r.jsx("div",{className:"col-12",hidden:u||g,children:r.jsx(f,{eRef:w,label:"Costo de envío",col:"col-12",type:"number",step:.01,required:!0})}),r.jsx("div",{className:"col-12",hidden:!u,children:r.jsx(f,{eRef:N,label:"Costo de envío Express",col:"col-12",type:"number",step:.01,required:!0})}),r.jsx("div",{className:"col-12",hidden:!g,children:r.jsx(f,{eRef:T,label:"Costo de envío a Agencia",col:"col-12",type:"number",step:.01,required:!0})}),r.jsx(de,{eRef:C,label:"Descripción",rows:2})]})]}),r.jsx(B,{modalRef:A,title:"Tipos de Delivery",size:"lg",children:r.jsx(H,{gridRef:l,title:"Tipos de Delivery",rest:V,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(l.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Nombre",width:"150px",allowExporting:!1},{dataField:"description",caption:"Descripción",width:"300px",cellTemplate:(e,{data:s})=>{e.html(s.description||'<i class="text-muted">- Sin descripción -</i>')}},{dataField:"characteristics",caption:"Caracteristicas",width:"200px",cellTemplate:(e,{data:s})=>{s.characteristics&&s.characteristics.forEach(n=>{e.css("text-overflow","unset"),e.append(o.renderToString(r.jsx("li",{className:"d-flex gap-2",children:r.jsxs("i",{className:"text-muted font-italic d-block",children:["- ",n]})})))})}},{caption:"Acciones",width:"50px",cellTemplate:(e,{data:s})=>{e.css("text-overflow","unset"),e.append(_({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>re(s)}))},allowFiltering:!1,allowExporting:!1}]})}),r.jsxs(B,{modalRef:R,title:M?"Editar tipo de Delivery":"Agregar tipo de Delivery",onSubmit:se,size:"sm",children:[r.jsx("input",{ref:E,type:"hidden"}),r.jsxs("div",{id:"form-container",className:"row",children:[r.jsxs("div",{className:"col-12",children:[r.jsx(f,{eRef:S,label:"Nombre",col:"col-12",type:"string"}),r.jsx(f,{eRef:k,label:"descripcion",col:"col-12",type:"string",required:!0})]}),r.jsx("div",{className:"col-12",children:r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"Características"}),a.map((e,s)=>r.jsxs("div",{className:"input-group mb-2",children:[r.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Egresada de la Universidad Nacional Federico Villarreal.",value:e.value,onChange:n=>Y(s,n.target.value)}),r.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>Z(s),disabled:a.length<=1,children:r.jsx("i",{className:"fas fa-times"})})]},s)),r.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:X,children:[r.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]})})]})]})]})};pe((c,t)=>{le.createRoot(c).render(r.jsx(me,{...t,title:"Costos de envio",children:r.jsx(xe,{...t})}))});
