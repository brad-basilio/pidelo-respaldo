var de=Object.defineProperty;var fe=(u,c,p)=>c in u?de(u,c,{enumerable:!0,configurable:!0,writable:!0,value:p}):u[c]=p;var A=(u,c,p)=>fe(u,typeof c!="symbol"?c+"":c,p);import{j as r}from"./AboutHeader-COUW3Uy_.js";import{B as ge}from"./Base-w51uZaTk.js";import{S as v}from"./SwitchFormGroup-BW0W_xEc.js";import{T as he}from"./TextareaFormGroup-BkL9I0bq.js";import{r as n}from"./index-CqkZ-sT_.js";import{c as xe}from"./ReactAppend-CtUeIECI.js";import{r as O}from"./DxBox-cK5nOGfM.js";import{S as be}from"./ProductCard-DppMoL6U.js";import{B as je}from"./BasicEditing-BqNQNO7h.js";import{M as ve}from"./Modal-BdGNjleW.js";import{T as Re}from"./Table-CZMIa64L.js";import{I as U}from"./ImageFormGroup-BVKbb_oP.js";import{I as T}from"./InputFormGroup-DSD8AIIl.js";import{Q as ye}from"./QuillFormGroup-CqyXyHxb.js";import{S as J}from"./SelectAPIFormGroup-PC6zqttv.js";import{S as V}from"./SelectFormGroup-CHmG_gm0.js";import{D as z}from"./DxButton-CsjWvhyj.js";import{C as we}from"./CreateReactScript-tSHd-FYL.js";import{N as Q}from"./Number2Currency-e57Tgsuk.js";import{R}from"./ReactAppend-BJMiIIxq.js";import{S as H}from"./SetSelectValue-UxyCmHse.js";import"./Global-FUJSZKZw.js";import"./tippy-react.esm-HYwDmlWP.js";import"./index-VLFqsz8m.js";/* empty css              */import"./main-CkMzf7wF.js";import"./___vite-browser-external_commonjs-proxy-DA7w84js.js";import"./MenuItemContainer-BzjC1CnN.js";import"./index.esm-B6JA8xvl.js";/* empty css               */import"./General-BmbBKdsB.js";class Ce extends je{constructor(){super(...arguments);A(this,"path","admin/items");A(this,"hasFiles",!0)}}const X=({label:u,structure:c,onChange:p,typeOptions:I=[]})=>{const[d,h]=n.useState([]),y=()=>{h(typeof c=="object"?[...d,{...c}]:[...d,""])},w=a=>{const m=d.filter((o,l)=>l!==a);h(m),p(m)},b=(a,m,o)=>{const l=[...d];typeof l[a]=="object"?l[a][m]=o:l[a]=o,h(l),p(l)};return r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{children:u}),d.map((a,m)=>r.jsxs("div",{className:"d-flex flex-column mb-2",children:[typeof a=="object"?Object.keys(c).map(o=>o==="type"?r.jsxs("select",{className:"form-control mb-1",value:a[o],onChange:l=>b(m,o,l.target.value),children:[r.jsx("option",{value:"",children:"Seleccionar..."}),I.map(l=>r.jsx("option",{value:l,children:l},l))]},o):r.jsx("input",{type:"text",className:"form-control mb-1",value:a[o],onChange:l=>b(m,o,l.target.value),placeholder:o},o)):r.jsx("input",{type:"text",className:"form-control",value:a,onChange:o=>b(m,null,o.target.value),placeholder:"Característica"}),r.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>w(m),children:"X"})]},m)),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:y,children:"+ Agregar"})]})},C=new Ce,Ne=({categories:u,brands:c})=>{//!FALTA EDIT AND DELETEDE GALERIA
const[p,I]=n.useState([]),d=n.useRef(),h=n.useRef(),y=n.useRef(),w=n.useRef(),b=n.useRef(),a=n.useRef(),m=n.useRef(),o=n.useRef(),l=n.useRef(),k=n.useRef(),G=n.useRef(),N=n.useRef(),F=n.useRef(),E=n.useRef(),_=n.useRef(),B=n.useRef(),K=n.useRef([]),W=n.useRef([]),[Y,P]=n.useState(!1),[Z,ee]=n.useState(null),[S,x]=n.useState([]),q=n.useRef(),re=e=>{const s=Array.from(e.target.files).map(i=>({file:i,url:URL.createObjectURL(i)}));x(i=>[...i,...s])},te=e=>{e.preventDefault();const s=Array.from(e.dataTransfer.files).map(i=>({file:i,url:URL.createObjectURL(i)}));x(i=>[...i,...s])},se=e=>{e.preventDefault()},ne=(e,t)=>{e.preventDefault(),S[t].id?x(i=>i.map((g,j)=>j===t?{...g,toDelete:!0}:g)):x(i=>i.filter((g,j)=>j!==t))};n.useEffect(()=>{if(p&&p.images){const e=p.images.map(t=>({id:t.id,url:`/api/items/gallery/media/${t.url}`}));x(e)}},[p]);const M=e=>{var t,s;if(console.log(e),I(e||null),e!=null&&e.id?P(!0):P(!1),y.current.value=(e==null?void 0:e.id)||"",$(w.current).val((e==null?void 0:e.category_id)||null).trigger("change"),H(b.current,(t=e==null?void 0:e.subcategory)==null?void 0:t.id,(s=e==null?void 0:e.subcategory)==null?void 0:s.name),$(a.current).val((e==null?void 0:e.brand_id)||null).trigger("change"),m.current.value=(e==null?void 0:e.name)||"",o.current.value=(e==null?void 0:e.summary)||"",l.current.value=(e==null?void 0:e.price)||0,k.current.value=(e==null?void 0:e.discount)||0,H(G.current,(e==null?void 0:e.tags)??[],"id","name"),N.current.value=null,F.current.value=null,N.image.src=`/api/items/media/${(e==null?void 0:e.banner)??"undefined"}`,F.image.src=`/api/items/media/${(e==null?void 0:e.image)??"undefined"}`,E.editor.root.innerHTML=(e==null?void 0:e.description)??"",e!=null&&e.images){const i=e.images.map(g=>({id:g.id,url:`/api/items/gallery/media/${g.url}`}));x(i)}else x([]);_.current.value=e==null?void 0:e.stock,B.current.checked=!!(e!=null&&e.is_combo),$(h.current).modal("show")},ie=async e=>{e.preventDefault();const t={id:y.current.value||void 0,category_id:w.current.value,subcategory_id:b.current.value,brand_id:a.current.value,name:m.current.value,summary:o.current.value,price:l.current.value,discount:k.current.value,tags:$(G.current).val(),description:E.current.value,sotck:_.current.value,is_combo:B.current.checked?1:0},s=new FormData;for(const f in t)s.append(f,t[f]);s.append("features",JSON.stringify(ce)),s.append("specifications",JSON.stringify(me));const i=F.current.files[0];i&&s.append("image",i);const g=N.current.files[0];g&&s.append("banner",g),S.forEach((f,L)=>{f.toDelete||(f.file?s.append(`gallery[${L}]`,f.file):s.append(`gallery_ids[${L}]`,f.id))});const j=S.filter(f=>f.toDelete).map(f=>parseInt(f.id,10));j.length>0&&s.append("deleted_images",JSON.stringify(j)),await C.save(s)&&($(d.current).dxDataGrid("instance").refresh(),$(h.current).modal("hide"),x([]))},le=async({id:e,value:t})=>{await C.boolean({id:e,field:"visible",value:t})&&$(d.current).dxDataGrid("instance").refresh()},D=async({id:e,field:t,value:s})=>{await C.boolean({id:e,field:t,value:s})&&$(d.current).dxDataGrid("instance").refresh()},oe=async e=>{const{isConfirmed:t}=await be.fire({title:"Eliminar curso",text:"¿Estás seguro de eliminar este curso?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await C.delete(e)||$(d.current).dxDataGrid("instance").refresh()},[ce,ae]=n.useState([]),[me,ue]=n.useState([]),pe=["General","Principal","Otro"];return r.jsxs(r.Fragment,{children:[r.jsx(Re,{gridRef:d,title:"Items",rest:C,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(d.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo curso",hint:"Nuevo curso",onClick:()=>M()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:t})=>{var s,i;e.html(O(r.jsxs(r.Fragment,{children:[r.jsx("b",{className:"d-block",children:(s=t.category)==null?void 0:s.name}),r.jsx("small",{className:"text-muted",children:(i=t.subcategory)==null?void 0:i.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",width:"300px",cellTemplate:(e,{data:t})=>{e.html(O(r.jsxs(r.Fragment,{children:[r.jsx("b",{children:t.name}),r.jsx("br",{}),r.jsx("span",{className:"truncate",children:t.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:t})=>{e.html(O(r.jsxs(r.Fragment,{children:[t.discount>0&&r.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",Q(t.price)]}),r.jsxs("span",{children:["S/.",Q(t.discount>0?t.discount:t.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{R(e,r.jsx("img",{src:`/api/items/media/${t.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:s=>s.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{R(e,r.jsx(v,{checked:t.is_new,onChange:s=>D({id:t.id,field:"is_new",value:s.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{R(e,r.jsx(v,{checked:t.offering,onChange:s=>D({id:t.id,field:"offering",value:s.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{R(e,r.jsx(v,{checked:t.recommended,onChange:s=>D({id:t.id,field:"recommended",value:s.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{R(e,r.jsx(v,{checked:t.featured,onChange:s=>D({id:t.id,field:"featured",value:s.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{R(e,r.jsx(v,{checked:t.visible,onChange:s=>le({id:t.id,value:s.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(z({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>M(t)})),e.append(z({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>oe(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(ve,{modalRef:h,title:Y?"Editar curso":"Agregar curso",onSubmit:ie,size:"xl",children:[r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:y,type:"hidden"}),r.jsxs("div",{className:"col-md-3",children:[r.jsx(V,{eRef:w,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>ee(e.target.value),children:u.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(J,{eRef:b,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",Z],dropdownParent:"#principal-container"}),r.jsx(V,{eRef:a,label:"Marca",required:!0,dropdownParent:"#principal-container",children:c.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(T,{label:"Stock",eRef:_,type:"number"}),r.jsx(T,{eRef:l,label:"Precio",type:"number",step:"0.01",required:!0}),r.jsx(T,{eRef:k,label:"Descuento",type:"number",step:"0.01"}),r.jsx(J,{id:"tags",eRef:G,searchAPI:"/api/admin/tags/paginate",searchBy:"name",label:"Tags",dropdownParent:"#principal-container",tags:!0,multiple:!0}),r.jsx(v,{label:"Es Combo",eRef:B})]}),r.jsxs("div",{className:"col-md-4",children:[r.jsx(T,{eRef:m,label:"Nombre",required:!0}),r.jsx(he,{eRef:o,label:"Resumen",rows:3,required:!0}),r.jsx(X,{ref:K,label:"Características",structure:"",onChange:ae}),r.jsx(X,{ref:W,label:"Especificaciones",structure:{type:"",title:"",description:""},onChange:ue,typeOptions:pe})]}),r.jsx("div",{className:"col-md-5",children:r.jsxs("div",{className:"row",children:[r.jsx(U,{eRef:N,label:"Banner",aspect:2/1,col:"col-12"}),r.jsx(U,{eRef:F,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[r.jsx("label",{className:"form-label",children:"Galeria"}),r.jsx("input",{id:"input-item-gallery",ref:q,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:re}),r.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"209px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>q.current.click(),onDrop:te,onDragOver:se,children:r.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),r.jsx("div",{className:"col-md-12 col-sm-6",children:r.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:S.map((e,t)=>r.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[r.jsx("img",{src:e.url,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),r.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:s=>ne(s,t),children:"×"})]},t))})})]})})]}),r.jsx("hr",{className:"my-1"}),r.jsx(ye,{eRef:E,label:"Descripcion"})]})]})};we((u,c)=>{xe(u).render(r.jsx(ge,{...c,title:"Items",children:r.jsx(Ne,{...c})}))});
