var je=Object.defineProperty;var ve=(d,a,u)=>a in d?je(d,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):d[a]=u;var A=(d,a,u)=>ve(d,typeof a!="symbol"?a+"":a,u);import{j as r}from"./AboutHeader-ClKiNAEV.js";import{B as ye}from"./Base-0DwKrcfl.js";import{S as F}from"./SwitchFormGroup-Da1zo_US.js";import{T as Re}from"./TextareaFormGroup-CbILxKD5.js";import{r as n}from"./index-DFv2mRv-.js";import{c as we}from"./ReactAppend-D9rqaU78.js";import{r as M}from"./DxBox-BT4PRiTu.js";import{S as Ne}from"./ProductCard-NsyC22vv.js";import"./main-rZoj-gSW.js";import{B as Se}from"./ModalImportItem-DaJ_kNWW.js";import{M as V}from"./Modal-tOR4k_s7.js";import{T as Ce}from"./Table-CbTv5DyI.js";import{I as Q}from"./ImageFormGroup-DwQKq1TR.js";import{I as _}from"./InputFormGroup-C-k79te8.js";import{Q as De}from"./QuillFormGroup-K0vIs6OE.js";import{S as H}from"./SelectAPIFormGroup-DX9qyu7B.js";import{S as L}from"./SelectFormGroup-5kbg8qbb.js";import{D as X}from"./DxButton-CsjWvhyj.js";import{C as Fe}from"./CreateReactScript-DLxLAf2N.js";import{N as K}from"./Number2Currency-e57Tgsuk.js";import{R as C}from"./ReactAppend-BsNWeF6w.js";import{S as W}from"./SetSelectValue-UxyCmHse.js";import"./Global-BM4Id4Pw.js";import"./tippy-react.esm-CGYKl-Jd.js";import"./index-Sd7so-oN.js";/* empty css              */import"./Logout-CnsEv7kI.js";import"./MenuItemContainer-BV6FEyQ-.js";import"./index.esm-M1-TJtwJ.js";import"./___vite-browser-external_commonjs-proxy-BQdpDcDf.js";/* empty css               */import"./General-BmbBKdsB.js";const Y=({label:d,structure:a,onChange:u,typeOptions:f=[]})=>{const[l,p]=n.useState([]),R=()=>{p(typeof a=="object"?[...l,{...a}]:[...l,""])},v=c=>{const m=l.filter((x,o)=>o!==c);p(m),u(m)},y=(c,m,x)=>{const o=[...l];typeof o[c]=="object"?o[c][m]=x:o[c]=x,p(o),u(o)};return r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:d}),l.map((c,m)=>{const x=l.length%2!==0&&m===l.length-1;return r.jsxs("div",{className:"row g-2 mb-2",children:[typeof c=="object"?Object.keys(a).map(o=>r.jsx("div",{className:x?"col-9":"col-6",children:o==="type"?r.jsxs("select",{className:"form-select",value:c[o],onChange:g=>y(m,o,g.target.value),children:[r.jsx("option",{value:"",children:"Seleccionar..."}),f.map(g=>r.jsx("option",{value:g,children:g},g))]}):r.jsx("input",{type:"text",className:"form-control",value:c[o],onChange:g=>y(m,o,g.target.value),placeholder:o})},o)):r.jsx("div",{className:x?"col-9":"col-6",children:r.jsx("input",{type:"text",className:"form-control",value:c,onChange:o=>y(m,null,o.target.value),placeholder:"Característica"})}),r.jsx("div",{className:"col-3",children:r.jsx("button",{type:"button",className:"btn btn-danger w-100",onClick:()=>v(m),children:"X"})})]},m)}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:R,children:"+ Agregar"})]})};class Z extends Se{constructor(){super(...arguments);A(this,"path","admin/items");A(this,"hasFiles",!0);A(this,"importData",async u=>{console.log("FormData recibido en importData:",[...u.entries()]);try{const f=await fetch("/api/import-items",{method:"POST",body:u}),l=await f.json();if(console.log("Respuesta del servidor:",l),!f.ok)throw new Error((l==null?void 0:l.error)??(l==null?void 0:l.message)??"Error en la importación");return l}catch(f){throw console.error("Error en importData:",f.message),f}})}}const Ie=new Z,ke=({gridRef:d,modalRef:a})=>{const[u,f]=n.useState(null),[l,p]=n.useState(!1),[R,v]=n.useState(""),[y,c]=n.useState(!1),m=o=>{f(o.target.files[0])},x=async()=>{var g,N;if(!u){v("Por favor, selecciona un archivo."),c(!0);return}const o=new FormData;o.append("file",u),p(!0);try{const h=await Ie.importData(o);if(console.log(h),h.error){const D=Array.isArray(h.error)?h.error.join(`
`):h.error;v(`Error en la importación:
${D}`),c(!0)}else v(h.message),c(!1),$(d.current).dxDataGrid("instance").refresh(),a.current&&a.current.close()}catch(h){v("Error al importar: "+(((N=(g=h.response)==null?void 0:g.data)==null?void 0:N.error)||h.message)),c(!0)}p(!1)};return r.jsx("div",{className:"bg-white",children:r.jsxs("div",{className:"modal-content",children:[r.jsx("div",{children:r.jsx("input",{className:"form-control",type:"file",accept:".xlsx",onChange:m})}),r.jsx("button",{onClick:x,disabled:l,className:"btn btn-primary mt-2",type:"button",children:l?"Subiendo...":"Subir Archivo"}),R&&r.jsx("div",{className:`alert ${y?"alert-danger":"alert-success"} mt-2`,role:"alert",children:r.jsx("div",{className:"alert-message",children:R})})]})})},I=new Z,Te=({categories:d,brands:a,collections:u})=>{//!FALTA EDIT AND DELETEDE GALERIA
const[f,l]=n.useState([]),p=n.useRef(),R=n.useRef(),v=n.useRef(),y=n.useRef(),c=n.useRef(),m=n.useRef(),x=n.useRef(),o=n.useRef(),g=n.useRef(),N=n.useRef(),h=n.useRef(),D=n.useRef(),k=n.useRef(),T=n.useRef(),B=n.useRef(),O=n.useRef(),ee=n.useRef([]),re=n.useRef([]),[te,q]=n.useState(!1),[se,ne]=n.useState(null),[$e,oe]=n.useState(null),[E,w]=n.useState([]),U=n.useRef(),ie=e=>{const s=Array.from(e.target.files).map(i=>({file:i,url:URL.createObjectURL(i)}));w(i=>[...i,...s])},le=e=>{e.preventDefault();const s=Array.from(e.dataTransfer.files).map(i=>({file:i,url:URL.createObjectURL(i)}));w(i=>[...i,...s])},ae=e=>{e.preventDefault()},ce=(e,t)=>{e.preventDefault(),E[t].id?w(i=>i.map((b,S)=>S===t?{...b,toDelete:!0}:b)):w(i=>i.filter((b,S)=>S!==t))};n.useEffect(()=>{if(f&&f.images){const e=f.images.map(t=>({id:t.id,url:`/storage/images/item_image/${t.url}`}));w(e)}},[f]);const z=e=>{var t,s;if(console.log(e),l(e||null),e!=null&&e.id?q(!0):q(!1),v.current.value=(e==null?void 0:e.id)||"",$(y.current).val((e==null?void 0:e.category_id)||null).trigger("change"),$(c.current).val((e==null?void 0:e.collection_id)||null).trigger("change"),W(m.current,(t=e==null?void 0:e.subcategory)==null?void 0:t.id,(s=e==null?void 0:e.subcategory)==null?void 0:s.name),$(x.current).val((e==null?void 0:e.brand_id)||null).trigger("change"),o.current.value=(e==null?void 0:e.name)||"",g.current.value=(e==null?void 0:e.summary)||"",N.current.value=(e==null?void 0:e.price)||0,h.current.value=(e==null?void 0:e.discount)||0,W(D.current,(e==null?void 0:e.tags)??[],"id","name"),k.current.value=null,T.current.value=null,k.image.src=`/storage/images/item/${(e==null?void 0:e.banner)??"undefined"}`,T.image.src=`/storage/images/item/${(e==null?void 0:e.image)??"undefined"}`,B.editor.root.innerHTML=(e==null?void 0:e.description)??"",e!=null&&e.images){const i=e.images.map(b=>({id:b.id,url:`/api/items/gallery/media/${b.url}`}));w(i)}else w([]);O.current.value=e==null?void 0:e.stock,$(R.current).modal("show")},me=async e=>{e.preventDefault();const t={id:v.current.value||void 0,category_id:y.current.value,collection_id:c.current.value||null,subcategory_id:m.current.value,brand_id:x.current.value,name:o.current.value,summary:g.current.value,price:N.current.value,discount:h.current.value,tags:$(D.current).val(),description:B.current.value,sotck:O.current.value},s=new FormData;for(const j in t)s.append(j,t[j]);s.append("features",JSON.stringify(de)),s.append("specifications",JSON.stringify(ge));const i=T.current.files[0];i&&s.append("image",i);const b=k.current.files[0];b&&s.append("banner",b),E.forEach((j,J)=>{j.toDelete||(j.file?s.append(`gallery[${J}]`,j.file):s.append(`gallery_ids[${J}]`,j.id))});const S=E.filter(j=>j.toDelete).map(j=>parseInt(j.id,10));S.length>0&&s.append("deleted_images",JSON.stringify(S)),console.log(s),await I.save(s)&&($(p.current).dxDataGrid("instance").refresh(),$(R.current).modal("hide"),w([]))},ue=async({id:e,value:t})=>{await I.boolean({id:e,field:"visible",value:t})&&$(p.current).dxDataGrid("instance").refresh()},G=async({id:e,field:t,value:s})=>{await I.boolean({id:e,field:t,value:s})&&$(p.current).dxDataGrid("instance").refresh()},pe=async e=>{const{isConfirmed:t}=await Ne.fire({title:"Eliminar curso",text:"¿Estás seguro de eliminar este curso?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await I.delete(e)||$(p.current).dxDataGrid("instance").refresh()},[de,fe]=n.useState([]),[ge,he]=n.useState([]),xe=["General","Principal","Otro"],[Ee,Ge]=n.useState(!1),P=n.useRef(),be=()=>{$(P.current).modal("show")};return r.jsxs(r.Fragment,{children:[r.jsx(Ce,{gridRef:p,title:"Items",rest:I,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(p.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>z()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",text:"Importar Datos",hint:"Importar Datos",onClick:()=>be()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:t})=>{var s,i,b;e.html(M(r.jsxs(r.Fragment,{children:[r.jsx("b",{className:"d-block fst-italic text-muted",children:(s=t.collection)==null?void 0:s.name}),r.jsx("b",{className:"d-block",children:(i=t.category)==null?void 0:i.name}),r.jsx("small",{className:"text-muted",children:(b=t.subcategory)==null?void 0:b.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",width:"300px",cellTemplate:(e,{data:t})=>{e.html(M(r.jsxs(r.Fragment,{children:[r.jsx("b",{children:t.name}),r.jsx("br",{}),r.jsx("span",{className:"truncate",children:t.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:t})=>{e.html(M(r.jsxs(r.Fragment,{children:[t.discount>0&&r.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",K(t.price)]}),r.jsxs("span",{children:["S/.",K(t.discount>0?t.discount:t.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{C(e,r.jsx("img",{src:`/storage/images/item/${t.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:s=>s.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{C(e,r.jsx(F,{checked:t.is_new,onChange:s=>G({id:t.id,field:"is_new",value:s.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{C(e,r.jsx(F,{checked:t.offering,onChange:s=>G({id:t.id,field:"offering",value:s.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{C(e,r.jsx(F,{checked:t.recommended,onChange:s=>G({id:t.id,field:"recommended",value:s.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{C(e,r.jsx(F,{checked:t.featured,onChange:s=>G({id:t.id,field:"featured",value:s.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{C(e,r.jsx(F,{checked:t.visible,onChange:s=>ue({id:t.id,value:s.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(X({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>z(t)})),e.append(X({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>pe(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(V,{modalRef:R,title:te?"Editar curso":"Agregar curso",onSubmit:me,size:"xl",children:[r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:v,type:"hidden"}),r.jsxs("div",{className:"col-md-3",children:[r.jsx(L,{eRef:y,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>ne(e.target.value),children:d.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(L,{eRef:c,label:"Colección",dropdownParent:"#principal-container",onChange:e=>oe(e.target.value),children:u.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(H,{eRef:m,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",se],dropdownParent:"#principal-container"}),r.jsx(L,{eRef:x,label:"Marca",required:!0,dropdownParent:"#principal-container",children:a.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(_,{label:"Stock",eRef:O,type:"number"}),r.jsx(_,{eRef:N,label:"Precio",type:"number",step:"0.01",required:!0}),r.jsx(_,{eRef:h,label:"Descuento",type:"number",step:"0.01"}),r.jsx(H,{id:"tags",eRef:D,searchAPI:"/api/admin/tags/paginate",searchBy:"name",label:"Tags",dropdownParent:"#principal-container",tags:!0,multiple:!0})]}),r.jsxs("div",{className:"col-md-4",children:[r.jsx(_,{eRef:o,label:"Nombre",required:!0}),r.jsx(Re,{eRef:g,label:"Resumen",rows:3,required:!0}),r.jsx(Y,{ref:ee,label:"Características",structure:"",onChange:fe}),r.jsx(Y,{ref:re,label:"Especificaciones",structure:{type:"",title:"",description:""},onChange:he,typeOptions:xe})]}),r.jsx("div",{className:"col-md-5",children:r.jsxs("div",{className:"row",children:[r.jsx(Q,{eRef:k,label:"Banner",aspect:2/1,col:"col-12"}),r.jsx(Q,{eRef:T,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[r.jsx("label",{className:"form-label",children:"Galeria"}),r.jsx("input",{id:"input-item-gallery",ref:U,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:ie}),r.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"209px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>U.current.click(),onDrop:le,onDragOver:ae,children:r.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),r.jsx("div",{className:"col-md-12 col-sm-6",children:r.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:E.map((e,t)=>r.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[r.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),r.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:s=>ce(s,t),children:"×"})]},t))})})]})})]}),r.jsx("hr",{className:"my-1"}),r.jsx(De,{eRef:B,label:"Descripcion"})]}),r.jsx(V,{modalRef:P,title:"Importar Datos",size:"sm",children:r.jsx(ke,{gridRef:p,modalRef:P})})]})};Fe((d,a)=>{we(d).render(r.jsx(ye,{...a,title:"Items",children:r.jsx(Te,{...a})}))});
