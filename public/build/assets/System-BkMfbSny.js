var le=Object.defineProperty;var ce=(s,r,i)=>r in s?le(s,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[r]=i;var M=(s,r,i)=>ce(s,typeof r!="symbol"?r+"":r,i);import{j as e}from"./AboutHeader-ClKiNAEV.js";import{r as m}from"./index-DFv2mRv-.js";import{c as oe}from"./ReactAppend-D9rqaU78.js";import{C as me}from"./CreateReactScript-DK5CBHAx.js";import{i as Z}from"./tippy-react.esm-CGYKl-Jd.js";import{m as P}from"./main-rZoj-gSW.js";import{B as te}from"./ModalImportItem-DaJ_kNWW.js";import{S as q}from"./SwitchFormGroup-Da1zo_US.js";import{G as ne}from"./Global-BM4Id4Pw.js";import{S as L}from"./SortByAfterField-BaS5rBg8.js";import{I as re}from"./InputFormGroup-C-k79te8.js";import{T as ie}from"./TextareaFormGroup-CbILxKD5.js";import{M as Q}from"./Modal-tOR4k_s7.js";import{S as G}from"./SelectFormGroup-5kbg8qbb.js";import{S as ue}from"./SetSelectValue-UxyCmHse.js";import{a as de,M as K}from"./MenuItemContainer-EpS2kX4S.js";import{G as he}from"./GalleryRest-CfRUq7ye.js";import"./index-Sd7so-oN.js";import"./index.esm-BAuPgmiI.js";import"./___vite-browser-external_commonjs-proxy-BQdpDcDf.js";/* empty css               *//* empty css              */import"./General-BmbBKdsB.js";class U extends te{constructor(){super(...arguments);M(this,"path","admin/system");M(this,"savePage",async(i={})=>{try{const{status:a,result:l}=await P.Fetch(`/api/${this.path}/page`,{method:"POST",body:JSON.stringify(i)});if(!a)throw new Error((l==null?void 0:l.message)||"Ocurrio un error inesperado");return l.data??[]}catch(a){return P.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message,type:"danger"}),null}});M(this,"updateOrder",async i=>{try{const{status:a,result:l}=await P.Fetch(`/api/${this.path}/order`,{method:"PATCH",body:JSON.stringify(i)});if(!a)throw new Error((l==null?void 0:l.message)??"Ocurrio un error inesperado");return!0}catch(a){P.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message,type:"danger"})}});M(this,"deletePage",async i=>{try{const{status:a,result:l}=await P.Fetch(`/api/${this.path}/page/${i}`,{method:"DELETE"});if(!a)throw new Error((l==null?void 0:l.message)||"Ocurrio un error inesperado");return l.data??!0}catch(a){return P.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message,type:"danger"}),!1}});M(this,"exportBK",async()=>{try{const{status:i,result:a}=await P.Fetch(`/api/${this.path}/backup`);if(!i)throw new Error((a==null?void 0:a.message)||"Ocurrio un error inesperado");return a}catch(i){return P.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"}),null}});M(this,"importBK",async i=>{try{const a=await fetch(`/api/${this.path}/backup`,{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(P.Cookies.get("XSRF-TOKEN"))},body:i}),l=JSON.parseable(await a.text());if(!a.ok)throw new Error((l==null?void 0:l.message)||"Ocurrio un error inesperado");return l??!0}catch(a){return P.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message,type:"danger"}),null}})}}const W=(s="")=>{s=s.replace(/[^a-zA-Z0-9_{}]/g,"");const r=/{([^}]+)}/g,i=[];let a;for(;(a=r.exec(s))!==null;)i.push(a[1]);return i},pe=(s,r)=>{const i=new RegExp(`[${r}]+$`,"g");return s.replace(i,"")},z=new U,fe=s=>{const{id:r,name:i,path:a,extends_base:l=!1,menuable:d=!1,setPages:n,onSEOClicked:u,onParamsClicked:o}=s,[c,w]=m.useState(!1),[p,g]=m.useState(!1),[C,R]=m.useState(!1),[k,f]=m.useState(!1),x=async h=>{if(i===h.target.value)return w(!1);z.savePage({id:r,name:h.target.value})&&(w(!1),n(N=>N.map(j=>j.id===r?{...j,name:h.target.value}:j)))},S=async h=>{if(a===h.target.value)return g(!1);const b=h.target.value;let N=structuredClone(b);const j=s.using??{};for(const v of W(b))N=N.replace(`{${v}}`,"").replace(`{${v}?}`,""),j[v]=j[v]??{model:null};const t=pe(N,"/");z.savePage({id:r,path:b,pseudo_path:t,using:Object.keys(j).length>0?j:void 0})&&(g(!1),n(v=>v.map(E=>E.id===r?{...E,path:h.target.value}:E)))},F=async h=>{R(!0);const b=h.target.checked,N=z.savePage({id:r,extends_base:b});R(!1),N&&n(j=>j.map(t=>t.id===r?{...t,extends_base:b}:t))},A=async h=>{f(!0);const b=h.target.checked,N=z.savePage({id:r,menuable:b});f(!1),N&&n(j=>j.map(t=>t.id===r?{...t,menuable:b}:t))},B=async h=>{await z.deletePage(h.id)&&(n(N=>N.filter(j=>j.id!=h.id)),$('[data-bs-toggle="tab"]').removeClass("active"),$(".tab-pane").removeClass("active"),$("#base-template-link").addClass("active"),$("#base-template").addClass("active"))},T=W(a);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dropdown float-end",children:[e.jsx("a",{href:"#",className:"dropdown-toggle arrow-none card-drop","data-bs-toggle":"dropdown","aria-expanded":"false",children:e.jsx("i",{className:"mdi mdi-dots-vertical"})}),e.jsxs("div",{className:"dropdown-menu dropdown-menu-end",children:[e.jsxs("button",{className:"dropdown-item",onClick:()=>u(s),children:[e.jsx("i",{className:"mdi mdi-cloud-search-outline me-1"}),"Editar SEO"]}),T.length>0&&e.jsxs("button",{className:"dropdown-item",onClick:()=>o(s),children:[e.jsx("i",{className:"mdi mdi-code-braces me-1"}),"Parámetros"]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{className:"dropdown-item",onClick:()=>B(s),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar página"]})]})]}),e.jsxs("div",{children:[c?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:i,onBlur:x,autoFocus:!0}):e.jsx(Z,{content:"Editar nombre",placement:"left",children:e.jsx("h4",{className:"header-title mb-1 d-block",onClick:()=>w(!0),style:{minWidth:"200px",cursor:"pointer"},children:i||"Sin nombre"})}),p?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:a,style:{minHeight:27,fieldSizing:"content"},onBlur:S,autoFocus:!0}):e.jsx(Z,{content:"Editar ruta",placement:"left",children:e.jsx("small",{className:"text-muted d-block mb-1",onClick:()=>g(!0),style:{minWidth:"200px",cursor:"pointer"},children:a||"Sin ruta"})})]}),e.jsxs("div",{className:"row",children:[e.jsx(q,{label:"Extiende de base",col:"col-lg-6 col-md-12 col-sm-6",checked:l,onChange:F,disabled:C}),e.jsx(q,{label:"Mostrar en menu",col:"col-lg-6 col-md-12 col-sm-6",checked:d,onChange:A,disabled:k})]})]})},xe=new U,ge=({dataLoaded:s,setDataLoaded:r,modalRef:i})=>{const a=m.useRef(null),l=m.useRef(null),d=m.useRef(null),n=async u=>{u.preventDefault(),await xe.savePage({id:s.id,description:l.current.value,keywords:$(d.current).val()})&&(r(null),$(i.current).modal("hide"))};return m.useEffect(()=>{a.current.value=`${s==null?void 0:s.name} | ${ne.APP_NAME}`,l.current.value=(s==null?void 0:s.description)??"",ue(d.current,(s==null?void 0:s.keywords)??[])},[s]),e.jsx(Q,{modalRef:i,title:`Editar SEO - ${s==null?void 0:s.name}`,size:"sm",onSubmit:n,children:e.jsxs("div",{id:"seo-container",children:[e.jsx(re,{eRef:a,label:"Título",disabled:!0}),e.jsx(ie,{eRef:l,label:"Descripción",rows:2}),e.jsx(G,{eRef:d,label:"Palabras clave",tags:!0,multiple:!0,dropdownParent:"#seo-container"})]})})},ee=({className:s,system:r,component:i,onComponentClicked:a,onDeleteClicked:l,onEditDataClicked:d})=>{var o;const n=(i==null?void 0:i.options)??[],u=n.find(c=>c.id==r.value);return e.jsxs("div",{className:`dropdown ${s}`,"data-id":r.id,children:[e.jsxs("div",{className:"btn btn-light dropdown-toggle text-truncate w-100 text-start",type:"button",id:`dd-${r.id}`,"data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true",children:[e.jsx("i",{className:"mdi mdi-chevron-down ms-1 float-end"}),e.jsxs("span",{className:"handle-sortable",style:{cursor:"move"},children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"})]}),e.jsx("span",{className:"ms-1",children:r.name})]}),e.jsxs("div",{className:"dropdown-menu","aria-labelledby":`dd-${r.id}`,"data-popper-placement":"bottom-start",children:[n.length>1&&e.jsxs(e.Fragment,{children:[n.filter(c=>c.id!=r.value).map(c=>e.jsxs("button",{className:"dropdown-item",onClick:()=>a({...r,name:`${i.name} - ${c.name}`,value:c.id}),children:[i.name," - ",c.name]})),e.jsx("div",{className:"dropdown-divider"})]}),(((o=u==null?void 0:u.using)==null?void 0:o.filters)||(u==null?void 0:u.data))&&e.jsxs("button",{className:"dropdown-item",onClick:()=>d(r,u),children:[e.jsx("i",{className:"mdi mdi-pencil me-1"}),"Configurar datos"]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>l(r),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar"]})]})]})},be=({col:s,label:r,eRef:i,placeholder:a,required:l=!1,rows:d=3,value:n,onChange:u=()=>{}})=>{const[o,c]=m.useState(n),w=m.useRef(),p=m.useRef(null),g=i||w;return m.useEffect(()=>(p.current&&(p.current.toTextArea(),p.current=null),p.current=CodeMirror.fromTextArea(g.current,{mode:"htmlmixed",theme:"sode",indentUnit:2,tabSize:2}),p.current.setValue(n),setTimeout(()=>{p.current.refresh()},125),p.current.on("change",C=>{const R=C.getValue();c(R),u({target:{value:R}})}),()=>{p.current&&(p.current.toTextArea(),p.current=null)}),[g]),m.useEffect(()=>{o!==n&&(c(n),p.current&&(p.current.setValue(n),setTimeout(()=>{p.current.refresh()},125)))},[n]),e.jsxs("div",{className:`form-group ${s} mb-2`,children:[e.jsxs("label",{htmlFor:"",className:"mb-1",children:[r," ",l&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{ref:g,className:"form-control",placeholder:a,required:l,rows:d,defaultValue:n,onChange:C=>c(C.target.value)})]})},je=new U,ve=({dataLoaded:s,setDataLoaded:r,setSystems:i,modalRef:a})=>{var o,c,w,p,g,C,R,k,f,x,S,F,A,B,T;const[l,d]=m.useState((s==null?void 0:s.data)||{}),n={};n.model=m.useRef(null),n.filters=m.useRef(null);const u=async h=>{h.preventDefault();const b=await je.save({id:s.id,data:l,filters:$(n.filters.current).val()});b&&(r(null),$(a.current).modal("hide"),i(N=>N.map(j=>j.id==s.id?b.data:j)))};return m.useEffect(()=>{var b,N,j;const h={};(b=s==null?void 0:s.component)==null||b.data.forEach(t=>{var y;h[t]=((y=s==null?void 0:s.data)==null?void 0:y[t])??""}),d(h),n.model.current.value=((j=(N=s==null?void 0:s.component)==null?void 0:N.using)==null?void 0:j.model)??"",$(n.filters.current).val((s==null?void 0:s.filters)??[]).trigger("change")},[s]),e.jsxs(Q,{modalRef:a,title:s==null?void 0:s.name,onSubmit:u,size:(c=(o=s==null?void 0:s.component)==null?void 0:o.data)!=null&&c.some(h=>h.startsWith("code:"))?"lg":"md",children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered",children:[e.jsx("li",{className:"nav-item",hidden:!((p=(w=s==null?void 0:s.component)==null?void 0:w.data)!=null&&p.length),children:e.jsx("a",{href:"#tab-info","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link active",children:"Información"})}),e.jsx("li",{className:"nav-item",hidden:!((C=(g=s==null?void 0:s.component)==null?void 0:g.using)!=null&&C.filters),children:e.jsx("a",{href:"#tab-db","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Base de datos"})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"tab-info",hidden:!((k=(R=s==null?void 0:s.component)==null?void 0:R.data)!=null&&k.length),children:(x=(f=s==null?void 0:s.component)==null?void 0:f.data)==null?void 0:x.map((h,b)=>h.startsWith("code:")?e.jsx(be,{label:h.replace("code:",""),value:l[h]??"",rows:1,onChange:N=>d({...l,[h]:N.target.value})},b):e.jsx(ie,{label:h,value:l[h]??"",rows:1,onChange:N=>d({...l,[h]:N.target.value})},b))}),e.jsxs("div",{className:"tab-pane show",id:"tab-db",children:[e.jsx(re,{eRef:n.model,label:"Modelo",disabled:!0}),e.jsx(G,{eRef:n.filters,label:"Filtros",multiple:!0,dropdownParent:"#tab-db",hidden:!((F=(S=s==null?void 0:s.component)==null?void 0:S.using)!=null&&F.filters),children:(T=(B=(A=s==null?void 0:s.component)==null?void 0:A.using)==null?void 0:B.filters)==null?void 0:T.map((h,b)=>e.jsx("option",{value:h,children:h},b))})]})]})]})},se=new U,Ne=({components:s,onClick:r})=>e.jsx("div",{className:"left-side-menu top-0 pt-2",children:e.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[e.jsx("div",{id:"sidebar-menu",className:"show",children:e.jsxs("ul",{id:"side-menu",children:[e.jsx("li",{className:"menu-title",children:"Lista de componentes"}),s.filter(i=>i.options.length>0).map((i,a)=>e.jsx(de,{title:i.name,children:i.options.map((l,d)=>e.jsx(K,{name:l.name,icon:l.image,onClick:()=>{const n=$(".tab-pane:visible .components-container > div").last().data("id");r({name:`${i.name} - ${l.name}`,component:i.id,value:l.id,after_component:n})},children:l.name},d))},a)),e.jsx("li",{className:"menu-title",children:"Sistema de respaldo"}),e.jsx(K,{icon:"mdi mdi-cogs",rightBarToggle:!0,children:"Configuraciones"}),e.jsx(K,{icon:"mdi mdi-cloud-download",onClick:async()=>{const i=await se.exportBK(),a=new Blob([JSON.stringify(i)],{type:"application/json"}),l=URL.createObjectURL(a),d=document.createElement("a");d.href=l,d.download="backup.json",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(l)},children:"Exportar Backup"}),e.jsx("input",{type:"file",id:"file-input",accept:"application/json",style:{display:"none"},onChange:async i=>{const a=i.target.files[0];if(i.target.value=null,a){const l=new FormData;if(l.append("backup",a),!await se.importBK(l))return;location.reload()}}}),e.jsx(K,{icon:"mdi mdi-backup-restore",onClick:()=>{document.getElementById("file-input").click()},children:"Importar Backup"})]})}),e.jsx("div",{className:"clearfix"})]})}),we=({page:s,param:r,models:i,setUsing:a,setPages:l})=>{var C,R,k;const d=m.useRef(),n=m.useRef(),u=m.useRef(),o=s==null?void 0:s.using,[c,w]=m.useState(null),p=f=>{const x=d.current.value,S=i.find(F=>F.name==x)??null;w(S)};m.useEffect(()=>{var f;$(d.current).val((f=o==null?void 0:o[r])==null?void 0:f.model).trigger("change")},[r]),m.useEffect(()=>{var f,x;a(S=>({...S,[r]:{...S[r],model:(c==null?void 0:c.name)??null}})),$(n.current).val(((f=o==null?void 0:o[r])==null?void 0:f.field)??null).trigger("change"),$(u.current).val(((x=o==null?void 0:o[r])==null?void 0:x.relations)??[]).trigger("change")},[c]);const g=`${r}-container`;return e.jsxs("div",{id:g,className:"row",children:[e.jsxs("label",{className:"form-label",children:["Parámetro ",e.jsx("code",{children:r})]}),e.jsx(G,{eRef:d,label:"Modelo",col:"col-md-6",dropdownParent:`#${g}`,onChange:p,children:i.map((f,x)=>e.jsx("option",{value:f.name,children:f.name},x))}),e.jsx(G,{eRef:n,label:"Campo",col:"col-md-6",dropdownParent:`#${g}`,onChange:f=>{a(x=>({...x,[r]:{...x[r],field:f.target.value}}))},children:(C=c==null?void 0:c.fields)==null?void 0:C.map((f,x)=>e.jsx("option",{children:f},x))}),e.jsx("div",{hidden:(((R=c==null?void 0:c.relations)==null?void 0:R.length)??0)==0,children:e.jsx(G,{eRef:u,label:"Relaciones",multiple:!0,dropdownParent:`#${g}`,onChange:f=>{const x=$(f.target).val();a(S=>({...S,[r]:{...S[r],relations:x}}))},children:(k=c==null?void 0:c.relations)==null?void 0:k.map((f,x)=>e.jsx("option",{children:f},x))})})]})},ye=new U,Ce=({dataLoaded:s,setDataLoaded:r,setPages:i,modalRef:a,models:l})=>{const d=W((s==null?void 0:s.path)??""),[n,u]=m.useState({}),o=async c=>{c.preventDefault();const w=await ye.savePage({id:s.id,using:n});w&&(r(null),i(w),$(a.current).modal("hide"))};return m.useEffect(()=>{u((s==null?void 0:s.using)??{})},[s]),e.jsx(Q,{modalRef:a,title:`Editar parámetros de URL - ${s==null?void 0:s.name}`,onSubmit:o,onClose:()=>r(null),children:d.map((c,w)=>e.jsx(we,{page:s,param:c,models:l,using:n,setUsing:u,setPages:i},w))})};class $e extends te{constructor(){super(...arguments);M(this,"path","admin/colors")}}const Ee=new he,Re=new $e,Se=({colors:s,setColors:r})=>{const[i,a]=m.useState([{uuid:crypto.randomUUID(),col:"col-3",name:"Icon (1:1)",src:"icon.png",width:"100%",aspectRatio:1},{uuid:crypto.randomUUID(),col:"col-5",name:"Logo (13:4)",src:"logo.png",width:"100%",aspectRatio:3.25},{uuid:crypto.randomUUID(),col:"col-4",name:"Logo footer (1:1)",src:"logo-footer.png",width:"100%",aspectRatio:1}]),l=async n=>{var p;const u=((p=n.target.files)==null?void 0:p[0])??null;if(!u)return;n.target.value=null;const o=n.target.name,c=new FormData;c.append("image",u),c.append("name",o),await Ee.save(c)&&a(g=>g.map(C=>(C.src==o&&(C.uuid=crypto.randomUUID()),C)))},d=async n=>{const u=n.target.getAttribute("data-color-id"),o=n.target.name,c=n.target.value;if(s.find(g=>g.id==u)[o]===c)return;const p=await Re.save({id:u,[o]:c});p&&r(g=>g.map(C=>C.id==u?p.data:C))};return e.jsx("div",{className:"right-bar",style:{},children:e.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[e.jsxs("div",{className:"rightbar-title",children:[e.jsx("a",{href:"#",className:"right-bar-toggle float-end",children:e.jsx("i",{className:"mdi mdi-close"})}),e.jsx("h4",{className:"font-16 m-0 text-white",children:"Configuraciones"})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("h5",{children:"Imágenes principales"}),e.jsx("div",{className:"row",children:i.map((n,u)=>{const o="file-"+n.uuid;return e.jsxs("div",{className:n.col,children:[e.jsx("input",{id:o,name:n.src,type:"file",accept:"image/png",hidden:!0,onChange:l}),e.jsx("label",{htmlFor:o,className:"form-label d-block mb-1",style:{cursor:"pointer"},children:n.name}),e.jsx("label",{htmlFor:o,style:{cursor:"pointer"},className:"w-100",children:e.jsx("img",{className:"border",src:`/assets/resources/${n.src}?v=${n.uuid}`,alt:"",style:{height:n.height,width:n.width,objectFit:"contain",objectPosition:"center",backgroundColor:"#f5f5f5",borderRadius:"4px",aspectRatio:n.aspectRatio}})})]},u)})}),e.jsx("hr",{className:"my-2"}),e.jsx("h5",{children:"Fuentes del sistema"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"",className:"form-label mb-1",children:"Titulos"}),e.jsxs("label",{className:"input-group input-group-sm mb-1",children:[e.jsx("span",{className:"input-group-text text-end",style:{width:"75px"},children:"Nombre"}),e.jsx("input",{type:"text",className:"form-control"})]}),e.jsxs("label",{className:"input-group input-group-sm",children:[e.jsx("span",{className:"input-group-text text-end",style:{width:"75px"},children:"Enlace"}),e.jsx("textarea",{name:"",id:"",className:"form-control form-control-sm",rows:1,style:{minHeight:27,fieldSizing:"content"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",className:"form-label mb-1",children:"Parrafos"}),e.jsxs("label",{className:"input-group input-group-sm mb-1",children:[e.jsx("span",{className:"input-group-text text-end",style:{width:"75px"},children:"Nombre"}),e.jsx("input",{type:"text",className:"form-control"})]}),e.jsxs("label",{className:"input-group input-group-sm",children:[e.jsx("span",{className:"input-group-text text-end",style:{width:"75px"},children:"Enlace"}),e.jsx("textarea",{name:"",id:"",className:"form-control form-control-sm",rows:1,style:{minHeight:27,fieldSizing:"content"}})]})]}),e.jsx("hr",{className:"my-2"}),e.jsx("h5",{children:"Colores del sistema"}),e.jsx("div",{className:"d-flex flex-column gap-1",children:s.map((n,u)=>e.jsxs("div",{className:"input-group input-group-sm",children:[e.jsx("span",{className:"input-group-text px-1",children:e.jsx("input",{type:"color",name:"description","data-color-id":n.id,className:"p-0",style:{width:"20px",height:"20px",border:"1px solid #ced4da",borderRadius:"4px",cursor:"pointer"},defaultValue:n.description,onBlur:d})}),e.jsx("input",{type:"text",name:"name","data-color-id":n.id,className:"form-control form-control-sm",placeholder:"Color",defaultValue:n.name,onBlur:d,disabled:n.name=="primary",style:{cursor:n.name=="primary"?"not-allowed":"text"}})]},u))})]})]})})},J=new U,ke=({systems:s=[],pages:r=[],colors:i=[],components:a,models:l})=>{const d=m.useRef(null),n=m.useRef(null),u=m.useRef(null),[o,c]=m.useState(s),[w,p]=m.useState(r),[g,C]=m.useState(i),[R,k]=m.useState(!1),[f,x]=m.useState(null),[S,F]=m.useState(null),A=async()=>{k(!0);const t=await J.savePage();t&&(k(!1),p(t))},B=async t=>{const v=$(".tab-pane:visible").data("id")??null;t.page_id=v;const E=await J.save(t);if(!E)return;const D=E.data;c(I=>I.some(O=>O.id===D.id)?I.map(O=>O.id===D.id?D:O):[...I,D])},T=async t=>{await J.delete(t.id)&&c(v=>v.filter(E=>E.id!=t.id))};m.useEffect(()=>{document.title=`Sistema | ${ne.APP_NAME}`},[null]),m.useEffect(()=>{const t=$("iframe:visible");t&&($(t).removeAttr("src"),$(t).attr("src",t.data("path")))},[o,g]);const h=t=>{const y=$(t.target).data("page-id"),v=$(t.target).data("page-path"),E=$(t.target).val();$(`#iframe-${y}`).removeAttr("src"),$(`#iframe-${y}`).attr("src",`${v}/${E}`)},b=async t=>{x(t),$(d.current).modal("show")},N=async t=>{x(t),$(n.current).modal("show")},j=async(t,y)=>{F({...t,component:y}),$(u.current).modal("show")};return m.useEffect(()=>{[...$(".components-container")].forEach(y=>{$(y).sortable({connectWith:".components-container",handle:".handle-sortable",forcePlaceholderSize:!0,update:async function(v,E){const D=[...$(y).children()],I={};if(D.forEach(H=>{const O=$(H).data("id"),_=$(H).prev().data("id")??null,V=o.find(X=>X.id==O);(V==null?void 0:V.after_component)!==_&&(I[O]=_)}),Object.keys(I).length>0){if(!await J.updateOrder(I))return;c(O=>{const _=[...O];return Object.entries(I).forEach(([V,X])=>{const Y=_.findIndex(ae=>ae.id==V);Y!==-1&&(_[Y]={..._[Y],after_component:X})}),_})}}}).disableSelection()})},[w,o]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"wrapper",children:[e.jsx(Ne,{components:a,onClick:B}),e.jsx("div",{className:"content-page mt-2 pb-3",style:{height:"max-content"},children:e.jsx("div",{className:"content mt-2",children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("button",{className:"button-menu-mobile d-lg-none d-md-block position-absolute ",style:{zIndex:1,border:"none",borderRadius:"0 50% 50% 0",backgroundColor:"#fff",color:"#343a40",top:"50%",left:"0",transform:"translateY(-50%)",padding:"24px 0px 20px 6px ",fontWeight:"bold"},children:"〉"}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card mb-0",children:e.jsxs("div",{className:"card-body",style:{height:"calc(100vh - 48px)"},children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered flex-nowrap",style:{overflowX:"auto",overflowY:"hidden"},children:[e.jsx("li",{className:"nav-item",children:e.jsx("a",{id:"base-template-link",href:"#base-template","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active h-100",children:"Base"})}),w.map((t,y)=>e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:`#page-${t.id}`,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link h-100",style:{whiteSpace:"nowrap"},children:[t.name,e.jsx("small",{className:"d-block text-muted",style:{fontWeight:"normal"},children:t.path})]})},y)),e.jsx("li",{className:"nav-item d-flex justify-content-center align-items-center px-2",children:e.jsx(Z,{content:"Agregar página",children:e.jsx("button",{className:"nav-link btn btn-xs btn-white rounded-pill",onClick:A,disabled:R,children:R?e.jsx("i",{className:"mdi mdi-loading mdi-spin"}):e.jsx("i",{className:"mdi mdi-plus"})})})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"base-template",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":null,children:L(o).filter(t=>t.page_id==null).map(t=>{const y=a.find(v=>v.id==t.component);if(y==null||y.options,t.component=="content")return e.jsxs("button",{"data-id":t.id,className:"btn btn-light text-truncate w-100 text-start",type:"button",children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("span",{className:"ms-1",children:t.name})]},t.id);{const v=a.find(E=>E.id==t.component);return e.jsx(ee,{className:"",system:t,component:v,onComponentClicked:B,onDeleteClicked:T,onEditDataClicked:j},t.id)}})})}),e.jsx("div",{className:"col-md-8",children:e.jsx("iframe",{src:"/base-template","data-path":"/base-template",className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 185px)",borderRadius:"4px"}})})]})}),w.map((t,y)=>e.jsx("div",{className:"tab-pane",id:`page-${t.id}`,"data-id":t.id,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx(fe,{...t,models:l,setPages:p,onSEOClicked:b,onParamsClicked:N}),e.jsx("hr",{className:"my-2"}),e.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":t.id,children:L(o).filter(v=>v.page_id==t.id).map(v=>{const E=a.find(D=>D.id==v.component);return e.jsx(ee,{className:"",system:v,component:E,onComponentClicked:B,onDeleteClicked:T,onEditDataClicked:j},v.id)})})]}),e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"input-group mb-2",children:[e.jsxs("span",{className:"input-group-text",children:[(t==null?void 0:t.pseudo_path)||t.path,W(t==null?void 0:t.path).length>0&&"/"]}),W(t==null?void 0:t.path).length>0&&e.jsx("input",{type:"text",className:"form-control",placeholder:"Parametros","data-page-path":t.pseudo_path,"data-page-id":t.id,onChange:h})]}),e.jsx("iframe",{id:`iframe-${t.id}`,src:(t==null?void 0:t.pseudo_path)||t.path,"data-path":(t==null?void 0:t.pseudo_path)||t.path,className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 185px)",borderRadius:"4px"}})]})]})},y))]})]})})})})]})})})]}),e.jsx(Se,{colors:g,setColors:C}),e.jsx(ge,{dataLoaded:f,setDataLoaded:x,modalRef:d}),e.jsx(Ce,{dataLoaded:f,setDataLoaded:x,setPages:p,modalRef:n,models:l}),e.jsx(ve,{dataLoaded:S,setDataLoaded:F,setSystems:c,modalRef:u})]})};me((s,r)=>{oe(s).render(e.jsx(ke,{...r}))});
