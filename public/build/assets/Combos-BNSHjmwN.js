var O=Object.defineProperty;var z=(o,r,c)=>r in o?O(o,r,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[r]=c;var T=(o,r,c)=>z(o,typeof r!="symbol"?r+"":r,c);import{j as t}from"./AboutSimple-Cf8x2fCZ.js";import{B as H}from"./Base-BFtqwy-4.js";import{S as J}from"./SwitchFormGroup-DUGhyqoj.js";import{r as a}from"./index-BH53Isel.js";import{c as K}from"./ReactAppend-DTVVXReZ.js";import{s as D}from"./server.browser-Bf4gQIc7.js";import{S as P}from"./ProductCard-Bvp3XiVT.js";import{M as L}from"./Modal-CIqmjseY.js";import{T as Q}from"./Table-DitbKwtZ.js";import{I as C}from"./InputFormGroup-D5I6zpZc.js";import{S as U}from"./SelectAPIFormGroup-BYWbn4kr.js";import{D as F}from"./DxButton-DV0H-ZcL.js";import{C as W}from"./CreateReactScript-DXC7x6lV.js";import{C as y,N as B}from"./Number2Currency-DqtNgFrj.js";import{R as X}from"./ReactAppend-D7S498fx.js";import"./main-BvVILmTO.js";import{B as Y}from"./BasicRest-C_0LADdJ.js";import"./index-yBjzXJbu.js";import"./Global-CQLDm_nT.js";import"./tippy-react.esm-BWiGTO87.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-7s5dsuEK.js";import"./MenuItemContainer-BwGvRAHs.js";import"./index.esm-CveLAcri.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";class Z extends Y{constructor(){super(...arguments);T(this,"path","admin/combos")}}const b=new Z,ee=({items:o})=>{const[r,c]=a.useState([]),[l,g]=a.useState(null),[u,S]=a.useState(0),p=a.useRef(),R=a.useRef(),v=a.useRef(),j=a.useRef(),f=a.useRef(),m=a.useRef(),x=a.useRef(),[I,N]=a.useState(!1),_=e=>e.reduce((s,i)=>{const n=parseFloat(i.final_price||0);return s+n},0);a.useEffect(()=>{const e=_(r);console.log(e),S(e)},[r]),a.useEffect(()=>{f.current&&(f.current.value=u.toFixed(2))},[u]),a.useEffect(()=>{if(x.current){const e=r.map(s=>s.id.toString());$(x.current).val(e).trigger("change")}},[r]);const k=e=>{const i=$(e.target).select2("data").map(n=>n.data);c(n=>{const w=n.map(h=>h.id),d=i.filter(h=>!w.includes(h.id));return[...n,...d]})},G=e=>{const s=r.filter(n=>n.id!==e);c(s);const i=s.map(n=>n.id.toString());$(x.current).val(i).trigger("change"),(l==null?void 0:l.id)===e&&g(null)},A=e=>{parseFloat(e.target.value||0)>u&&(P.fire("Error","El precio con descuento no puede ser mayor al precio acumulado.","error"),m.current.value="")},E=async e=>{var s;if(e!=null&&e.id){N(!0);const i=await b.get(e.id,["items"]);if(!i)return;v.current.value=i.id||"",j.current.value=i.name||"",f.current.value=i.price||0,m.current.value=i.discount||0;const n=i.items||[];c(n),setTimeout(()=>{const d=n.map(h=>h.id.toString());x.current.setValue(d)},0);const w=(s=i.items.find(d=>d.pivot.is_main_item))==null?void 0:s.id;w&&g(n.find(d=>d.id===w))}else N(!1),v.current.value="",j.current.value="",f.current.value=0,m.current.value=0;$(R.current).modal("show")},M=async e=>{e.preventDefault();const s={id:v.current.value||void 0,name:j.current.value,price:u,discount:m.current.value,final_price:m.current.value>0&&m.current.value<u?m.current.value:u,discount_percent:100-m.current.value/f.current.value*100,items:r.map(n=>({item_id:n.id,is_main_item:(l==null?void 0:l.id)===n.id}))};await b.save(s)&&($(p.current).dxDataGrid("instance").refresh(),$(R.current).modal("hide"),c([]),g(null),S(0))},V=async({id:e,value:s})=>{await b.boolean({id:e,field:"visible",value:s})&&$(p.current).dxDataGrid("instance").refresh()},q=async e=>{const{isConfirmed:s}=await P.fire({title:"Eliminar curso",text:"¿Estás seguro de eliminar este curso?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!s||!await b.delete(e)||$(p.current).dxDataGrid("instance").refresh()};return t.jsxs(t.Fragment,{children:[t.jsx(Q,{gridRef:p,title:"Combos",rest:b,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(p.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo combo",hint:"Nuevo combo",onClick:()=>E()}})},exportable:!0,exportableName:"Combos",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Nombre",cellTemplate:(e,{data:s})=>{e.html(D.renderToString(t.jsxs(t.Fragment,{children:[t.jsx("b",{children:s.name}),t.jsx("br",{}),t.jsx("span",{className:"truncate",children:s.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:s})=>{e.html(D.renderToString(t.jsxs(t.Fragment,{children:[s.discount>0&&t.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:[y()," ",B(s.price)]}),t.jsxs("span",{children:[y()," ",B(s.discount>0?s.discount:s.price)]})]})))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:s})=>{X(e,t.jsx(J,{checked:s.visible,onChange:i=>V({id:s.id,value:i.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:s})=>{e.css("text-overflow","unset"),e.append(F({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>E(s)})),e.append(F({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>q(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsx(L,{modalRef:R,title:I?"Editar curso":"Agregar curso",onSubmit:M,size:"lg",children:t.jsxs("div",{className:"row",id:"combo-container",children:[t.jsx("input",{ref:v,type:"hidden"}),t.jsxs("div",{className:"col-md-6",children:[t.jsx(C,{eRef:j,label:"Nombre",required:!0}),t.jsx(U,{id:"items",eRef:x,searchAPI:"/api/admin/items/paginate",searchBy:"name",label:"Productos",dropdownParent:"#combo-container",multiple:!0,onChange:k})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx(C,{label:"Precio",eRef:f,type:"number",readOnly:!0}),t.jsx(C,{eRef:m,label:"Descuento",type:"number",step:"0.01",onChange:A})]}),t.jsxs("div",{className:"col-md-12 row",children:[t.jsx("h4",{className:"col-md-12",children:"Productos Seleccionados"}),t.jsx("ul",{className:"list-unstyled col-md-12 row",children:r.map(e=>t.jsxs("li",{className:"col-md-6",children:[t.jsx("input",{type:"radio",name:"mainProduct",checked:(l==null?void 0:l.id)===e.id,onChange:()=>g(e)}),t.jsx("div",{children:t.jsx("div",{class:"card mb-3",children:t.jsxs("div",{class:"row g-0",children:[t.jsx("div",{class:"col-md-4",children:t.jsx("img",{src:`/storage/images/item/${(e==null?void 0:e.image)??"undefined"}`,class:"img-thumbnail rounded-start",alt:e.name})}),t.jsx("div",{class:"col-md-8",children:t.jsxs("div",{class:"card-body",children:[t.jsxs("h5",{class:"card-title",children:[e==null?void 0:e.name," "]}),t.jsxs("p",{class:"card-text small line-clamp-2",children:[e==null?void 0:e.summary," "]}),t.jsx("p",{class:"card-text",children:t.jsxs("strong",{children:["Precio: ",y(),e==null?void 0:e.final_price]})}),t.jsx("button",{className:"btn btn-sm btn-danger pull-left",type:"button",onClick:()=>G(e.id),children:"Eliminar"})]})})]})})})]},e.id))})]})]})})]})};W((o,r)=>{K.createRoot(o).render(t.jsx(H,{...r,title:"Combos",children:t.jsx(ee,{...r})}))});
