import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{B as Re}from"./Base-Bx9xWe1P.js";import{S as I}from"./SwitchFormGroup-DUGhyqoj.js";import{T as ye}from"./TextareaFormGroup-CdwdsTk2.js";import{r as n}from"./index-BH53Isel.js";import{c as we}from"./ReactAppend-DTVVXReZ.js";import{s as q}from"./server.browser-Bf4gQIc7.js";import{S as Se}from"./ProductCard-erObE6pO.js";import{I as re}from"./ItemsRest-DWb8q5UA.js";import{M as W}from"./Modal-CIqmjseY.js";import{T as Ce}from"./Table-CP679pea.js";import{I as L}from"./ImageFormGroup-BPR9pDAU.js";import{I as D}from"./InputFormGroup-D5I6zpZc.js";import{Q as Ne}from"./QuillFormGroup-D8zDHSfJ.js";import{S as X}from"./SelectAPIFormGroup-BYWbn4kr.js";import{S as U}from"./SelectFormGroup-YqB1XVb8.js";import{D as K}from"./DxButton-DV0H-ZcL.js";import{C as Fe}from"./CreateReactScript-D1akKh24.js";import{N as Y}from"./Number2Currency-e57Tgsuk.js";import{R as N}from"./ReactAppend-D7S498fx.js";import{S as Z}from"./SetSelectValue-UxyCmHse.js";import"./main-BvVILmTO.js";import"./index-yBjzXJbu.js";import"./Global-CklCDfn9.js";import"./tippy-react.esm-BWiGTO87.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-LH3dzJpV.js";import"./MenuItemContainer-BwGvRAHs.js";import"./index.esm-CveLAcri.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./BasicRest-C_0LADdJ.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";const ee=({label:y,structure:g,onChange:w,typeOptions:j=[]})=>{const[p,a]=n.useState([]),v=()=>{a(typeof g=="object"?[...p,{...g}]:[...p,""])},x=i=>{const c=p.filter((d,l)=>l!==i);a(c),w(c)},b=(i,c,d)=>{const l=[...p];typeof l[i]=="object"?l[i][c]=d:l[i]=d,a(l),w(l)};return r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:y}),p.map((i,c)=>{const d=p.length%2!==0&&c===p.length-1;return r.jsxs("div",{className:"row g-2 mb-2",children:[typeof i=="object"?Object.keys(g).map(l=>r.jsx("div",{className:d?"col-9":"col-6",children:l==="type"?r.jsxs("select",{className:"form-select",value:i[l],onChange:m=>b(c,l,m.target.value),children:[r.jsx("option",{value:"",children:"Seleccionar..."}),j.map(m=>r.jsx("option",{value:m,children:m},m))]}):r.jsx("input",{type:"text",className:"form-control",value:i[l],onChange:m=>b(c,l,m.target.value),placeholder:l})},l)):r.jsx("div",{className:d?"col-9":"col-6",children:r.jsx("input",{type:"text",className:"form-control",value:i,onChange:l=>b(c,null,l.target.value),placeholder:"Característica"})}),r.jsx("div",{className:"col-3",children:r.jsx("button",{type:"button",className:"btn btn-danger w-100",onClick:()=>x(c),children:"X"})})]},c)}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:v,children:"+ Agregar"})]})},Ie=new re,De=({gridRef:y,modalRef:g})=>{const[w,j]=n.useState(null),[p,a]=n.useState(!1),[v,x]=n.useState(""),[b,i]=n.useState(!1),c=l=>{j(l.target.files[0])},d=async()=>{var m,S;if(!w){x("Por favor, selecciona un archivo."),i(!0);return}const l=new FormData;l.append("file",w),a(!0);try{const u=await Ie.importData(l);if(console.log(u),u.error){const F=Array.isArray(u.error)?u.error.join(`
`):u.error;x(`Error en la importación:
${F}`),i(!0)}else x(u.message),i(!1),$(y.current).dxDataGrid("instance").refresh(),g.current&&g.current.close()}catch(u){x("Error al importar: "+(((S=(m=u.response)==null?void 0:m.data)==null?void 0:S.error)||u.message)),i(!0)}a(!1)};return r.jsx("div",{className:"bg-white",children:r.jsxs("div",{className:"modal-content",children:[r.jsx("div",{children:r.jsx("input",{className:"form-control",type:"file",accept:".xlsx",onChange:c})}),r.jsx("button",{onClick:d,disabled:p,className:"btn btn-primary mt-2",type:"button",children:p?"Subiendo...":"Subir Archivo"}),v&&r.jsx("div",{className:`alert ${b?"alert-danger":"alert-success"} mt-2`,role:"alert",children:r.jsx("div",{className:"alert-message",children:v})})]})})},T=new re,Te=({categories:y,brands:g,collections:w})=>{//!FALTA EDIT AND DELETEDE GALERIA
const[j,p]=n.useState([]),a=n.useRef(),v=n.useRef(),x=n.useRef(),b=n.useRef(),i=n.useRef(),c=n.useRef(),d=n.useRef(),l=n.useRef(),m=n.useRef(),S=n.useRef(),u=n.useRef(),F=n.useRef(),A=n.useRef(),k=n.useRef(),E=n.useRef(),B=n.useRef(),O=n.useRef(),P=n.useRef(),te=n.useRef([]),se=n.useRef([]),[ne,z]=n.useState(!1),[le,oe]=n.useState(null),[ke,ie]=n.useState(null),[G,R]=n.useState([]),J=n.useRef(),ce=e=>{const s=Array.from(e.target.files).map(o=>({file:o,url:URL.createObjectURL(o)}));R(o=>[...o,...s])},ae=e=>{e.preventDefault();const s=Array.from(e.dataTransfer.files).map(o=>({file:o,url:URL.createObjectURL(o)}));R(o=>[...o,...s])},me=e=>{e.preventDefault()},ue=(e,t)=>{e.preventDefault(),G[t].id?R(o=>o.map((f,C)=>C===t?{...f,toDelete:!0}:f)):R(o=>o.filter((f,C)=>C!==t))};n.useEffect(()=>{if(j&&j.images){const e=j.images.map(t=>({id:t.id,url:`/storage/images/item_image/${t.url}`}));R(e)}},[j]);const V=e=>{var t,s;if(console.log(e),p(e||null),e!=null&&e.id?z(!0):z(!1),x.current.value=(e==null?void 0:e.id)||"",$(b.current).val((e==null?void 0:e.category_id)||null).trigger("change"),$(i.current).val((e==null?void 0:e.collection_id)||null).trigger("change"),Z(c.current,(t=e==null?void 0:e.subcategory)==null?void 0:t.id,(s=e==null?void 0:e.subcategory)==null?void 0:s.name),$(d.current).val((e==null?void 0:e.brand_id)||null).trigger("change"),l.current.value=(e==null?void 0:e.name)||"",m.current.value=(e==null?void 0:e.color)||"",S.current.value=(e==null?void 0:e.summary)||"",u.current.value=(e==null?void 0:e.price)||0,F.current.value=(e==null?void 0:e.discount)||0,Z(A.current,(e==null?void 0:e.tags)??[],"id","name"),k.current.value=null,E.current.value=null,k.image.src=`/storage/images/item/${(e==null?void 0:e.banner)??"undefined"}`,E.image.src=`/storage/images/item/${(e==null?void 0:e.image)??"undefined"}`,B.image.src=`/storage/images/item/${(e==null?void 0:e.texture)??"undefined"}`,O.editor.root.innerHTML=(e==null?void 0:e.description)??"",e!=null&&e.images){const o=e.images.map(f=>({id:f.id,url:`/api/items/gallery/media/${f.url}`}));R(o)}else R([]);P.current.value=e==null?void 0:e.stock,$(v.current).modal("show")},pe=async e=>{e.preventDefault();const t={id:x.current.value||void 0,category_id:b.current.value,collection_id:i.current.value||null,subcategory_id:c.current.value,brand_id:d.current.value,name:l.current.value,color:m.current.value,summary:S.current.value,price:u.current.value,discount:F.current.value,tags:$(A.current).val(),description:O.current.value,sotck:P.current.value},s=new FormData;for(const h in t)s.append(h,t[h]);s.append("features",JSON.stringify(ge)),s.append("specifications",JSON.stringify(xe));const o=E.current.files[0];o&&s.append("image",o);const f=B.current.files[0];f&&s.append("texture",f);const C=k.current.files[0];C&&s.append("banner",C),G.forEach((h,H)=>{h.toDelete||(h.file?s.append(`gallery[${H}]`,h.file):s.append(`gallery_ids[${H}]`,h.id))});const Q=G.filter(h=>h.toDelete).map(h=>parseInt(h.id,10));Q.length>0&&s.append("deleted_images",JSON.stringify(Q)),console.log(s),await T.save(s)&&($(a.current).dxDataGrid("instance").refresh(),$(v.current).modal("hide"),R([]))},de=async({id:e,value:t})=>{await T.boolean({id:e,field:"visible",value:t})&&$(a.current).dxDataGrid("instance").refresh()},_=async({id:e,field:t,value:s})=>{await T.boolean({id:e,field:t,value:s})&&$(a.current).dxDataGrid("instance").refresh()},fe=async e=>{const{isConfirmed:t}=await Se.fire({title:"Eliminar curso",text:"¿Estás seguro de eliminar este curso?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await T.delete(e)||$(a.current).dxDataGrid("instance").refresh()},[ge,he]=n.useState([]),[xe,be]=n.useState([]),je=["General","Principal","Otro"],[$e,Ee]=n.useState(!1),M=n.useRef(),ve=()=>{$(M.current).modal("show")};return r.jsxs(r.Fragment,{children:[r.jsx(Ce,{gridRef:a,title:"Items",rest:T,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(a.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>V()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",text:"Importar Datos",hint:"Importar Datos",onClick:()=>ve()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:t})=>{var s,o,f;e.html(q.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{className:"d-block fst-italic text-muted",children:(s=t.collection)==null?void 0:s.name}),r.jsx("b",{className:"d-block",children:(o=t.category)==null?void 0:o.name}),r.jsx("small",{className:"text-muted",children:(f=t.subcategory)==null?void 0:f.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",minWidth:"300px",cellTemplate:(e,{data:t})=>{e.html(q.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{children:t.name}),r.jsx("br",{}),r.jsx("span",{className:"truncate",children:t.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:t})=>{e.html(q.renderToString(r.jsxs(r.Fragment,{children:[t.discount>0&&r.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",Y(t.price)]}),r.jsxs("span",{children:["S/.",Y(t.discount>0?t.discount:t.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{N(e,r.jsx("img",{src:`/storage/images/item/${t.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:s=>s.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{N(e,r.jsx(I,{checked:t.is_new,onChange:s=>_({id:t.id,field:"is_new",value:s.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{N(e,r.jsx(I,{checked:t.offering,onChange:s=>_({id:t.id,field:"offering",value:s.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{N(e,r.jsx(I,{checked:t.recommended,onChange:s=>_({id:t.id,field:"recommended",value:s.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{N(e,r.jsx(I,{checked:t.featured,onChange:s=>_({id:t.id,field:"featured",value:s.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{N(e,r.jsx(I,{checked:t.visible,onChange:s=>de({id:t.id,value:s.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(K({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>V(t)})),e.append(K({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>fe(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(W,{modalRef:v,title:ne?"Editar curso":"Agregar curso",onSubmit:pe,size:"xl",children:[r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:x,type:"hidden"}),r.jsxs("div",{className:"col-md-3",children:[r.jsx(U,{eRef:b,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>oe(e.target.value),children:y.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(U,{eRef:i,label:"Colección",dropdownParent:"#principal-container",onChange:e=>ie(e.target.value),children:w.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(X,{eRef:c,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",le],dropdownParent:"#principal-container"}),r.jsx(U,{eRef:d,label:"Marca",required:!0,dropdownParent:"#principal-container",children:g.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(D,{label:"Stock",eRef:P,type:"number"}),r.jsx(D,{eRef:u,label:"Precio",type:"number",step:"0.01",required:!0}),r.jsx(D,{eRef:F,label:"Descuento",type:"number",step:"0.01"}),r.jsx(X,{id:"tags",eRef:A,searchAPI:"/api/admin/tags/paginate",searchBy:"name",label:"Tags",dropdownParent:"#principal-container",tags:!0,multiple:!0})]}),r.jsxs("div",{className:"col-md-4",children:[r.jsx(D,{eRef:l,label:"Nombre",required:!0}),r.jsx(D,{eRef:m,label:"Color",required:!0}),r.jsx(L,{eRef:B,label:"Imagen Textura",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsx(ye,{eRef:S,label:"Resumen",rows:3,required:!0}),r.jsx(ee,{ref:te,label:"Características",structure:"",onChange:he}),r.jsx(ee,{ref:se,label:"Especificaciones",structure:{type:"",title:"",description:""},onChange:be,typeOptions:je})]}),r.jsx("div",{className:"col-md-5",children:r.jsxs("div",{className:"row",children:[r.jsx(L,{eRef:k,label:"Banner",aspect:2/1,col:"col-12"}),r.jsx(L,{eRef:E,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[r.jsx("label",{className:"form-label",children:"Galeria"}),r.jsx("input",{id:"input-item-gallery",ref:J,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:ce}),r.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"209px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>J.current.click(),onDrop:ae,onDragOver:me,children:r.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),r.jsx("div",{className:"col-md-12 col-sm-6",children:r.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:G.map((e,t)=>r.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[r.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),r.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:s=>ue(s,t),children:"×"})]},t))})})]})})]}),r.jsx("hr",{className:"my-1"}),r.jsx(Ne,{eRef:O,label:"Descripcion"})]}),r.jsx(W,{modalRef:M,title:"Importar Datos",size:"sm",children:r.jsx(De,{gridRef:a,modalRef:M})})]})};Fe((y,g)=>{we.createRoot(y).render(r.jsx(Re,{...g,title:"Items",children:r.jsx(Te,{...g})}))});
