import{j as t}from"./AboutHeader-ClKiNAEV.js";import{r as c,R as _}from"./index-DFv2mRv-.js";import"./ProductCard-NsyC22vv.js";import{I as T}from"./ItemsRest-ei1fmHEM.js";import"./HeaderSearch-C6xLnU5a.js";import"./main-rZoj-gSW.js";import{L as U}from"./Loading-O_y8BNFU.js";import{N as G}from"./NoResult-BasQTFzm.js";import{S as H}from"./SelectForm-Ckz_d_he.js";import{P as J}from"./ProductCardSimple-BWc0etaM.js";import{C as v}from"./chevron-down-Bgb5hLdB.js";import{C as S,a as k}from"./chevron-right--XtiYjfH.js";import"./ModalImportItem-Cwh6n2ot.js";import"./index-BOPJobjj.js";import"./index-Sd7so-oN.js";import"./index-Cevqm-zP.js";import"./CartItemRow-BRRZMnl0.js";import"./tippy-react.esm-CGYKl-Jd.js";import"./Number2Currency-e57Tgsuk.js";import"./minus-C_LiTw_8.js";import"./createLucideIcon-CC2OGGjd.js";import"./plus-DqVREqgL.js";import"./___vite-browser-external_commonjs-proxy-BQdpDcDf.js";import"./search-BlyVC63b.js";import"./check-sPmXvS3y.js";const Q=new T,ve=({items:W,data:x,filteredData:$,cart:L,setCart:R})=>{const{collections:d,priceRanges:f}=$||{collections:[],priceRanges:[]},[g,F]=c.useState([]),[u,M]=c.useState([]),[h,I]=c.useState({collection:!0,marca:!0,precio:!0,categoria:!0,colores:!1}),[l,p]=c.useState({collection_id:[],category_id:[],brand_id:[],subcategory_id:[],price:null,name:null,sort:[{selector:"created_at",desc:!0}]}),[b,A]=c.useState([]),[E,y]=c.useState(!1),[a,B]=c.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:21,from:0,to:0}),K=e=>{const s=[];if(e.collection_id.length>0){const r=e.collection_id.map(n=>["collection_id","=",n]);s.push(["or",...r])}if(e.category_id.length>0){const r=e.category_id.map(n=>["category_id","=",n]);s.push(["or",...r])}if(e.subcategory_id.length>0){const r=e.subcategory_id.map(n=>["subcategory_id","=",n]);s.push(["and",...r])}if(e.brand_id.length>0){const r=e.brand_id.map(n=>["brand_id","=",n]);s.push(["or",...r])}return e.price&&s.push(["and",[["final_price",">=",e.price.min],"and",["final_price","<=",e.price.max]]]),e.name&&s.push(["name","contains",e.name]),s},P=async(e=1)=>{var s,r;y(!0);try{const i={filter:K(l),sort:l.sort,skip:(e-1)*a.itemsPerPage,take:a.itemsPerPage,requireTotalCount:!0},o=await Q.paginate(i);o&&o.data&&(A(o.data),B({currentPage:e,totalPages:Math.ceil(o.totalCount/a.itemsPerPage),totalItems:o.totalCount,itemsPerPage:a.itemsPerPage,from:(e-1)*a.itemsPerPage+1,to:Math.min(e*a.itemsPerPage,o.totalCount)}),F(((s=o==null?void 0:o.summary)==null?void 0:s.brands)??[]),M(((r=o==null?void 0:o.summary)==null?void 0:r.categories)??[]))}catch(n){console.error("Error fetching products:",n)}finally{y(!1)}};c.useEffect(()=>{P(a.currentPage)},[l]),c.useEffect(()=>{const e=new URLSearchParams(window.location.search),s=e.get("category");if(s){const i=u.find(o=>o.slug===s);i&&p(o=>({...o,category_id:[i.id]}))}const r=e.get("collection");if(r){const i=d.find(o=>o.slug===r);i&&p(o=>({...o,collection_id:[i.id]}))}const n=e.get("search");n&&p(i=>({...i,name:n}))},[u,d]);const m=e=>{e>=1&&e<=a.totalPages&&P(e)},w=()=>{const e=[],s=a.totalPages,r=a.currentPage,n=2;for(let i=1;i<=s;i++)i===1||i===s||i>=r-n&&i<=r+n?e.push(i):(i===r-n-1||i===r+n+1)&&e.push("...");return e.filter((i,o,D)=>i!=="..."||D[o-1]!=="...")},N=(e,s)=>{p(r=>{if(e==="price")return{...r,price:r.price&&r.price.min===s.min&&r.price.max===s.max?null:s};const n=Array.isArray(r[e])?r[e]:[],i=n.includes(s)?n.filter(o=>o!==s):[...n,s];return{...r,[e]:i}})},C=e=>{I(s=>({...s,[e]:!s[e]}))},O=[{value:"created_at:desc",label:"MÃ¡s reciente"},{value:"created_at:asc",label:"Mas antiguo"},{value:"final_price:asc",label:"Precio: Menor a Mayor"},{value:"final_price:desc",label:"Precio: Mayor a Menor"},{value:"name:asc",label:"Nombre: A-Z"},{value:"name:desc",label:"Nombre: Z-A"}],[V,X]=c.useState(""),[Z,Y]=c.useState(""),[q,ee]=c.useState("");d==null||d.filter(e=>e.name.toLowerCase().includes(Z.toLowerCase()));const j=u==null?void 0:u.filter(e=>e.name.toLowerCase().includes(V.toLowerCase()));g==null||g.filter(e=>e.name.toLowerCase().includes(q.toLowerCase()));const z=e=>{const[s,r]=e.split(":"),n=[{selector:s,desc:r==="desc"}];p(i=>({...i,sort:n}))};return t.jsx("section",{className:"p-[5%] mx-auto w-full",children:t.jsxs("div",{className:"relative flex flex-col sm:flex-row gap-4",children:[t.jsxs("div",{className:"w-full sm:w-1/5 bg-white p-4 rounded-lg h-max",children:[t.jsx("p",{className:"text-xl font-bold pb-4 mb-4 border-b",children:(x==null?void 0:x.title)||"Filtros"}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("button",{onClick:()=>C("categoria"),className:"flex items-center justify-between w-full mb-4",children:[t.jsx("span",{className:"font-bold",children:"Categorias"}),t.jsx(v,{className:`h-5 w-5 transform transition-transform ${h.categoria?"":"-rotate-180"}`})]}),h.categoria&&t.jsx("div",{className:"space-y-4",children:t.jsx("div",{className:"space-y-2",children:j==null?void 0:j.map(e=>{var r;const s=(r=l.category_id)==null?void 0:r.includes(e.id);return t.jsx("div",{className:`group py-2 rounded-md ${s?"bg-secondary":"bg-transparent"}`,children:t.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[t.jsx("input",{type:"checkbox",className:"h-4 hidden w-4 rounded border-gray-300",onChange:()=>N("category_id",e.id),checked:s}),t.jsx("span",{children:e.name}),t.jsx("img",{src:`/storage/images/category/${e.image}`,onError:n=>n.target.src="assets/img/noimage/no_imagen_circular.png",alt:e.name,className:"w-8 h-8 rounded-full object-cover",loading:"lazy"})]})},e.id)})})})]}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("button",{onClick:()=>C("precio"),className:"flex items-center justify-between w-full mb-4",children:[t.jsx("span",{className:"font-medium",children:"Precio"}),t.jsx(v,{className:`h-5 w-5 transform transition-transform ${h.precio?"":"-rotate-180"}`})]}),h.precio&&t.jsx("div",{className:"space-y-3",children:f==null?void 0:f.map(e=>t.jsxs("label",{className:"flex items-center space-x-3",children:[t.jsx("input",{type:"checkbox",name:"precio",className:"h-4 w-4 rounded border-gray-300",onChange:()=>N("price",e),checked:l.price&&l.price.min===e.min&&l.price.max===e.max}),t.jsx("span",{children:`S/ ${e.min} - S/ ${e.max}`})]},`${e.min}-${e.max}`))})]})]}),t.jsxs("div",{className:"w-full sm:w-4/5 py-4",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4 w-full",children:[t.jsxs("div",{className:"flex gap-4 items-center",children:[t.jsx("label",{className:"font-semibold text-sm w-[150px]",children:"Ordenar por"}),t.jsx(H,{options:O,placeholder:"Recomendados",onChange:z,labelKey:"label",valueKey:"value",className:"border-primary rounded-full customtext-primary"})]}),t.jsx("div",{className:"customtext-primary font-semibold",children:t.jsxs("div",{className:"flex justify-between items-center mb-4 w-full mt-8",children:[t.jsx("div",{className:"customtext-primary font-semibold",children:t.jsxs("nav",{className:"flex items-center gap-x-2 min-w-max",children:[t.jsx("button",{className:`p-4 inline-flex items-center ${a.currentPage===1?"opacity-50 cursor-not-allowed":""}`,onClick:()=>m(a.currentPage-1),disabled:a.currentPage===1,children:t.jsx(S,{})}),w().map((e,s)=>t.jsx(_.Fragment,{children:e==="..."?t.jsx("span",{className:"w-10 h-10 bg-transparent p-2 inline-flex items-center justify-center rounded-full",children:"..."}):t.jsx("button",{className:`w-10 h-10 p-2 inline-flex items-center justify-center rounded-full transition-all duration-300 
                              ${e===a.currentPage?"bg-primary text-white":"bg-transparent hover:text-white hover:bg-primary"}`,onClick:()=>m(e),children:e})},s)),t.jsx("button",{className:`p-4 inline-flex items-center ${a.currentPage===a.totalPages?"opacity-50 cursor-not-allowed":""}`,onClick:()=>m(a.currentPage+1),disabled:a.currentPage===a.totalPages,children:t.jsx(k,{})})]})}),t.jsx("div",{children:t.jsxs("p",{className:"font-semibold",children:[a.from," - ",a.to," de ",a.totalItems," Resultados"]})})]})})]}),E?t.jsx(U,{}):t.jsx("div",{className:"flex items-center flex-wrap gap-y-2 lg:gap-y-3 transition-all duration-300 ease-in-out",children:Array.isArray(b)&&b.length>0?b.map(e=>t.jsx(J,{product:e,widthClass:"lg:w-1/3",cart:L,setCart:R},e.id)):t.jsx(G,{})}),t.jsxs("div",{className:"flex justify-between items-center mb-4 w-full mt-8",children:[t.jsx("div",{className:"customtext-primary font-semibold",children:t.jsxs("nav",{className:"flex items-center gap-x-2 min-w-max",children:[t.jsx("button",{className:`p-4 inline-flex items-center ${a.currentPage===1?"opacity-50 cursor-not-allowed":""}`,onClick:()=>m(a.currentPage-1),disabled:a.currentPage===1,children:t.jsx(S,{})}),w().map((e,s)=>t.jsx(_.Fragment,{children:e==="..."?t.jsx("span",{className:"w-10 h-10 bg-transparent p-2 inline-flex items-center justify-center rounded-full",children:"..."}):t.jsx("button",{className:`w-10 h-10 p-2 inline-flex items-center justify-center rounded-full transition-all duration-300 
                          ${e===a.currentPage?"bg-primary text-white":"bg-transparent hover:text-white hover:bg-primary"}`,onClick:()=>m(e),children:e})},s)),t.jsx("button",{className:`p-4 inline-flex items-center ${a.currentPage===a.totalPages?"opacity-50 cursor-not-allowed":""}`,onClick:()=>m(a.currentPage+1),disabled:a.currentPage===a.totalPages,children:t.jsx(k,{})})]})}),t.jsx("div",{children:t.jsxs("p",{className:"font-semibold",children:[a.from," - ",a.to," de ",a.totalItems," Resultados"]})})]})]})]})})};export{ve as default};
