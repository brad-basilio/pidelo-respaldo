var fe=Object.defineProperty;var ge=(u,o,p)=>o in u?fe(u,o,{enumerable:!0,configurable:!0,writable:!0,value:p}):u[o]=p;var _=(u,o,p)=>ge(u,typeof o!="symbol"?o+"":o,p);import{j as t}from"./ModalImportItem-COUW3Uy_.js";import{B as he}from"./Base-CFczmAvV.js";import{S as N}from"./SwitchFormGroup-DfJvBkep.js";import{T as xe}from"./TextareaFormGroup-GikpXYkl.js";import{r as n}from"./index-CqkZ-sT_.js";import{c as be}from"./ReactAppend-CtUeIECI.js";import{r as A}from"./DxBox-cK5nOGfM.js";import{S as je}from"./ProductCard-DbBw_TRc.js";import{B as ve}from"./BasicEditing-C8Y1Q7ZD.js";import{M as ye}from"./Modal-DV9Mik4k.js";import{T as Re}from"./Table-C_Xx6OU_.js";import{I as q}from"./ImageFormGroup-LBPMTJQg.js";import{I as T}from"./InputFormGroup-Io48ECI2.js";import{Q as we}from"./QuillFormGroup-C7WylisH.js";import{S as L}from"./SelectAPIFormGroup-0u7TX5PN.js";import{S as U}from"./SelectFormGroup-cpZjB4K4.js";import{D as J}from"./DxButton-CsjWvhyj.js";import{C as Ne}from"./CreateReactScript-Be5qpkcP.js";import{N as V}from"./Number2Currency-e57Tgsuk.js";import{R as y}from"./ReactAppend-BJMiIIxq.js";import{S as z}from"./SetSelectValue-UxyCmHse.js";import"./Global-BM4Id4Pw.js";import"./tippy-react.esm-HYwDmlWP.js";import"./index-VLFqsz8m.js";/* empty css              */import"./Logout-DbjxToKk.js";import"./main-CkMzf7wF.js";import"./___vite-browser-external_commonjs-proxy-DA7w84js.js";import"./MenuItemContainer-B0w5NRJw.js";import"./index.esm-uxJmvPV6.js";/* empty css               */import"./General-BmbBKdsB.js";const Q=({label:u,structure:o,onChange:p,typeOptions:k=[]})=>{const[c,x]=n.useState([]),R=()=>{x(typeof o=="object"?[...c,{...o}]:[...c,""])},w=m=>{const a=c.filter((g,l)=>l!==m);x(a),p(a)},j=(m,a,g)=>{const l=[...c];typeof l[m]=="object"?l[m][a]=g:l[m]=g,x(l),p(l)};return t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:u}),c.map((m,a)=>{const g=c.length%2!==0&&a===c.length-1;return t.jsxs("div",{className:"row g-2 mb-2",children:[typeof m=="object"?Object.keys(o).map(l=>t.jsx("div",{className:g?"col-9":"col-6",children:l==="type"?t.jsxs("select",{className:"form-select",value:m[l],onChange:d=>j(a,l,d.target.value),children:[t.jsx("option",{value:"",children:"Seleccionar..."}),k.map(d=>t.jsx("option",{value:d,children:d},d))]}):t.jsx("input",{type:"text",className:"form-control",value:m[l],onChange:d=>j(a,l,d.target.value),placeholder:l})},l)):t.jsx("div",{className:g?"col-9":"col-6",children:t.jsx("input",{type:"text",className:"form-control",value:m,onChange:l=>j(a,null,l.target.value),placeholder:"Característica"})}),t.jsx("div",{className:"col-3",children:t.jsx("button",{type:"button",className:"btn btn-danger w-100",onClick:()=>w(a),children:"X"})})]},a)}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:R,children:"+ Agregar"})]})};class Ce extends ve{constructor(){super(...arguments);_(this,"path","admin/items");_(this,"hasFiles",!0)}}const C=new Ce,Se=({categories:u,brands:o})=>{//!FALTA EDIT AND DELETEDE GALERIA
const[p,k]=n.useState([]),c=n.useRef(),x=n.useRef(),R=n.useRef(),w=n.useRef(),j=n.useRef(),m=n.useRef(),a=n.useRef(),g=n.useRef(),l=n.useRef(),d=n.useRef(),G=n.useRef(),S=n.useRef(),F=n.useRef(),B=n.useRef(),E=n.useRef(),H=n.useRef([]),X=n.useRef([]),[K,O]=n.useState(!1),[W,Y]=n.useState(null),[D,b]=n.useState([]),P=n.useRef(),Z=e=>{const s=Array.from(e.target.files).map(i=>({file:i,url:URL.createObjectURL(i)}));b(i=>[...i,...s])},ee=e=>{e.preventDefault();const s=Array.from(e.dataTransfer.files).map(i=>({file:i,url:URL.createObjectURL(i)}));b(i=>[...i,...s])},te=e=>{e.preventDefault()},re=(e,r)=>{e.preventDefault(),D[r].id?b(i=>i.map((h,v)=>v===r?{...h,toDelete:!0}:h)):b(i=>i.filter((h,v)=>v!==r))};n.useEffect(()=>{if(p&&p.images){const e=p.images.map(r=>({id:r.id,url:`/api/item_images/media/${r.url}`}));b(e)}},[p]);const se=e=>{var r,s;if(console.log(e),k(e||null),e!=null&&e.id?O(!0):O(!1),R.current.value=(e==null?void 0:e.id)||"",$(w.current).val((e==null?void 0:e.category_id)||null).trigger("change"),z(j.current,(r=e==null?void 0:e.subcategory)==null?void 0:r.id,(s=e==null?void 0:e.subcategory)==null?void 0:s.name),$(m.current).val((e==null?void 0:e.brand_id)||null).trigger("change"),a.current.value=(e==null?void 0:e.name)||"",g.current.value=(e==null?void 0:e.summary)||"",l.current.value=(e==null?void 0:e.price)||0,d.current.value=(e==null?void 0:e.discount)||0,z(G.current,(e==null?void 0:e.tags)??[],"id","name"),S.current.value=null,F.current.value=null,S.image.src=`/api/items/media/${(e==null?void 0:e.banner)??"undefined"}`,F.image.src=`/api/items/media/${(e==null?void 0:e.image)??"undefined"}`,B.editor.root.innerHTML=(e==null?void 0:e.description)??"",e!=null&&e.images){const i=e.images.map(h=>({id:h.id,url:`/api/items/gallery/media/${h.url}`}));b(i)}else b([]);E.current.value=e==null?void 0:e.stock,$(x.current).modal("show")},ne=async e=>{e.preventDefault();const r={id:R.current.value||void 0,category_id:w.current.value,subcategory_id:j.current.value,brand_id:m.current.value,name:a.current.value,summary:g.current.value,price:l.current.value,discount:d.current.value,tags:$(G.current).val(),description:B.current.value,sotck:E.current.value},s=new FormData;for(const f in r)s.append(f,r[f]);s.append("features",JSON.stringify(oe)),s.append("specifications",JSON.stringify(ce));const i=F.current.files[0];i&&s.append("image",i);const h=S.current.files[0];h&&s.append("banner",h),D.forEach((f,M)=>{f.toDelete||(f.file?s.append(`gallery[${M}]`,f.file):s.append(`gallery_ids[${M}]`,f.id))});const v=D.filter(f=>f.toDelete).map(f=>parseInt(f.id,10));v.length>0&&s.append("deleted_images",JSON.stringify(v)),console.log(s),await C.save(s)&&($(c.current).dxDataGrid("instance").refresh(),$(x.current).modal("hide"),b([]))},ie=async({id:e,value:r})=>{await C.boolean({id:e,field:"visible",value:r})&&$(c.current).dxDataGrid("instance").refresh()},I=async({id:e,field:r,value:s})=>{await C.boolean({id:e,field:r,value:s})&&$(c.current).dxDataGrid("instance").refresh()},le=async e=>{const{isConfirmed:r}=await je.fire({title:"Eliminar curso",text:"¿Estás seguro de eliminar este curso?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await C.delete(e)||$(c.current).dxDataGrid("instance").refresh()},[oe,ae]=n.useState([]),[ce,me]=n.useState([]),ue=["General","Principal","Otro"],[pe,de]=n.useState(!1);return t.jsxs(t.Fragment,{children:[t.jsx(Re,{gridRef:c,title:"Items",rest:C,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(c.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>de(!pe)}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",text:"Importar Datos",hint:"Importar Datos",onClick:()=>onModalImportOpen()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:r})=>{var s,i;e.html(A(t.jsxs(t.Fragment,{children:[t.jsx("b",{className:"d-block",children:(s=r.category)==null?void 0:s.name}),t.jsx("small",{className:"text-muted",children:(i=r.subcategory)==null?void 0:i.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",width:"300px",cellTemplate:(e,{data:r})=>{e.html(A(t.jsxs(t.Fragment,{children:[t.jsx("b",{children:r.name}),t.jsx("br",{}),t.jsx("span",{className:"truncate",children:r.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:r})=>{e.html(A(t.jsxs(t.Fragment,{children:[r.discount>0&&t.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",V(r.price)]}),t.jsxs("span",{children:["S/.",V(r.discount>0?r.discount:r.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:r})=>{y(e,t.jsx("img",{src:`/api/items/media/${r.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:s=>s.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{y(e,t.jsx(N,{checked:r.is_new,onChange:s=>I({id:r.id,field:"is_new",value:s.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{y(e,t.jsx(N,{checked:r.offering,onChange:s=>I({id:r.id,field:"offering",value:s.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{y(e,t.jsx(N,{checked:r.recommended,onChange:s=>I({id:r.id,field:"recommended",value:s.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{y(e,t.jsx(N,{checked:r.featured,onChange:s=>I({id:r.id,field:"featured",value:s.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{y(e,t.jsx(N,{checked:r.visible,onChange:s=>ie({id:r.id,value:s.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(J({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>se(r)})),e.append(J({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>le(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsxs(ye,{modalRef:x,title:K?"Editar curso":"Agregar curso",onSubmit:ne,size:"xl",children:[t.jsxs("div",{className:"row",id:"principal-container",children:[t.jsx("input",{ref:R,type:"hidden"}),t.jsxs("div",{className:"col-md-3",children:[t.jsx(U,{eRef:w,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>Y(e.target.value),children:u.map((e,r)=>t.jsx("option",{value:e.id,children:e.name},r))}),t.jsx(L,{eRef:j,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",W],dropdownParent:"#principal-container"}),t.jsx(U,{eRef:m,label:"Marca",required:!0,dropdownParent:"#principal-container",children:o.map((e,r)=>t.jsx("option",{value:e.id,children:e.name},r))}),t.jsx(T,{label:"Stock",eRef:E,type:"number"}),t.jsx(T,{eRef:l,label:"Precio",type:"number",step:"0.01",required:!0}),t.jsx(T,{eRef:d,label:"Descuento",type:"number",step:"0.01"}),t.jsx(L,{id:"tags",eRef:G,searchAPI:"/api/admin/tags/paginate",searchBy:"name",label:"Tags",dropdownParent:"#principal-container",tags:!0,multiple:!0})]}),t.jsxs("div",{className:"col-md-4",children:[t.jsx(T,{eRef:a,label:"Nombre",required:!0}),t.jsx(xe,{eRef:g,label:"Resumen",rows:3,required:!0}),t.jsx(Q,{ref:H,label:"Características",structure:"",onChange:ae}),t.jsx(Q,{ref:X,label:"Especificaciones",structure:{type:"",title:"",description:""},onChange:me,typeOptions:ue})]}),t.jsx("div",{className:"col-md-5",children:t.jsxs("div",{className:"row",children:[t.jsx(q,{eRef:S,label:"Banner",aspect:2/1,col:"col-12"}),t.jsx(q,{eRef:F,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),t.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[t.jsx("label",{className:"form-label",children:"Galeria"}),t.jsx("input",{id:"input-item-gallery",ref:P,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:Z}),t.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"209px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>P.current.click(),onDrop:ee,onDragOver:te,children:t.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),t.jsx("div",{className:"col-md-12 col-sm-6",children:t.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:D.map((e,r)=>t.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[t.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),t.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:s=>re(s,r),children:"×"})]},r))})})]})})]}),t.jsx("hr",{className:"my-1"}),t.jsx(we,{eRef:B,label:"Descripcion"})]})]})};Ne((u,o)=>{be(u).render(t.jsx(he,{...o,title:"Items",children:t.jsx(Se,{...o})}))});
