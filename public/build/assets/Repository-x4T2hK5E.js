var U=Object.defineProperty;var W=(i,r,o)=>r in i?U(i,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[r]=o;var N=(i,r,o)=>W(i,typeof r!="symbol"?r+"":r,o);import{j as e}from"./AboutHeader-ClKiNAEV.js";import{r as l}from"./index-DFv2mRv-.js";import{c as O}from"./ReactAppend-D9rqaU78.js";import"./RepositoryDropzone-yMMr28Fp.js";import{m}from"./main-rZoj-gSW.js";import{i as w}from"./tippy-react.esm-CGYKl-Jd.js";import{S as K}from"./ProductCard-NsyC22vv.js";import{G as R}from"./Global-CklCDfn9.js";import{M as X}from"./Modal-DWRtyNBM.js";import{I as M}from"./InputFormGroup-C-k79te8.js";import{B as Z}from"./ModalImportItem-Bfew4f-8.js";import{C as H}from"./CreateReactScript-B35nUu53.js";import{B as J}from"./Base-B6SPfutw.js";import"./index-Sd7so-oN.js";import"./___vite-browser-external_commonjs-proxy-BQdpDcDf.js";import"./index.esm-BAuPgmiI.js";/* empty css               *//* empty css              */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./Logout-CnsEv7kI.js";import"./MenuItemContainer-EpS2kX4S.js";class Q extends Z{constructor(){super(...arguments);N(this,"path","admin/repository");N(this,"hasFiles",!0)}}const f=new Q,V=100*1024*1024,Y=i=>i.startsWith("image/")?"mdi-image":i.startsWith("video/")?"mdi-video":i.startsWith("audio/")?"mdi-music":i.includes("pdf")?"mdi-file-pdf":i.includes("word")?"mdi-file-word":i.includes("sheet")?"mdi-file-excel":"mdi-file",ee=i=>{if(i===0)return"0 Bytes";const r=1024,o=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(i)/Math.log(r));return parseFloat((i/Math.pow(r,d)).toFixed(2))+" "+o[d]},te=({files:i,height:r="calc(100vh - 240px)",selectable:o,multiple:d=!0,selectedFiles:_=[],setSelectedFiles:x=()=>{}})=>{const h=l.useRef(),g=l.useRef(),j=l.useRef(),v=l.useRef(),k=l.useRef(),[C,b]=l.useState(!1),[D,F]=l.useState(!1),[y,u]=l.useState(i||[]),E=t=>{t.preventDefault(),t.stopPropagation(),b(!0)},P=t=>{t.preventDefault(),t.stopPropagation(),b(!1)},A=async t=>{t.preventDefault(),t.stopPropagation(),b(!1);const s=Array.from(t.dataTransfer.files);S(s)},L=t=>{const s=Array.from(t.target.files);S(s),g.current.value=null},S=async t=>{F(!0);for(const s of t){if(s.size>V){m.Notify.add({title:"Error",type:"danger",body:`El archivo ${s.name} excede el límite de 40MB`,icon:"/assets/img/icon.svg"});continue}const n=new FormData;n.append("name",s.name),n.append("file",s);try{const a=await f.save(n),c=a.data;a&&(u(p=>[...p,c]),m.Notify.add({title:"Operación correcta",body:`Archivo ${s.name} subido correctamente`,icon:"/assets/img/icon.svg"}))}catch{m.Notify.add({title:"Error",type:"danger",body:`Error al subir ${s.name}`,icon:"/assets/img/icon.svg"})}}F(!1)},I=t=>{j.current.value=t.id,k.current.value=t.name,v.current.value=t.name,$(h.current).modal("show")},z=async t=>{t.preventDefault();const s=new FormData;s.append("id",j.current.value),s.append("name",v.current.value);const n=await f.save(s);if(!n)return;const a=n.data;u(c=>c.map(p=>p.id===a.id?a:p)),$(h.current).modal("hide")},B=({name:t,file:s,relative:n=!1})=>{const a=n?`/cloud/${s}`:`${R.APP_URL}/cloud/${s}`;m.Clipboard.copy(a,()=>{m.Notify.add({title:"Enlace copiado",body:`${n?"La ruta":"El enlace"} al archivo ${t} ha sido copiado al portapapeles`,icon:"/assets/img/icon.svg"})})},q=async t=>{const{isConfirmed:s}=await K.fire({title:"¿Estás seguro?",text:"¿Estás seguro de que deseas eliminar este archivo?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!s||!await f.delete(t)||u(a=>a.filter(c=>c.id!==t))},G=async()=>{const t=await f.paginate({isLoadingAll:!0});t&&u(t.data)};l.useEffect(()=>{y.length==0&&G()},[null]);const T=(t,s)=>{const n=t.target.checked;if(!d)return x([s]);x(n?a=>[...a,s]:a=>a.filter(c=>c.id!==s.id))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${C?"dragging":""}`,onDragEnter:E,onDragOver:E,onDragLeave:P,onDrop:A,children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("input",{type:"file",ref:g,className:"d-none",multiple:!0,onChange:L}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>g.current.click(),disabled:D,type:"button",children:D?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-loading mdi-spin me-1"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-upload me-1"}),"Subir archivos"]})})]}),e.jsx("div",{className:"repository-dropzone",style:{height:r,userSelect:"none"},children:C?e.jsxs("div",{className:"drop-overlay",children:[e.jsx("i",{className:"mdi mdi-cloud-upload mdi-48px mb-2"}),e.jsx("h4",{children:"Suelta los archivos aquí"})]}):y.length>0?e.jsx("div",{className:"d-flex flex-wrap align-items-center justify-content-center gap-2",children:y.map((t,s)=>{const n=_.find(a=>a.id===t.id);return e.jsxs("div",{className:"card my-0",style:{width:"140px",height:"max-content",boxShadow:"5px 5px 10px rgba(0, 0, 0, 0.2)"},children:[e.jsxs("label",{href:`${R.APP_URL}/cloud/${t.file}`,className:"rounded position-relative w-100 bg-dark d-flex align-items-center justify-content-center text-white cursor-pointer",style:{aspectRatio:5/3},onClick:()=>{if(!o){const a=document.createElement("a");a.href=`${R.APP_URL}/cloud/${t.file}`,a.target="_blank",a.click(),a.remove()}},children:[o&&e.jsx("input",{name:"input-file-selectable",type:d?"checkbox":"radio",className:"position-absolute form-check-input m-0",style:{top:"6px",left:"6px"},checked:!!n,onChange:a=>T(a,t)}),t.file_mimetype.startsWith("image/")&&t.file_mimetype!=="image/svg+xml"?e.jsx("img",{className:"rounded img-fluid w-100 h-100",src:`/cloud/${t.file}`,alt:t.name,style:{objectFit:"cover",objectPosition:"center",aspectRatio:5/3}}):e.jsx("i",{className:`mdi ${Y(t.file_mimetype)} mdi-36px`})]}),e.jsxs("div",{className:"card-body p-1",children:[e.jsx("small",{className:"d-block text-truncate w-100 my-0",title:t.name,children:e.jsx("b",{children:t.name})}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center",children:[e.jsx("small",{className:"card-text",children:ee(t.file_size)}),!o&&e.jsxs("div",{className:"d-flex gap-1",children:[e.jsxs("div",{className:"dropdown d-inline",children:[e.jsx(w,{content:"Copiar enlace",children:e.jsx("i",{className:"mdi mdi-link cursor-pointer","data-bs-toggle":"dropdown"})}),e.jsxs("ul",{className:"dropdown-menu",children:[e.jsx("li",{children:e.jsxs("a",{className:"dropdown-item",href:"#",onClick:()=>B(t),children:[e.jsx("i",{className:"mdi mdi-link-variant me-1"}),"Copiar enlace"]})}),e.jsx("li",{children:e.jsxs("a",{className:"dropdown-item",href:"#",onClick:()=>B({...t,relative:!0}),children:[e.jsx("i",{className:"mdi mdi-folder-outline me-1"}),"Copiar ruta relativa"]})})]})]}),e.jsx(w,{content:"Cambiar nombre",children:e.jsx("i",{className:"mdi mdi-pencil cursor-pointer",onClick:()=>I(t)})}),e.jsx(w,{content:"Eliminar",children:e.jsx("i",{className:"mdi mdi-delete cursor-pointer text-danger",onClick:()=>q(t.id)})})]})]})]})]},s)})}):e.jsxs("div",{className:"text-center p-5",children:[e.jsx("i",{className:"mdi mdi-folder-multiple-outline mdi-48px mb-2"}),e.jsx("h4",{children:"Arrastra archivos aquí o usa el botón de subir"}),e.jsx("small",{className:"text-muted",children:"Tamaño máximo por archivo: 40MB"})]})})]}),e.jsxs(X,{modalRef:h,title:"Modificar nombre",onSubmit:z,zIndex:1070,children:[e.jsx("input",{ref:j,type:"hidden"}),e.jsx(M,{eRef:k,label:"Nombre anterior",disabled:!0}),e.jsx(M,{eRef:v,label:"Nombre nuevo",required:!0})]})]})},se=({files:i})=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"repository-container",children:e.jsx(te,{files:i})})});H((i,r)=>{O(i).render(e.jsx(J,{...r,title:"Repositorio",children:e.jsx(se,{...r})}))});
