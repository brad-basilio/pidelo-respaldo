var q=Object.defineProperty;var L=(s,i,n)=>i in s?q(s,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[i]=n;var A=(s,i,n)=>(L(s,typeof i!="symbol"?i+"":i,n),n);import{j as e}from"./AboutHeader-CpM0iYLI.js";import{r as m}from"./index-B80Lgev0.js";import{c as ee}from"./ReactAppend-CBRQCQGz.js";import{C as se}from"./CreateReactScript-wgaspG1d.js";import{i as V}from"./tippy-react.esm-CHhA99mn.js";import{m as M}from"./main-B2CtU6ez.js";import{B as ne}from"./BasicEditing-Co4zseXw.js";import{S as te}from"./SwitchFormGroup-DbO3fJgb.js";import{G as Y}from"./Global-mC9lKANG.js";import{S as J}from"./SortByAfterField-BaS5rBg8.js";import{I as X}from"./InputFormGroup-aNCWUTCq.js";import{M as U}from"./Modal-Dbgjpj-3.js";import{S as _}from"./SelectFormGroup-Dk0mAUCB.js";import{S as ie}from"./SetSelectValue-UxyCmHse.js";import{M as re}from"./MenuItem-B0W8YWic.js";import"./index-DO3Aws4m.js";import"./index.esm-Cu-mVv1q.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";/* empty css               *//* empty css              */const ae=({title:s,icon:i="mdi mdi-layers",children:n})=>{var o;const a=[];Array.isArray(n)?n.forEach(c=>{var h;return a.push((h=c==null?void 0:c.props)==null?void 0:h.href)}):a.push((o=n==null?void 0:n.props)==null?void 0:o.href);const r=a.filter(Boolean).some(c=>location.pathname.includes(c)),l=`item-${crypto.randomUUID()}`;return e.jsxs("li",{children:[e.jsxs("a",{href:`#${l}`,"data-bs-toggle":"collapse","aria-expanded":r,children:[e.jsx("i",{className:i}),e.jsxs("span",{children:[" ",s," "]}),e.jsx("span",{className:"menu-arrow"})]}),e.jsx("div",{className:`collapse ${r&&"show"}`,id:l,children:e.jsx("ul",{className:"nav-second-level",children:n})})]})};class I extends ne{constructor(){super(...arguments);A(this,"path","admin/system");A(this,"savePage",async(n={})=>{try{const{status:a,result:r}=await M.Fetch(`/api/${this.path}/page`,{method:"POST",body:JSON.stringify(n)});if(!a)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return r.data??[]}catch(a){return M.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message,type:"danger"}),null}});A(this,"updateOrder",async n=>{try{const{status:a,result:r}=await M.Fetch(`/api/${this.path}/order`,{method:"PATCH",body:JSON.stringify(n)});if(!a)throw new Error((r==null?void 0:r.message)??"Ocurrio un error inesperado");return!0}catch(a){M.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message,type:"danger"})}});A(this,"deletePage",async n=>{try{const{status:a,result:r}=await M.Fetch(`/api/${this.path}/page/${n}`,{method:"DELETE"});if(!a)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return r.data??!0}catch(a){return M.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message,type:"danger"}),!1}})}}const K=s=>{const i=/{([^}]+)}/g,n=[];let a;for(;(a=i.exec(s))!==null;)n.push(a[1]);return n},z=new I,le=s=>{const{id:i,name:n,path:a,extends_base:r=!1,setPages:l,onSEOClicked:o,onParamsClicked:c}=s,[h,u]=m.useState(!1),[y,N]=m.useState(!1),[g,v]=m.useState(!1),w=async x=>{if(n===x.target.value)return u(!1);z.savePage({id:i,name:x.target.value})&&(u(!1),l(f=>f.map(d=>d.id===i?{...d,name:x.target.value}:d)))},C=async x=>{if(a===x.target.value)return N(!1);z.savePage({id:i,path:x.target.value})&&(N(!1),l(f=>f.map(d=>d.id===i?{...d,path:x.target.value}:d)))},F=async x=>{const E=x.target.checked;z.savePage({id:i,extends_base:E})&&(v(!1),l(d=>d.map(t=>t.id===i?{...t,extends_base:E}:t)))},D=async x=>{await z.deletePage(x.id)&&(l(f=>f.filter(d=>d.id!=x.id)),$('[data-bs-toggle="tab"]').removeClass("active"),$(".tab-pane").removeClass("active"),$("#base-template-link").addClass("active"),$("#base-template").addClass("active"))},R=K(a);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dropdown float-end",children:[e.jsx("a",{href:"#",className:"dropdown-toggle arrow-none card-drop","data-bs-toggle":"dropdown","aria-expanded":"false",children:e.jsx("i",{className:"mdi mdi-dots-vertical"})}),e.jsxs("div",{className:"dropdown-menu dropdown-menu-end",children:[e.jsxs("button",{className:"dropdown-item",onClick:()=>o(s),children:[e.jsx("i",{className:"mdi mdi-cloud-search-outline me-1"}),"Editar SEO"]}),R.length>0&&e.jsxs("button",{className:"dropdown-item",onClick:()=>c(s),children:[e.jsx("i",{className:"mdi mdi-code-braces me-1"}),"Parámetros"]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{className:"dropdown-item",onClick:()=>D(s),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar página"]})]})]}),e.jsxs("div",{children:[h?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:n,onBlur:w,autoFocus:!0}):e.jsx(V,{content:"Editar nombre",placement:"left",children:e.jsx("h4",{className:"header-title mb-1 d-block",onClick:()=>u(!0),style:{minWidth:"200px",cursor:"pointer"},children:n||"Sin nombre"})}),y?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:a,style:{minHeight:27,fieldSizing:"content"},onBlur:C,autoFocus:!0}):e.jsx(V,{content:"Editar ruta",placement:"left",children:e.jsx("small",{className:"text-muted d-block mb-1",onClick:()=>N(!0),style:{minWidth:"200px",cursor:"pointer"},children:a||"Sin ruta"})}),e.jsx(te,{label:"Extiende de base",checked:r,onChange:F,disabled:g})]})]})},Q=({col:s,label:i,eRef:n,placeholder:a,required:r=!1,rows:l=3,value:o,onChange:c})=>e.jsxs("div",{className:`form-group ${s} mb-2`,children:[e.jsxs("label",{htmlFor:"",children:[i," ",r&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{ref:n,className:"form-control",placeholder:a,required:r,rows:l,defaultValue:o,style:{minHeight:l*27,fieldSizing:"content"},onChange:c})]}),ce=new I,oe=({dataLoaded:s,setDataLoaded:i,modalRef:n})=>{const a=m.useRef(null),r=m.useRef(null),l=m.useRef(null),o=async c=>{c.preventDefault(),await ce.savePage({id:s.id,description:r.current.value,keywords:$(l.current).val()})&&(i(null),$(n.current).modal("hide"))};return m.useEffect(()=>{a.current.value=`${s==null?void 0:s.name} | ${Y.APP_NAME}`,r.current.value=(s==null?void 0:s.description)??"",ie(l.current,(s==null?void 0:s.keywords)??[])},[s]),e.jsx(U,{modalRef:n,title:`Editar SEO - ${s==null?void 0:s.name}`,size:"sm",onSubmit:o,children:e.jsxs("div",{id:"seo-container",children:[e.jsx(X,{eRef:a,label:"Título",disabled:!0}),e.jsx(Q,{eRef:r,label:"Descripción",rows:2}),e.jsx(_,{eRef:l,label:"Palabras clave",tags:!0,multiple:!0,dropdownParent:"#seo-container"})]})})},me=({className:s,system:i,component:n,onComponentClicked:a,onDeleteClicked:r,onEditDataClicked:l})=>{var h;const o=(n==null?void 0:n.options)??[],c=o.find(u=>u.id==i.value);return e.jsxs("div",{className:`dropdown ${s}`,"data-id":i.id,children:[e.jsxs("div",{className:"btn btn-light dropdown-toggle text-truncate w-100 text-start",type:"button",id:`dd-${i.id}`,"data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true",children:[e.jsx("i",{className:"mdi mdi-chevron-down ms-1 float-end"}),e.jsxs("span",{className:"handle-sortable",style:{cursor:"move"},children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"})]}),e.jsx("span",{className:"ms-1",children:i.name})]}),e.jsxs("div",{className:"dropdown-menu","aria-labelledby":`dd-${i.id}`,"data-popper-placement":"bottom-start",children:[o.length>1&&e.jsxs(e.Fragment,{children:[o.filter(u=>u.id!=i.value).map(u=>e.jsxs("button",{className:"dropdown-item",onClick:()=>a({...i,name:`${n.name} - ${u.name}`,value:u.id}),children:[n.name," - ",u.name]})),e.jsx("div",{className:"dropdown-divider"})]}),(((h=c==null?void 0:c.using)==null?void 0:h.filters)||(c==null?void 0:c.data))&&e.jsxs("button",{className:"dropdown-item",onClick:()=>l(i,c),children:[e.jsx("i",{className:"mdi mdi-pencil me-1"}),"Configurar datos"]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>r(i),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar"]})]})]})},de=new I,ue=({dataLoaded:s,setDataLoaded:i,setSystems:n,modalRef:a})=>{var h,u,y,N,g,v,w,C,F,D,R,x,E;const[r,l]=m.useState((s==null?void 0:s.data)||{}),o={};o.model=m.useRef(null),o.filters=m.useRef(null);const c=async f=>{f.preventDefault();const d=await de.save({id:s.id,data:r,filters:$(o.filters.current).val()});d&&(i(null),$(a.current).modal("hide"),n(t=>t.map(p=>p.id==s.id?d.data:p)))};return m.useEffect(()=>{var d,t,p;const f={};(d=s==null?void 0:s.component)==null||d.data.forEach(b=>{var j;f[b]=((j=s==null?void 0:s.data)==null?void 0:j[b])??""}),l(f),o.model.current.value=((p=(t=s==null?void 0:s.component)==null?void 0:t.using)==null?void 0:p.model)??"",$(o.filters.current).val((s==null?void 0:s.filters)??[]).trigger("change")},[s]),e.jsxs(U,{modalRef:a,title:s==null?void 0:s.name,onSubmit:c,children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered",children:[e.jsx("li",{className:"nav-item",hidden:!((u=(h=s==null?void 0:s.component)==null?void 0:h.data)!=null&&u.length),children:e.jsx("a",{href:"#tab-info","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link active",children:"Información"})}),e.jsx("li",{className:"nav-item",hidden:!((N=(y=s==null?void 0:s.component)==null?void 0:y.using)!=null&&N.filters),children:e.jsx("a",{href:"#tab-db","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Base de datos"})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"tab-info",hidden:!((v=(g=s==null?void 0:s.component)==null?void 0:g.data)!=null&&v.length),children:(C=(w=s==null?void 0:s.component)==null?void 0:w.data)==null?void 0:C.map((f,d)=>e.jsx(Q,{label:f,value:r[f]??"",rows:1,onChange:t=>l({...r,[f]:t.target.value})},d))}),e.jsxs("div",{className:"tab-pane show",id:"tab-db",children:[e.jsx(X,{eRef:o.model,label:"Modelo",disabled:!0}),e.jsx(_,{eRef:o.filters,label:"Filtros",multiple:!0,dropdownParent:"#tab-db",hidden:!((D=(F=s==null?void 0:s.component)==null?void 0:F.using)!=null&&D.filters),children:(E=(x=(R=s==null?void 0:s.component)==null?void 0:R.using)==null?void 0:x.filters)==null?void 0:E.map((f,d)=>e.jsx("option",{value:f,children:f},d))})]})]})]})},pe=({components:s,onClick:i})=>e.jsx("div",{className:"left-side-menu top-0 pt-2",children:e.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[e.jsx("div",{id:"sidebar-menu",className:"show",children:e.jsxs("ul",{id:"side-menu",children:[e.jsx("li",{className:"menu-title",children:"Lista de componentes"}),s.filter(n=>n.options.length>0).map((n,a)=>e.jsx(ae,{title:n.name,children:n.options.map((r,l)=>e.jsx(re,{name:r.name,icon:r.image,onClick:()=>{const o=$(".tab-pane:visible .components-container > div").last().data("id");i({name:`${n.name} - ${r.name}`,component:n.id,value:r.id,after_component:o})},children:r.name},l))},a))]})}),e.jsx("div",{className:"clearfix"})]})}),he=({param:s,models:i})=>{var u,y,N;const n=m.useRef(),a=m.useRef(),r=m.useRef(),[l,o]=m.useState(null),c=g=>{const v=g.target.value,w=i.find(C=>C.name==v)??null;o(w)};m.useEffect(()=>{$(n.current).val(null).trigger("change")},[s]),m.useEffect(()=>{$(r.current).trigger("change")},[l]);const h=`${s}-container`;return e.jsxs("div",{id:h,className:"row",children:[e.jsxs("label",{className:"form-label",children:["Parámetro ",e.jsx("code",{children:s})]}),e.jsx(_,{eRef:n,label:"Modelo",col:"col-md-6",dropdownParent:`#${h}`,onChange:c,children:i.map((g,v)=>e.jsx("option",{children:g.name},v))}),e.jsx(_,{eRef:a,label:"Campo",col:"col-md-6",dropdownParent:`#${h}`,children:(u=l==null?void 0:l.fields)==null?void 0:u.map((g,v)=>e.jsx("option",{children:g},v))}),e.jsx("div",{hidden:(((y=l==null?void 0:l.relations)==null?void 0:y.length)??0)==0,children:e.jsx(_,{eRef:r,label:"Relaciones",multiple:!0,dropdownParent:`#${h}`,children:(N=l==null?void 0:l.relations)==null?void 0:N.map((g,v)=>e.jsx("option",{children:g},v))})})]})},fe=new I,xe=({dataLoaded:s,setDataLoaded:i,modalRef:n,models:a})=>{const r=async o=>{o.preventDefault(),await fe.savePage({id:s.id,description:descriptionRef.current.value,keywords:$(keywordsRef.current).val()})&&(i(null),$(n.current).modal("hide"))},l=K((s==null?void 0:s.path)??"");return e.jsx(U,{modalRef:n,title:`Editar parámetros de URL - ${s==null?void 0:s.name}`,onSubmit:r,children:l.map((o,c)=>e.jsx(he,{param:o,models:a},c))})},H=new I,je=({systems:s,pages:i,components:n,models:a})=>{const r=m.useRef(null),l=m.useRef(null),o=m.useRef(null),[c,h]=m.useState(s),[u,y]=m.useState(i),[N,g]=m.useState(!1),[v,w]=m.useState(null),[C,F]=m.useState(null),D=async()=>{g(!0);const t=await H.savePage();t&&(g(!1),y(t))},R=async t=>{const b=$(".tab-pane:visible").data("id")??null;t.page_id=b;const j=await H.save(t);if(!j)return;const k=j.data;h(P=>P.some(S=>S.id===k.id)?P.map(S=>S.id===k.id?k:S):[...P,k])},x=async t=>{await H.delete(t.id)&&h(b=>b.filter(j=>j.id!=t.id))};m.useEffect(()=>{document.title=`Sistema | ${Y.APP_NAME}`},[null]),m.useEffect(()=>{const t=$("iframe:visible");t&&$(t).attr("src",t.attr("src"))},[c,u]);const E=async t=>{w(t),$(r.current).modal("show")},f=async t=>{w(t),$(l.current).modal("show")},d=async(t,p)=>{F({...t,component:p}),$(o.current).modal("show")};return m.useEffect(()=>{[...$(".components-container")].forEach(p=>{$(p).sortable({connectWith:".components-container",handle:".handle-sortable",forcePlaceholderSize:!0,update:async function(b,j){const k=[...$(p).children()],P={};if(k.forEach(G=>{const S=$(G).data("id"),O=$(G).prev().data("id")??null,B=c.find(T=>T.id==S);(B==null?void 0:B.after_component)!==O&&(P[S]=O)}),Object.keys(P).length>0){if(!await H.updateOrder(P))return;h(S=>{const O=[...S];return Object.entries(P).forEach(([B,T])=>{const W=O.findIndex(Z=>Z.id==B);W!==-1&&(O[W]={...O[W],after_component:T})}),O})}}}).disableSelection()})},[u,c]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"wrapper",children:[e.jsx(pe,{components:n,onClick:R}),e.jsx("div",{className:"content-page mt-2 pb-3",style:{height:"max-content"},children:e.jsx("div",{className:"content mt-2",children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("button",{className:"button-menu-mobile d-lg-none d-md-block position-absolute ",style:{zIndex:1,border:"none",borderRadius:"0 50% 50% 0",backgroundColor:"#fff",color:"#343a40",top:"50%",left:"0",transform:"translateY(-50%)",padding:"24px 0px 20px 6px ",fontWeight:"bold"},children:"〉"}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card mb-0",children:e.jsxs("div",{className:"card-body",style:{height:"calc(100vh - 48px)"},children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered flex-nowrap",style:{overflowX:"auto",overflowY:"hidden"},children:[e.jsx("li",{className:"nav-item",children:e.jsx("a",{id:"base-template-link",href:"#base-template","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active h-100",children:"Base"})}),u.map((t,p)=>e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:`#page-${t.id}`,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link h-100",style:{whiteSpace:"nowrap"},children:[t.name,e.jsx("small",{className:"d-block text-muted",style:{fontWeight:"normal"},children:t.path})]})},p)),e.jsx("li",{className:"nav-item d-flex justify-content-center align-items-center px-2",children:e.jsx(V,{content:"Agregar página",children:e.jsx("button",{className:"nav-link btn btn-xs btn-white rounded-pill",onClick:D,disabled:N,children:N?e.jsx("i",{className:"mdi mdi-loading mdi-spin"}):e.jsx("i",{className:"mdi mdi-plus"})})})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"base-template",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"d-flex flex-column gap-2",children:J(c).filter(t=>t.page_id==null).map(t=>{const p=n.find(j=>j.id==t.component),b=(p==null?void 0:p.options)??[];return t.component=="content"?e.jsxs("button",{"data-id":t.id,className:"btn btn-light text-truncate w-100 text-start",type:"button",children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("span",{className:"ms-1",children:t.name})]}):e.jsxs("div",{className:"dropdown",children:[e.jsxs("button",{"data-id":t.id,className:"btn btn-light dropdown-toggle text-truncate w-100 text-start",type:"button",id:`dd-${t.id}`,"data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true",children:[e.jsx("i",{className:"mdi mdi-chevron-down ms-1 float-end"}),e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("span",{className:"ms-1",children:t.name})]}),e.jsxs("div",{className:"dropdown-menu","aria-labelledby":`dd-${t.id}`,"data-popper-placement":"bottom-start",children:[b.length>1&&e.jsxs(e.Fragment,{children:[b.filter(j=>j.id!=t.value).map(j=>e.jsxs("button",{className:"dropdown-item",onClick:()=>R({...t,name:`${p.name} - ${j.name}`,value:j.id}),children:[p.name," - ",j.name]})),e.jsx("div",{className:"dropdown-divider"})]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>x(t),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar componente"]})]})]})})})}),e.jsx("div",{className:"col-md-8",children:e.jsx("iframe",{src:"/base-template",className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 185px)",borderRadius:"4px"}})})]})}),u.map((t,p)=>e.jsx("div",{className:"tab-pane",id:`page-${t.id}`,"data-id":t.id,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx(le,{...t,models:a,setPages:y,onSEOClicked:E,onParamsClicked:f}),e.jsx("hr",{className:"my-2"}),e.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":t.id,children:J(c).filter(b=>b.page_id==t.id).map(b=>{const j=n.find(k=>k.id==b.component);return e.jsx(me,{className:"",system:b,component:j,onComponentClicked:R,onDeleteClicked:x,onEditDataClicked:d},b.id)})})]}),e.jsx("div",{className:"col-md-8",children:e.jsx("iframe",{src:t.path,className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 185px)",borderRadius:"4px"}})})]})},p))]})]})})})})]})})})]}),e.jsx(oe,{dataLoaded:v,setDataLoaded:w,modalRef:r}),e.jsx(xe,{dataLoaded:v,setDataLoaded:w,modalRef:l,models:a}),e.jsx(ue,{dataLoaded:C,setDataLoaded:F,setSystems:h,modalRef:o})]})};se((s,i)=>{ee(s).render(e.jsx(je,{...i}))});
