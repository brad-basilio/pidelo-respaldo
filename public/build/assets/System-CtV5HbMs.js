var ee=Object.defineProperty;var se=(s,i,n)=>i in s?ee(s,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[i]=n;var A=(s,i,n)=>(se(s,typeof i!="symbol"?i+"":i,n),n);import{j as e}from"./AboutHeader-CpM0iYLI.js";import{r as m}from"./index-B80Lgev0.js";import{c as ne}from"./ReactAppend-CBRQCQGz.js";import{C as te}from"./CreateReactScript-wgaspG1d.js";import{i as U}from"./tippy-react.esm-CHhA99mn.js";import{m as M}from"./main-B2CtU6ez.js";import{B as ie}from"./BasicEditing-Co4zseXw.js";import{S as re}from"./SwitchFormGroup-DbO3fJgb.js";import{G as K}from"./Global-mC9lKANG.js";import{S as Y}from"./SortByAfterField-BaS5rBg8.js";import{I as Q}from"./InputFormGroup-aNCWUTCq.js";import{M as J}from"./Modal-Dbgjpj-3.js";import{S as _}from"./SelectFormGroup-Dk0mAUCB.js";import{S as ae}from"./SetSelectValue-UxyCmHse.js";import{M as V}from"./MenuItem-B0W8YWic.js";import"./index-DO3Aws4m.js";import"./index.esm-Cu-mVv1q.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";/* empty css               *//* empty css              */const le=({title:s,icon:i="mdi mdi-layers",children:n})=>{var o;const a=[];Array.isArray(n)?n.forEach(c=>{var p;return a.push((p=c==null?void 0:c.props)==null?void 0:p.href)}):a.push((o=n==null?void 0:n.props)==null?void 0:o.href);const r=a.filter(Boolean).some(c=>location.pathname.includes(c)),l=`item-${crypto.randomUUID()}`;return e.jsxs("li",{children:[e.jsxs("a",{href:`#${l}`,"data-bs-toggle":"collapse","aria-expanded":r,children:[e.jsx("i",{className:i}),e.jsxs("span",{children:[" ",s," "]}),e.jsx("span",{className:"menu-arrow"})]}),e.jsx("div",{className:`collapse ${r&&"show"}`,id:l,children:e.jsx("ul",{className:"nav-second-level",children:n})})]})};class I extends ie{constructor(){super(...arguments);A(this,"path","admin/system");A(this,"savePage",async(n={})=>{try{const{status:a,result:r}=await M.Fetch(`/api/${this.path}/page`,{method:"POST",body:JSON.stringify(n)});if(!a)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return r.data??[]}catch(a){return M.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message,type:"danger"}),null}});A(this,"updateOrder",async n=>{try{const{status:a,result:r}=await M.Fetch(`/api/${this.path}/order`,{method:"PATCH",body:JSON.stringify(n)});if(!a)throw new Error((r==null?void 0:r.message)??"Ocurrio un error inesperado");return!0}catch(a){M.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message,type:"danger"})}});A(this,"deletePage",async n=>{try{const{status:a,result:r}=await M.Fetch(`/api/${this.path}/page/${n}`,{method:"DELETE"});if(!a)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return r.data??!0}catch(a){return M.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message,type:"danger"}),!1}})}}const Z=s=>{const i=/{([^}]+)}/g,n=[];let a;for(;(a=i.exec(s))!==null;)n.push(a[1]);return n},z=new I,ce=s=>{const{id:i,name:n,path:a,extends_base:r=!1,setPages:l,onSEOClicked:o,onParamsClicked:c}=s,[p,u]=m.useState(!1),[y,v]=m.useState(!1),[b,g]=m.useState(!1),w=async x=>{if(n===x.target.value)return u(!1);z.savePage({id:i,name:x.target.value})&&(u(!1),l(h=>h.map(d=>d.id===i?{...d,name:x.target.value}:d)))},k=async x=>{if(a===x.target.value)return v(!1);z.savePage({id:i,path:x.target.value})&&(v(!1),l(h=>h.map(d=>d.id===i?{...d,path:x.target.value}:d)))},O=async x=>{const E=x.target.checked;z.savePage({id:i,extends_base:E})&&(g(!1),l(d=>d.map(t=>t.id===i?{...t,extends_base:E}:t)))},F=async x=>{await z.deletePage(x.id)&&(l(h=>h.filter(d=>d.id!=x.id)),$('[data-bs-toggle="tab"]').removeClass("active"),$(".tab-pane").removeClass("active"),$("#base-template-link").addClass("active"),$("#base-template").addClass("active"))},C=Z(a);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dropdown float-end",children:[e.jsx("a",{href:"#",className:"dropdown-toggle arrow-none card-drop","data-bs-toggle":"dropdown","aria-expanded":"false",children:e.jsx("i",{className:"mdi mdi-dots-vertical"})}),e.jsxs("div",{className:"dropdown-menu dropdown-menu-end",children:[e.jsxs("button",{className:"dropdown-item",onClick:()=>o(s),children:[e.jsx("i",{className:"mdi mdi-cloud-search-outline me-1"}),"Editar SEO"]}),C.length>0&&e.jsxs("button",{className:"dropdown-item",onClick:()=>c(s),children:[e.jsx("i",{className:"mdi mdi-code-braces me-1"}),"Parámetros"]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{className:"dropdown-item",onClick:()=>F(s),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar página"]})]})]}),e.jsxs("div",{children:[p?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:n,onBlur:w,autoFocus:!0}):e.jsx(U,{content:"Editar nombre",placement:"left",children:e.jsx("h4",{className:"header-title mb-1 d-block",onClick:()=>u(!0),style:{minWidth:"200px",cursor:"pointer"},children:n||"Sin nombre"})}),y?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:a,style:{minHeight:27,fieldSizing:"content"},onBlur:k,autoFocus:!0}):e.jsx(U,{content:"Editar ruta",placement:"left",children:e.jsx("small",{className:"text-muted d-block mb-1",onClick:()=>v(!0),style:{minWidth:"200px",cursor:"pointer"},children:a||"Sin ruta"})}),e.jsx(re,{label:"Extiende de base",checked:r,onChange:O,disabled:b})]})]})},q=({col:s,label:i,eRef:n,placeholder:a,required:r=!1,rows:l=3,value:o,onChange:c})=>e.jsxs("div",{className:`form-group ${s} mb-2`,children:[e.jsxs("label",{htmlFor:"",children:[i," ",r&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{ref:n,className:"form-control",placeholder:a,required:r,rows:l,defaultValue:o,style:{minHeight:l*27,fieldSizing:"content"},onChange:c})]}),oe=new I,me=({dataLoaded:s,setDataLoaded:i,modalRef:n})=>{const a=m.useRef(null),r=m.useRef(null),l=m.useRef(null),o=async c=>{c.preventDefault(),await oe.savePage({id:s.id,description:r.current.value,keywords:$(l.current).val()})&&(i(null),$(n.current).modal("hide"))};return m.useEffect(()=>{a.current.value=`${s==null?void 0:s.name} | ${K.APP_NAME}`,r.current.value=(s==null?void 0:s.description)??"",ae(l.current,(s==null?void 0:s.keywords)??[])},[s]),e.jsx(J,{modalRef:n,title:`Editar SEO - ${s==null?void 0:s.name}`,size:"sm",onSubmit:o,children:e.jsxs("div",{id:"seo-container",children:[e.jsx(Q,{eRef:a,label:"Título",disabled:!0}),e.jsx(q,{eRef:r,label:"Descripción",rows:2}),e.jsx(_,{eRef:l,label:"Palabras clave",tags:!0,multiple:!0,dropdownParent:"#seo-container"})]})})},X=({className:s,system:i,component:n,onComponentClicked:a,onDeleteClicked:r,onEditDataClicked:l})=>{var p;const o=(n==null?void 0:n.options)??[],c=o.find(u=>u.id==i.value);return e.jsxs("div",{className:`dropdown ${s}`,"data-id":i.id,children:[e.jsxs("div",{className:"btn btn-light dropdown-toggle text-truncate w-100 text-start",type:"button",id:`dd-${i.id}`,"data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true",children:[e.jsx("i",{className:"mdi mdi-chevron-down ms-1 float-end"}),e.jsxs("span",{className:"handle-sortable",style:{cursor:"move"},children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"})]}),e.jsx("span",{className:"ms-1",children:i.name})]}),e.jsxs("div",{className:"dropdown-menu","aria-labelledby":`dd-${i.id}`,"data-popper-placement":"bottom-start",children:[o.length>1&&e.jsxs(e.Fragment,{children:[o.filter(u=>u.id!=i.value).map(u=>e.jsxs("button",{className:"dropdown-item",onClick:()=>a({...i,name:`${n.name} - ${u.name}`,value:u.id}),children:[n.name," - ",u.name]})),e.jsx("div",{className:"dropdown-divider"})]}),(((p=c==null?void 0:c.using)==null?void 0:p.filters)||(c==null?void 0:c.data))&&e.jsxs("button",{className:"dropdown-item",onClick:()=>l(i,c),children:[e.jsx("i",{className:"mdi mdi-pencil me-1"}),"Configurar datos"]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>r(i),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar"]})]})]})},de=new I,ue=({dataLoaded:s,setDataLoaded:i,setSystems:n,modalRef:a})=>{var p,u,y,v,b,g,w,k,O,F,C,x,E;const[r,l]=m.useState((s==null?void 0:s.data)||{}),o={};o.model=m.useRef(null),o.filters=m.useRef(null);const c=async h=>{h.preventDefault();const d=await de.save({id:s.id,data:r,filters:$(o.filters.current).val()});d&&(i(null),$(a.current).modal("hide"),n(t=>t.map(f=>f.id==s.id?d.data:f)))};return m.useEffect(()=>{var d,t,f;const h={};(d=s==null?void 0:s.component)==null||d.data.forEach(j=>{var N;h[j]=((N=s==null?void 0:s.data)==null?void 0:N[j])??""}),l(h),o.model.current.value=((f=(t=s==null?void 0:s.component)==null?void 0:t.using)==null?void 0:f.model)??"",$(o.filters.current).val((s==null?void 0:s.filters)??[]).trigger("change")},[s]),e.jsxs(J,{modalRef:a,title:s==null?void 0:s.name,onSubmit:c,children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered",children:[e.jsx("li",{className:"nav-item",hidden:!((u=(p=s==null?void 0:s.component)==null?void 0:p.data)!=null&&u.length),children:e.jsx("a",{href:"#tab-info","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link active",children:"Información"})}),e.jsx("li",{className:"nav-item",hidden:!((v=(y=s==null?void 0:s.component)==null?void 0:y.using)!=null&&v.filters),children:e.jsx("a",{href:"#tab-db","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Base de datos"})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"tab-info",hidden:!((g=(b=s==null?void 0:s.component)==null?void 0:b.data)!=null&&g.length),children:(k=(w=s==null?void 0:s.component)==null?void 0:w.data)==null?void 0:k.map((h,d)=>e.jsx(q,{label:h,value:r[h]??"",rows:1,onChange:t=>l({...r,[h]:t.target.value})},d))}),e.jsxs("div",{className:"tab-pane show",id:"tab-db",children:[e.jsx(Q,{eRef:o.model,label:"Modelo",disabled:!0}),e.jsx(_,{eRef:o.filters,label:"Filtros",multiple:!0,dropdownParent:"#tab-db",hidden:!((F=(O=s==null?void 0:s.component)==null?void 0:O.using)!=null&&F.filters),children:(E=(x=(C=s==null?void 0:s.component)==null?void 0:C.using)==null?void 0:x.filters)==null?void 0:E.map((h,d)=>e.jsx("option",{value:h,children:h},d))})]})]})]})},pe=({components:s,onClick:i})=>e.jsx("div",{className:"left-side-menu top-0 pt-2",children:e.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[e.jsx("div",{id:"sidebar-menu",className:"show",children:e.jsxs("ul",{id:"side-menu",children:[e.jsx("li",{className:"menu-title",children:"Lista de componentes"}),s.filter(n=>n.options.length>0).map((n,a)=>e.jsx(le,{title:n.name,children:n.options.map((r,l)=>e.jsx(V,{name:r.name,icon:r.image,onClick:()=>{const o=$(".tab-pane:visible .components-container > div").last().data("id");i({name:`${n.name} - ${r.name}`,component:n.id,value:r.id,after_component:o})},children:r.name},l))},a)),e.jsx("li",{className:"menu-title",children:"Sistema de respaldo"}),e.jsx(V,{icon:"mdi mdi-cloud-download",onClick:()=>{},children:"Exportar Backup"}),e.jsx(V,{icon:"mdi mdi-backup-restore",onClick:()=>{},children:"Importar Backup"})]})}),e.jsx("div",{className:"clearfix"})]})}),he=({param:s,models:i})=>{var u,y,v;const n=m.useRef(),a=m.useRef(),r=m.useRef(),[l,o]=m.useState(null),c=b=>{const g=b.target.value,w=i.find(k=>k.name==g)??null;o(w)};m.useEffect(()=>{$(n.current).val(null).trigger("change")},[s]),m.useEffect(()=>{$(r.current).trigger("change")},[l]);const p=`${s}-container`;return e.jsxs("div",{id:p,className:"row",children:[e.jsxs("label",{className:"form-label",children:["Parámetro ",e.jsx("code",{children:s})]}),e.jsx(_,{eRef:n,label:"Modelo",col:"col-md-6",dropdownParent:`#${p}`,onChange:c,children:i.map((b,g)=>e.jsx("option",{children:b.name},g))}),e.jsx(_,{eRef:a,label:"Campo",col:"col-md-6",dropdownParent:`#${p}`,children:(u=l==null?void 0:l.fields)==null?void 0:u.map((b,g)=>e.jsx("option",{children:b},g))}),e.jsx("div",{hidden:(((y=l==null?void 0:l.relations)==null?void 0:y.length)??0)==0,children:e.jsx(_,{eRef:r,label:"Relaciones",multiple:!0,dropdownParent:`#${p}`,children:(v=l==null?void 0:l.relations)==null?void 0:v.map((b,g)=>e.jsx("option",{children:b},g))})})]})},fe=new I,xe=({dataLoaded:s,setDataLoaded:i,modalRef:n,models:a})=>{const r=async o=>{o.preventDefault(),await fe.savePage({id:s.id,description:descriptionRef.current.value,keywords:$(keywordsRef.current).val()})&&(i(null),$(n.current).modal("hide"))},l=Z((s==null?void 0:s.path)??"");return e.jsx(J,{modalRef:n,title:`Editar parámetros de URL - ${s==null?void 0:s.name}`,onSubmit:r,children:l.map((o,c)=>e.jsx(he,{param:o,models:a},c))})},H=new I,je=({systems:s,pages:i,components:n,models:a})=>{const r=m.useRef(null),l=m.useRef(null),o=m.useRef(null),[c,p]=m.useState(s),[u,y]=m.useState(i),[v,b]=m.useState(!1),[g,w]=m.useState(null),[k,O]=m.useState(null),F=async()=>{b(!0);const t=await H.savePage();t&&(b(!1),y(t))},C=async t=>{const j=$(".tab-pane:visible").data("id")??null;t.page_id=j;const N=await H.save(t);if(!N)return;const R=N.data;p(P=>P.some(S=>S.id===R.id)?P.map(S=>S.id===R.id?R:S):[...P,R])},x=async t=>{await H.delete(t.id)&&p(j=>j.filter(N=>N.id!=t.id))};m.useEffect(()=>{document.title=`Sistema | ${K.APP_NAME}`},[null]),m.useEffect(()=>{const t=$("iframe:visible");t&&$(t).attr("src",t.attr("src"))},[c,u]);const E=async t=>{w(t),$(r.current).modal("show")},h=async t=>{w(t),$(l.current).modal("show")},d=async(t,f)=>{O({...t,component:f}),$(o.current).modal("show")};return m.useEffect(()=>{[...$(".components-container")].forEach(f=>{$(f).sortable({connectWith:".components-container",handle:".handle-sortable",forcePlaceholderSize:!0,update:async function(j,N){const R=[...$(f).children()],P={};if(R.forEach(G=>{const S=$(G).data("id"),D=$(G).prev().data("id")??null,B=c.find(T=>T.id==S);(B==null?void 0:B.after_component)!==D&&(P[S]=D)}),Object.keys(P).length>0){if(!await H.updateOrder(P))return;p(S=>{const D=[...S];return Object.entries(P).forEach(([B,T])=>{const W=D.findIndex(L=>L.id==B);W!==-1&&(D[W]={...D[W],after_component:T})}),D})}}}).disableSelection()})},[u,c]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"wrapper",children:[e.jsx(pe,{components:n,onClick:C}),e.jsx("div",{className:"content-page mt-2 pb-3",style:{height:"max-content"},children:e.jsx("div",{className:"content mt-2",children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("button",{className:"button-menu-mobile d-lg-none d-md-block position-absolute ",style:{zIndex:1,border:"none",borderRadius:"0 50% 50% 0",backgroundColor:"#fff",color:"#343a40",top:"50%",left:"0",transform:"translateY(-50%)",padding:"24px 0px 20px 6px ",fontWeight:"bold"},children:"〉"}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card mb-0",children:e.jsxs("div",{className:"card-body",style:{height:"calc(100vh - 48px)"},children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered flex-nowrap",style:{overflowX:"auto",overflowY:"hidden"},children:[e.jsx("li",{className:"nav-item",children:e.jsx("a",{id:"base-template-link",href:"#base-template","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active h-100",children:"Base"})}),u.map((t,f)=>e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:`#page-${t.id}`,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link h-100",style:{whiteSpace:"nowrap"},children:[t.name,e.jsx("small",{className:"d-block text-muted",style:{fontWeight:"normal"},children:t.path})]})},f)),e.jsx("li",{className:"nav-item d-flex justify-content-center align-items-center px-2",children:e.jsx(U,{content:"Agregar página",children:e.jsx("button",{className:"nav-link btn btn-xs btn-white rounded-pill",onClick:F,disabled:v,children:v?e.jsx("i",{className:"mdi mdi-loading mdi-spin"}):e.jsx("i",{className:"mdi mdi-plus"})})})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"base-template",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"d-flex flex-column gap-2",children:Y(c).filter(t=>t.page_id==null).map(t=>{const f=n.find(j=>j.id==t.component);if(f==null||f.options,t.component=="content")return e.jsxs("button",{"data-id":t.id,className:"btn btn-light text-truncate w-100 text-start",type:"button",children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("span",{className:"ms-1",children:t.name})]});{const j=n.find(N=>N.id==t.component);return e.jsx(X,{className:"",system:t,component:j,onComponentClicked:C,onDeleteClicked:x,onEditDataClicked:d},t.id)}})})}),e.jsx("div",{className:"col-md-8",children:e.jsx("iframe",{src:"/base-template",className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 185px)",borderRadius:"4px"}})})]})}),u.map((t,f)=>e.jsx("div",{className:"tab-pane",id:`page-${t.id}`,"data-id":t.id,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx(ce,{...t,models:a,setPages:y,onSEOClicked:E,onParamsClicked:h}),e.jsx("hr",{className:"my-2"}),e.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":t.id,children:Y(c).filter(j=>j.page_id==t.id).map(j=>{const N=n.find(R=>R.id==j.component);return e.jsx(X,{className:"",system:j,component:N,onComponentClicked:C,onDeleteClicked:x,onEditDataClicked:d},j.id)})})]}),e.jsx("div",{className:"col-md-8",children:e.jsx("iframe",{src:t.path,className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 185px)",borderRadius:"4px"}})})]})},f))]})]})})})})]})})})]}),e.jsx(me,{dataLoaded:g,setDataLoaded:w,modalRef:r}),e.jsx(xe,{dataLoaded:g,setDataLoaded:w,modalRef:l,models:a}),e.jsx(ue,{dataLoaded:k,setDataLoaded:O,setSystems:p,modalRef:o})]})};te((s,i)=>{ne(s).render(e.jsx(je,{...i}))});
