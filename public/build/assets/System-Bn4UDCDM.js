var se=Object.defineProperty;var ne=(s,l,n)=>l in s?se(s,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[l]=n;var M=(s,l,n)=>(ne(s,typeof l!="symbol"?l+"":l,n),n);import{j as e}from"./AboutHeader-CpM0iYLI.js";import{r as o}from"./index-B80Lgev0.js";import{c as te}from"./ReactAppend-CBRQCQGz.js";import{C as ie}from"./CreateReactScript-wgaspG1d.js";import{i as W}from"./tippy-react.esm-CHhA99mn.js";import{m as C}from"./main-B2CtU6ez.js";import{B as re}from"./BasicEditing-Co4zseXw.js";import{S as le}from"./SwitchFormGroup-DbO3fJgb.js";import{G as Q}from"./Global-mC9lKANG.js";import{S as X}from"./SortByAfterField-BaS5rBg8.js";import{I as q}from"./InputFormGroup-aNCWUTCq.js";import{M as V}from"./Modal-Dbgjpj-3.js";import{S as A}from"./SelectFormGroup-Dk0mAUCB.js";import{S as ae}from"./SetSelectValue-UxyCmHse.js";import{a as ce,M as U}from"./MenuItemContainer-DGfKOLAz.js";import"./index-DO3Aws4m.js";import"./index.esm-Cu-mVv1q.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";/* empty css               *//* empty css              */class I extends re{constructor(){super(...arguments);M(this,"path","admin/system");M(this,"savePage",async(n={})=>{try{const{status:i,result:r}=await C.Fetch(`/api/${this.path}/page`,{method:"POST",body:JSON.stringify(n)});if(!i)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return r.data??[]}catch(i){return C.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"}),null}});M(this,"updateOrder",async n=>{try{const{status:i,result:r}=await C.Fetch(`/api/${this.path}/order`,{method:"PATCH",body:JSON.stringify(n)});if(!i)throw new Error((r==null?void 0:r.message)??"Ocurrio un error inesperado");return!0}catch(i){C.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"})}});M(this,"deletePage",async n=>{try{const{status:i,result:r}=await C.Fetch(`/api/${this.path}/page/${n}`,{method:"DELETE"});if(!i)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return r.data??!0}catch(i){return C.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"}),!1}});M(this,"exportBK",async()=>{try{const{status:n,result:i}=await C.Fetch(`/api/${this.path}/backup`);if(!n)throw new Error((i==null?void 0:i.message)||"Ocurrio un error inesperado");return i}catch(n){return C.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:n.message,type:"danger"}),null}});M(this,"importBK",async n=>{try{const i=await fetch(`/api/${this.path}/backup`,{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(C.Cookies.get("XSRF-TOKEN"))},body:n}),r=JSON.parseable(await i.text());if(!i.ok)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return r??!0}catch(i){return C.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"}),null}})}}const J=(s="")=>{s=s.replace(/[^a-zA-Z0-9_{}]/g,"");const l=/{([^}]+)}/g,n=[];let i;for(;(i=l.exec(s))!==null;)n.push(i[1]);return n},oe=(s,l)=>{const n=new RegExp(`[${l}]+$`,"g");return s.replace(n,"")},z=new I,me=s=>{const{id:l,name:n,path:i,extends_base:r=!1,setPages:c,onSEOClicked:m,onParamsClicked:a}=s,[b,p]=o.useState(!1),[w,y]=o.useState(!1),[k,S]=o.useState(!1),d=async j=>{if(n===j.target.value)return p(!1);z.savePage({id:l,name:j.target.value})&&(p(!1),c(f=>f.map(u=>u.id===l?{...u,name:j.target.value}:u)))},g=async j=>{if(i===j.target.value)return y(!1);const N=j.target.value;let f=structuredClone(N);const u=s.using??{model:null,field:null,with:[]};J(N).forEach(h=>{f=f.replace(`{${h}}`,"").replace(`{${h}?}`,""),u[h]=u[h]??{}});const t=oe(f,"/");z.savePage({id:l,path:N,pseudo_path:t,using:Object.keys(u).length>0?u:void 0})&&(y(!1),c(h=>h.map(v=>v.id===l?{...v,path:j.target.value}:v)))},E=async j=>{const N=j.target.checked;z.savePage({id:l,extends_base:N})&&(S(!1),c(u=>u.map(t=>t.id===l?{...t,extends_base:N}:t)))},P=async j=>{await z.deletePage(j.id)&&(c(f=>f.filter(u=>u.id!=j.id)),$('[data-bs-toggle="tab"]').removeClass("active"),$(".tab-pane").removeClass("active"),$("#base-template-link").addClass("active"),$("#base-template").addClass("active"))},O=J(i);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dropdown float-end",children:[e.jsx("a",{href:"#",className:"dropdown-toggle arrow-none card-drop","data-bs-toggle":"dropdown","aria-expanded":"false",children:e.jsx("i",{className:"mdi mdi-dots-vertical"})}),e.jsxs("div",{className:"dropdown-menu dropdown-menu-end",children:[e.jsxs("button",{className:"dropdown-item",onClick:()=>m(s),children:[e.jsx("i",{className:"mdi mdi-cloud-search-outline me-1"}),"Editar SEO"]}),O.length>0&&e.jsxs("button",{className:"dropdown-item",onClick:()=>a(s),children:[e.jsx("i",{className:"mdi mdi-code-braces me-1"}),"Parámetros"]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{className:"dropdown-item",onClick:()=>P(s),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar página"]})]})]}),e.jsxs("div",{children:[b?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:n,onBlur:d,autoFocus:!0}):e.jsx(W,{content:"Editar nombre",placement:"left",children:e.jsx("h4",{className:"header-title mb-1 d-block",onClick:()=>p(!0),style:{minWidth:"200px",cursor:"pointer"},children:n||"Sin nombre"})}),w?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:i,style:{minHeight:27,fieldSizing:"content"},onBlur:g,autoFocus:!0}):e.jsx(W,{content:"Editar ruta",placement:"left",children:e.jsx("small",{className:"text-muted d-block mb-1",onClick:()=>y(!0),style:{minWidth:"200px",cursor:"pointer"},children:i||"Sin ruta"})}),e.jsx(le,{label:"Extiende de base",checked:r,onChange:E,disabled:k})]})]})},L=({col:s,label:l,eRef:n,placeholder:i,required:r=!1,rows:c=3,value:m,onChange:a})=>e.jsxs("div",{className:`form-group ${s} mb-2`,children:[e.jsxs("label",{htmlFor:"",children:[l," ",r&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{ref:n,className:"form-control",placeholder:i,required:r,rows:c,defaultValue:m,style:{minHeight:c*27,fieldSizing:"content"},onChange:a})]}),ue=new I,de=({dataLoaded:s,setDataLoaded:l,modalRef:n})=>{const i=o.useRef(null),r=o.useRef(null),c=o.useRef(null),m=async a=>{a.preventDefault(),await ue.savePage({id:s.id,description:r.current.value,keywords:$(c.current).val()})&&(l(null),$(n.current).modal("hide"))};return o.useEffect(()=>{i.current.value=`${s==null?void 0:s.name} | ${Q.APP_NAME}`,r.current.value=(s==null?void 0:s.description)??"",ae(c.current,(s==null?void 0:s.keywords)??[])},[s]),e.jsx(V,{modalRef:n,title:`Editar SEO - ${s==null?void 0:s.name}`,size:"sm",onSubmit:m,children:e.jsxs("div",{id:"seo-container",children:[e.jsx(q,{eRef:i,label:"Título",disabled:!0}),e.jsx(L,{eRef:r,label:"Descripción",rows:2}),e.jsx(A,{eRef:c,label:"Palabras clave",tags:!0,multiple:!0,dropdownParent:"#seo-container"})]})})},Y=({className:s,system:l,component:n,onComponentClicked:i,onDeleteClicked:r,onEditDataClicked:c})=>{var b;const m=(n==null?void 0:n.options)??[],a=m.find(p=>p.id==l.value);return e.jsxs("div",{className:`dropdown ${s}`,"data-id":l.id,children:[e.jsxs("div",{className:"btn btn-light dropdown-toggle text-truncate w-100 text-start",type:"button",id:`dd-${l.id}`,"data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true",children:[e.jsx("i",{className:"mdi mdi-chevron-down ms-1 float-end"}),e.jsxs("span",{className:"handle-sortable",style:{cursor:"move"},children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"})]}),e.jsx("span",{className:"ms-1",children:l.name})]}),e.jsxs("div",{className:"dropdown-menu","aria-labelledby":`dd-${l.id}`,"data-popper-placement":"bottom-start",children:[m.length>1&&e.jsxs(e.Fragment,{children:[m.filter(p=>p.id!=l.value).map(p=>e.jsxs("button",{className:"dropdown-item",onClick:()=>i({...l,name:`${n.name} - ${p.name}`,value:p.id}),children:[n.name," - ",p.name]})),e.jsx("div",{className:"dropdown-divider"})]}),(((b=a==null?void 0:a.using)==null?void 0:b.filters)||(a==null?void 0:a.data))&&e.jsxs("button",{className:"dropdown-item",onClick:()=>c(l,a),children:[e.jsx("i",{className:"mdi mdi-pencil me-1"}),"Configurar datos"]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>r(l),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar"]})]})]})},he=new I,pe=({dataLoaded:s,setDataLoaded:l,setSystems:n,modalRef:i})=>{var b,p,w,y,k,S,d,g,E,P,O,j,N;const[r,c]=o.useState((s==null?void 0:s.data)||{}),m={};m.model=o.useRef(null),m.filters=o.useRef(null);const a=async f=>{f.preventDefault();const u=await he.save({id:s.id,data:r,filters:$(m.filters.current).val()});u&&(l(null),$(i.current).modal("hide"),n(t=>t.map(x=>x.id==s.id?u.data:x)))};return o.useEffect(()=>{var u,t,x;const f={};(u=s==null?void 0:s.component)==null||u.data.forEach(h=>{var v;f[h]=((v=s==null?void 0:s.data)==null?void 0:v[h])??""}),c(f),m.model.current.value=((x=(t=s==null?void 0:s.component)==null?void 0:t.using)==null?void 0:x.model)??"",$(m.filters.current).val((s==null?void 0:s.filters)??[]).trigger("change")},[s]),e.jsxs(V,{modalRef:i,title:s==null?void 0:s.name,onSubmit:a,children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered",children:[e.jsx("li",{className:"nav-item",hidden:!((p=(b=s==null?void 0:s.component)==null?void 0:b.data)!=null&&p.length),children:e.jsx("a",{href:"#tab-info","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link active",children:"Información"})}),e.jsx("li",{className:"nav-item",hidden:!((y=(w=s==null?void 0:s.component)==null?void 0:w.using)!=null&&y.filters),children:e.jsx("a",{href:"#tab-db","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Base de datos"})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"tab-info",hidden:!((S=(k=s==null?void 0:s.component)==null?void 0:k.data)!=null&&S.length),children:(g=(d=s==null?void 0:s.component)==null?void 0:d.data)==null?void 0:g.map((f,u)=>e.jsx(L,{label:f,value:r[f]??"",rows:1,onChange:t=>c({...r,[f]:t.target.value})},u))}),e.jsxs("div",{className:"tab-pane show",id:"tab-db",children:[e.jsx(q,{eRef:m.model,label:"Modelo",disabled:!0}),e.jsx(A,{eRef:m.filters,label:"Filtros",multiple:!0,dropdownParent:"#tab-db",hidden:!((P=(E=s==null?void 0:s.component)==null?void 0:E.using)!=null&&P.filters),children:(N=(j=(O=s==null?void 0:s.component)==null?void 0:O.using)==null?void 0:j.filters)==null?void 0:N.map((f,u)=>e.jsx("option",{value:f,children:f},u))})]})]})]})},Z=new I,fe=({components:s,onClick:l})=>e.jsx("div",{className:"left-side-menu top-0 pt-2",children:e.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[e.jsx("div",{id:"sidebar-menu",className:"show",children:e.jsxs("ul",{id:"side-menu",children:[e.jsx("li",{className:"menu-title",children:"Lista de componentes"}),s.filter(n=>n.options.length>0).map((n,i)=>e.jsx(ce,{title:n.name,children:n.options.map((r,c)=>e.jsx(U,{name:r.name,icon:r.image,onClick:()=>{const m=$(".tab-pane:visible .components-container > div").last().data("id");l({name:`${n.name} - ${r.name}`,component:n.id,value:r.id,after_component:m})},children:r.name},c))},i)),e.jsx("li",{className:"menu-title",children:"Sistema de respaldo"}),e.jsx(U,{icon:"mdi mdi-cloud-download",onClick:async()=>{const n=await Z.exportBK(),i=new Blob([JSON.stringify(n)],{type:"application/json"}),r=URL.createObjectURL(i),c=document.createElement("a");c.href=r,c.download="backup.json",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r)},children:"Exportar Backup"}),e.jsx("input",{type:"file",id:"file-input",accept:"application/json",style:{display:"none"},onChange:async n=>{const i=n.target.files[0];if(n.target.value=null,i){const r=new FormData;if(r.append("backup",i),!await Z.importBK(r))return;location.reload()}}}),e.jsx(U,{icon:"mdi mdi-backup-restore",onClick:()=>{document.getElementById("file-input").click()},children:"Importar Backup"})]})}),e.jsx("div",{className:"clearfix"})]})}),xe=({page:s,param:l,models:n,setUsing:i})=>{var y,k,S;const r=o.useRef(),c=o.useRef(),m=o.useRef(),[a,b]=o.useState(null),p=d=>{const g=d.target.value,E=n.find(P=>P.name==g)??null;b(E)};o.useEffect(()=>{$(r.current).val(null).trigger("change")},[l]),o.useEffect(()=>{i(d=>({...d,[l]:{...d[l],model:(a==null?void 0:a.name)??null}})),$(c.current).val(null).trigger("change"),$(m.current).val(null).trigger("change")},[a]);const w=`${l}-container`;return e.jsxs("div",{id:w,className:"row",children:[e.jsxs("label",{className:"form-label",children:["Parámetro ",e.jsx("code",{children:l})]}),e.jsx(A,{eRef:r,label:"Modelo",col:"col-md-6",dropdownParent:`#${w}`,onChange:p,children:n.map((d,g)=>e.jsx("option",{children:d.name},g))}),e.jsx(A,{eRef:c,label:"Campo",col:"col-md-6",dropdownParent:`#${w}`,onChange:d=>{i(g=>({...g,[l]:{...g[l],field:d.target.value}}))},children:(y=a==null?void 0:a.fields)==null?void 0:y.map((d,g)=>e.jsx("option",{children:d},g))}),e.jsx("div",{hidden:(((k=a==null?void 0:a.relations)==null?void 0:k.length)??0)==0,children:e.jsx(A,{eRef:m,label:"Relaciones",multiple:!0,dropdownParent:`#${w}`,onChange:d=>{const g=$(d.target).val();i(E=>({...E,[l]:{...E[l],relations:g}}))},children:(S=a==null?void 0:a.relations)==null?void 0:S.map((d,g)=>e.jsx("option",{children:d},g))})})]})},be=({dataLoaded:s,setDataLoaded:l,modalRef:n,models:i})=>{const r=J((s==null?void 0:s.path)??""),[c,m]=o.useState({}),a=async b=>{b.preventDefault(),console.log(c)};return o.useEffect(()=>{console.log(c)},[c]),o.useEffect(()=>{m((s==null?void 0:s.using)??{})},[s]),e.jsx(V,{modalRef:n,title:`Editar parámetros de URL - ${s==null?void 0:s.name}`,onSubmit:a,children:r.map((b,p)=>e.jsx(xe,{page:s,param:b,models:i,setUsing:m},p))})},G=new I,ge=({systems:s,pages:l,components:n,models:i})=>{const r=o.useRef(null),c=o.useRef(null),m=o.useRef(null),[a,b]=o.useState(s),[p,w]=o.useState(l),[y,k]=o.useState(!1),[S,d]=o.useState(null),[g,E]=o.useState(null),P=async()=>{k(!0);const t=await G.savePage();t&&(k(!1),w(t))},O=async t=>{const h=$(".tab-pane:visible").data("id")??null;t.page_id=h;const v=await G.save(t);if(!v)return;const B=v.data;b(F=>F.some(R=>R.id===B.id)?F.map(R=>R.id===B.id?B:R):[...F,B])},j=async t=>{await G.delete(t.id)&&b(h=>h.filter(v=>v.id!=t.id))};o.useEffect(()=>{document.title=`Sistema | ${Q.APP_NAME}`},[null]),o.useEffect(()=>{const t=$("iframe:visible");t&&($(t).removeAttr("src"),$(t).attr("src",t.data("path")))},[a,p]);const N=async t=>{d(t),$(r.current).modal("show")},f=async t=>{d(t),$(c.current).modal("show")},u=async(t,x)=>{E({...t,component:x}),$(m.current).modal("show")};return o.useEffect(()=>{[...$(".components-container")].forEach(x=>{$(x).sortable({connectWith:".components-container",handle:".handle-sortable",forcePlaceholderSize:!0,update:async function(h,v){const B=[...$(x).children()],F={};if(B.forEach(T=>{const R=$(T).data("id"),D=$(T).prev().data("id")??null,_=a.find(H=>H.id==R);(_==null?void 0:_.after_component)!==D&&(F[R]=D)}),Object.keys(F).length>0){if(!await G.updateOrder(F))return;b(R=>{const D=[...R];return Object.entries(F).forEach(([_,H])=>{const K=D.findIndex(ee=>ee.id==_);K!==-1&&(D[K]={...D[K],after_component:H})}),D})}}}).disableSelection()})},[p,a]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"wrapper",children:[e.jsx(fe,{components:n,onClick:O}),e.jsx("div",{className:"content-page mt-2 pb-3",style:{height:"max-content"},children:e.jsx("div",{className:"content mt-2",children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("button",{className:"button-menu-mobile d-lg-none d-md-block position-absolute ",style:{zIndex:1,border:"none",borderRadius:"0 50% 50% 0",backgroundColor:"#fff",color:"#343a40",top:"50%",left:"0",transform:"translateY(-50%)",padding:"24px 0px 20px 6px ",fontWeight:"bold"},children:"〉"}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card mb-0",children:e.jsxs("div",{className:"card-body",style:{height:"calc(100vh - 48px)"},children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered flex-nowrap",style:{overflowX:"auto",overflowY:"hidden"},children:[e.jsx("li",{className:"nav-item",children:e.jsx("a",{id:"base-template-link",href:"#base-template","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active h-100",children:"Base"})}),p.map((t,x)=>e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:`#page-${t.id}`,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link h-100",style:{whiteSpace:"nowrap"},children:[t.name,e.jsx("small",{className:"d-block text-muted",style:{fontWeight:"normal"},children:t.path})]})},x)),e.jsx("li",{className:"nav-item d-flex justify-content-center align-items-center px-2",children:e.jsx(W,{content:"Agregar página",children:e.jsx("button",{className:"nav-link btn btn-xs btn-white rounded-pill",onClick:P,disabled:y,children:y?e.jsx("i",{className:"mdi mdi-loading mdi-spin"}):e.jsx("i",{className:"mdi mdi-plus"})})})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"base-template",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"d-flex flex-column gap-2",children:X(a).filter(t=>t.page_id==null).map(t=>{const x=n.find(h=>h.id==t.component);if(x==null||x.options,t.component=="content")return e.jsxs("button",{"data-id":t.id,className:"btn btn-light text-truncate w-100 text-start",type:"button",children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("span",{className:"ms-1",children:t.name})]});{const h=n.find(v=>v.id==t.component);return e.jsx(Y,{className:"",system:t,component:h,onComponentClicked:O,onDeleteClicked:j,onEditDataClicked:u},t.id)}})})}),e.jsx("div",{className:"col-md-8",children:e.jsx("iframe",{src:"/base-template","data-path":"/base-template",className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 185px)",borderRadius:"4px"}})})]})}),p.map((t,x)=>e.jsx("div",{className:"tab-pane",id:`page-${t.id}`,"data-id":t.id,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx(me,{...t,models:i,setPages:w,onSEOClicked:N,onParamsClicked:f}),e.jsx("hr",{className:"my-2"}),e.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":t.id,children:X(a).filter(h=>h.page_id==t.id).map(h=>{const v=n.find(B=>B.id==h.component);return e.jsx(Y,{className:"",system:h,component:v,onComponentClicked:O,onDeleteClicked:j,onEditDataClicked:u},h.id)})})]}),e.jsx("div",{className:"col-md-8",children:e.jsx("iframe",{src:(t==null?void 0:t.pseudo_path)||t.path,"data-path":(t==null?void 0:t.pseudo_path)||t.path,className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 185px)",borderRadius:"4px"}})})]})},x))]})]})})})})]})})})]}),e.jsx(de,{dataLoaded:S,setDataLoaded:d,modalRef:r}),e.jsx(be,{dataLoaded:S,setDataLoaded:d,modalRef:c,models:i}),e.jsx(pe,{dataLoaded:g,setDataLoaded:E,setSystems:b,modalRef:m})]})};ie((s,l)=>{te(s).render(e.jsx(ge,{...l}))});
