var ie=Object.defineProperty;var ne=(c,i,o)=>i in c?ie(c,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[i]=o;var F=(c,i,o)=>ne(c,typeof i!="symbol"?i+"":i,o);import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{r as t}from"./index-BH53Isel.js";import{c as ce}from"./ReactAppend-DTVVXReZ.js";import{s as v}from"./server.browser-Bf4gQIc7.js";import{D as oe}from"./DeliveryPricesRest-CEiqxoNc.js";import"./main-BvVILmTO.js";import{B as le}from"./BasicRest-C_0LADdJ.js";import{C as ae}from"./CreateReactScript-D1akKh24.js";import{S as pe}from"./ProductCard-erObE6pO.js";import{B as ue}from"./Base-Bx9xWe1P.js";import{D as _}from"./DxButton-CsjWvhyj.js";import{M as B}from"./Modal-CIqmjseY.js";import{T as P}from"./Table-CP679pea.js";import{I as m}from"./InputFormGroup-D5I6zpZc.js";import{S as me}from"./SelectFormGroup-YqB1XVb8.js";import{S as O}from"./SwitchFormGroup-DUGhyqoj.js";import{T as fe}from"./TextareaFormGroup-CdwdsTk2.js";import{N as H}from"./Number2Currency-e57Tgsuk.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./index.esm-CveLAcri.js";import"./Global-CklCDfn9.js";/* empty css               *//* empty css              */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./tippy-react.esm-BWiGTO87.js";import"./index-rimy3MAc.js";import"./Logout-LH3dzJpV.js";import"./MenuItemContainer-BwGvRAHs.js";class de extends le{constructor(){super(...arguments);F(this,"path","admin/types_delivery");F(this,"hasFiles",!0)}}const b=new oe,J=new de,he=({ubigeo:c=[]})=>{const i=t.useRef(),o=t.useRef(),y=t.useRef(),G=t.useRef(),R=t.useRef(),j=t.useRef(),f=t.useRef(),w=t.useRef(),C=t.useRef(),d=t.useRef(),h=t.useRef(),N=t.useRef(),T=t.useRef(),[I,A]=t.useState(!1),[V,M]=t.useState(!1),[K,L]=t.useState(!1),[p,D]=t.useState(!1),[x,q]=t.useState(!1),z=e=>{console.log(e),e!=null&&e.id?A(!0):A(!1),j.current.value=(e==null?void 0:e.id)??"",$(f.current).val((e==null?void 0:e.ubigeo)??null).trigger("change"),L((e==null?void 0:e.price)===null),d.current&&(d.current.checked=(e==null?void 0:e.is_free)??!1,D((e==null?void 0:e.is_free)??!1)),h.current&&(h.current.checked=(e==null?void 0:e.is_agency)??!1,q((e==null?void 0:e.is_agency)??!1)),w.current.value=(e==null?void 0:e.price)??0,N.current.value=(e==null?void 0:e.express_price)??0,T.current.value=(e==null?void 0:e.agency_price)??0,C.current.value=(e==null?void 0:e.description)??"",$(y.current).modal("show")},Q=async e=>{e.preventDefault();const s=c.find(u=>u.reniec==f.current.value),n={id:j.current.value||void 0,name:`${s.distrito}, ${s.departamento}`.toTitleCase(),price:K||p?null:w.current.value,is_free:d.current.checked,is_agency:h.current.checked,express_price:N.current.value,agency_price:T.current.value,description:C.current.value,ubigeo:f.current.value};await b.save(n)&&($(i.current).dxDataGrid("instance").refresh(),$(y.current).modal("hide"))},E=t.useRef(),S=t.useRef(),k=t.useRef(),[l,a]=t.useState([{value:""}]),W=()=>{a([...l,{value:""}])},X=(e,s)=>{const n=[...l];n[e].value=s,a(n)},Y=e=>{if(l.length<=1)return;const s=l.filter((n,g)=>g!==e);a(s)},Z=()=>{$(G.current).modal("show")},ee=e=>{e!=null&&e.id?M(!0):M(!1),E.current.value=(e==null?void 0:e.id)??"",S.current.value=(e==null?void 0:e.name)??"",k.current.value=(e==null?void 0:e.description)??"",e!=null&&e.characteristics&&e.characteristics.length>0?a(e.characteristics.map(s=>({value:s}))):a([{value:""}]),$(R.current).modal("show")},re=async e=>{e.preventDefault();const s=new FormData;s.append("name",S.current.value),s.append("description",k.current.value),V&&s.append("id",E.current.value);const n=l.map(u=>u.value.trim()).filter(u=>u.length>0);s.append("characteristics",JSON.stringify(n)),await J.save(s)&&($(o.current).dxDataGrid("instance").refresh(),$(R.current).modal("hide"),a([{value:""}]))},se=async e=>{const{isConfirmed:s}=await pe.fire({title:"Eliminar registro",text:"¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!s||!await b.delete(e)||$(i.current).dxDataGrid("instance").refresh()},U=e=>$(v.renderToString(r.jsxs("span",{children:[r.jsx("span",{className:"d-block w-100 text-truncate",children:e.text.replace(e.id,"")}),r.jsxs("small",{className:"d-block",children:["Ubigeo: ",e.id]})]}))),te=async e=>{const s=e.target.files[0];if(!s)return;e.target.value=null;const n=new FormData;n.append("excel",s),await b.upload(n)&&$(i.current).dxDataGrid("instance").refresh()};return r.jsxs(r.Fragment,{children:[r.jsx("input",{id:"file-input",type:"file",accept:".xlsx, .xls",style:{display:"none"},onChange:te}),r.jsx(P,{gridRef:i,title:"Costos de envío",rest:b,exportable:!0,exportableName:"delivery.prices",toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",hint:"Cargar archivo Excel",onClick:()=>document.getElementById("file-input").click()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(i.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo registro",hint:"Nuevo registro",onClick:()=>z()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",text:"Actualizar datos de Delivery",hint:"Actualizar datos de Delivery",onClick:()=>Z()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"ubigeo",caption:"Ubigeo (RENIEC)",width:"150px"},{dataField:"name",caption:"Envío a",width:"200px",allowExporting:!1},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:s})=>{e.html(s.description||'<i class="text-muted">- Sin descripción -</i>')}},{dataField:"is_free",caption:"¿Envío gratis?",cellTemplate:(e,{data:s})=>{e.html(s.is_free)}},{dataField:"price",caption:"Precio",dataType:"number",width:"150px",cellTemplate:(e,{data:s})=>{s.is_free?e.html(v.renderToString(r.jsxs("div",{className:"row",children:[" ",r.jsx("span",{className:"text-muted font-italic",children:"Delivery Gratis"}),r.jsxs("span",{className:"text-muted",children:["Express:"," ",r.jsxs("span",{className:"font-monospace text-reset",children:["S/."," ",H(s.express_price)]})]})]}))):s.price>0?e.html(v.renderToString(r.jsxs("span",{children:["S/. ",H(s.price)]}))):e.text("Gratis")}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:s})=>{e.css("text-overflow","unset"),e.append(_({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>z(s)})),e.append(_({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>se(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(B,{modalRef:y,title:I?"Editar Costo de envío":"Agregar Costo de envío",onSubmit:Q,size:"md",children:[r.jsx("input",{ref:j,type:"hidden"}),r.jsxs("div",{id:"form-container",className:"row",children:[r.jsx(me,{eRef:f,label:"Distrito/Ubigeo",templateResult:U,templateSelection:U,dropdownParent:"#form-container",required:!0,children:c.map((e,s)=>r.jsxs("option",{value:e.reniec,children:[e.reniec," ",e.distrito," ",e.provincia," ",e.departamento]},s))}),r.jsxs("div",{className:"row",children:[r.jsx(O,{eRef:d,label:"¿Delivery gratis?",col:"col-6",onChange:e=>D(e.target.checked),checked:p,refreshable:[p]}),r.jsx(O,{eRef:h,label:"¿Recogo en agencia?",col:"col-6",onChange:e=>{q(e.target.checked),D(!1)},checked:x,refreshable:[x]})]}),r.jsx("div",{className:"col-12",hidden:p||x,children:r.jsx(m,{eRef:w,label:"Costo de envío",col:"col-12",type:"number",step:.01,required:!0})}),r.jsx("div",{className:"col-12",hidden:!p,children:r.jsx(m,{eRef:N,label:"Costo de envío Express",col:"col-12",type:"number",step:.01,required:!0})}),r.jsx("div",{className:"col-12",hidden:!x,children:r.jsx(m,{eRef:T,label:"Costo de envío a Agencia",col:"col-12",type:"number",step:.01,required:!0})}),r.jsx(fe,{eRef:C,label:"Descripción",rows:2})]})]}),r.jsx(B,{modalRef:G,title:"Tipos de Delivery",size:"lg",children:r.jsx(P,{gridRef:o,title:"Tipos de Delivery",rest:J,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(o.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Nombre",width:"150px",allowExporting:!1},{dataField:"description",caption:"Descripción",width:"300px",cellTemplate:(e,{data:s})=>{e.html(s.description||'<i class="text-muted">- Sin descripción -</i>')}},{dataField:"characteristics",caption:"Caracteristicas",width:"200px",cellTemplate:(e,{data:s})=>{s.characteristics&&s.characteristics.forEach(n=>{e.css("text-overflow","unset"),e.append(v.renderToString(r.jsx("li",{className:"d-flex gap-2",children:r.jsxs("i",{className:"text-muted font-italic d-block",children:["- ",n]})})))})}},{caption:"Acciones",width:"50px",cellTemplate:(e,{data:s})=>{e.css("text-overflow","unset"),e.append(_({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>ee(s)}))},allowFiltering:!1,allowExporting:!1}]})}),r.jsxs(B,{modalRef:R,title:I?"Editar tipo de Delivery":"Agregar tipo de Delivery",onSubmit:re,size:"sm",children:[r.jsx("input",{ref:E,type:"hidden"}),r.jsxs("div",{id:"form-container",className:"row",children:[r.jsxs("div",{className:"col-12",children:[r.jsx(m,{eRef:S,label:"Nombre",col:"col-12",type:"string",disabled:!0}),r.jsx(m,{eRef:k,label:"descripcion",col:"col-12",type:"string",required:!0})]}),r.jsx("div",{className:"col-12",children:r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"Características"}),l.map((e,s)=>r.jsxs("div",{className:"input-group mb-2",children:[r.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Egresada de la Universidad Nacional Federico Villarreal.",value:e.value,onChange:n=>X(s,n.target.value)}),r.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>Y(s),disabled:l.length<=1,children:r.jsx("i",{className:"fas fa-times"})})]},s)),r.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:W,children:[r.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]})})]})]})]})};ae((c,i)=>{ce.createRoot(c).render(r.jsx(ue,{...i,title:"Costos de envio",children:r.jsx(he,{...i})}))});
