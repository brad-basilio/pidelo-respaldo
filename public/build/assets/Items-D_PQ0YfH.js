import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{B as Ne}from"./Base-BFtqwy-4.js";import{S as D}from"./SwitchFormGroup-DUGhyqoj.js";import{T as Fe}from"./TextareaFormGroup-CdwdsTk2.js";import{r as n}from"./index-BH53Isel.js";import{c as Ie}from"./ReactAppend-DTVVXReZ.js";import{s as J}from"./server.browser-Bf4gQIc7.js";import{S as De}from"./ProductCard-Bvp3XiVT.js";import{I as le}from"./ItemsRest-DWb8q5UA.js";import{M as Y}from"./Modal-CIqmjseY.js";import{T as Te}from"./Table-DitbKwtZ.js";import{I as V}from"./ImageFormGroup-BPR9pDAU.js";import{I as C}from"./InputFormGroup-D5I6zpZc.js";import{Q as ke}from"./QuillFormGroup-D8zDHSfJ.js";import{S as Z}from"./SelectAPIFormGroup-BYWbn4kr.js";import{S as A}from"./SelectFormGroup-YqB1XVb8.js";import{D as ee}from"./DxButton-DV0H-ZcL.js";import{C as $e}from"./CreateReactScript-DXC7x6lV.js";import{C as re,N as te}from"./Number2Currency-DqtNgFrj.js";import{R as N}from"./ReactAppend-D7S498fx.js";import{S as se}from"./SetSelectValue-UxyCmHse.js";import"./main-BvVILmTO.js";import"./index-yBjzXJbu.js";import"./Global-CQLDm_nT.js";import"./tippy-react.esm-BWiGTO87.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-7s5dsuEK.js";import"./MenuItemContainer-BwGvRAHs.js";import"./index.esm-CveLAcri.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./BasicRest-C_0LADdJ.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";const ne=({label:R,structure:g,onChange:y,typeOptions:F=[]})=>{const[a,b]=n.useState([]),p=()=>{b(typeof g=="object"?[...a,{...g}]:[...a,""])},x=i=>{const c=a.filter((d,l)=>l!==i);b(c),y(c)},j=(i,c,d)=>{const l=[...a];typeof l[i]=="object"?l[i][c]=d:l[i]=d,b(l),y(l)};return r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:R}),a.map((i,c)=>{const d=a.length%2!==0&&c===a.length-1;return r.jsxs("div",{className:"row g-2 mb-2",children:[typeof i=="object"?Object.keys(g).map(l=>r.jsx("div",{className:d?"col-9":"col-6",children:l==="type"?r.jsxs("select",{className:"form-select",value:i[l],onChange:u=>j(c,l,u.target.value),children:[r.jsx("option",{value:"",children:"Seleccionar..."}),F.map(u=>r.jsx("option",{value:u,children:u},u))]}):r.jsx("input",{type:"text",className:"form-control",value:i[l],onChange:u=>j(c,l,u.target.value),placeholder:l})},l)):r.jsx("div",{className:d?"col-9":"col-6",children:r.jsx("input",{type:"text",className:"form-control",value:i,onChange:l=>j(c,null,l.target.value),placeholder:"Característica"})}),r.jsx("div",{className:"col-3",children:r.jsx("button",{type:"button",className:"btn btn-danger w-100",onClick:()=>x(c),children:"X"})})]},c)}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:p,children:"+ Agregar"})]})},Ee=new le,_e=({gridRef:R,modalRef:g})=>{const[y,F]=n.useState(null),[a,b]=n.useState(!1),[p,x]=n.useState(""),[j,i]=n.useState(!1),c=l=>{F(l.target.files[0])},d=async()=>{var u,w;if(!y){x("Por favor, selecciona un archivo."),i(!0);return}const l=new FormData;l.append("file",y),b(!0);try{const m=await Ee.importData(l);if(console.log(m),m.error){const I=Array.isArray(m.error)?m.error.join(`
`):m.error;x(`Error en la importación:
${I}`),i(!0)}else x(m.message),i(!1),$(R.current).dxDataGrid("instance").refresh(),g.current&&g.current.close()}catch(m){x("Error al importar: "+(((w=(u=m.response)==null?void 0:u.data)==null?void 0:w.error)||m.message)),i(!0)}b(!1)};return r.jsx("div",{className:"bg-white",children:r.jsxs("div",{className:"modal-content",children:[r.jsx("div",{children:r.jsx("input",{className:"form-control",type:"file",accept:".xlsx",onChange:c})}),r.jsx("button",{onClick:d,disabled:a,className:"btn btn-primary mt-2",type:"button",children:a?"Subiendo...":"Subir Archivo"}),p&&r.jsx("div",{className:`alert ${j?"alert-danger":"alert-success"} mt-2`,role:"alert",children:r.jsx("div",{className:"alert-message",children:p})})]})})},T=new le,Ge=({categories:R,brands:g,collections:y,shops:F})=>{//!FALTA EDIT AND DELETEDE GALERIA
const[a,b]=n.useState([]),p=n.useRef(),x=n.useRef(),j=n.useRef(),i=n.useRef(),c=n.useRef(),d=n.useRef(),l=n.useRef(),u=n.useRef(),w=n.useRef(),m=n.useRef(),I=n.useRef(),P=n.useRef(),B=n.useRef(),O=n.useRef(),M=n.useRef(),k=n.useRef(),E=n.useRef(),q=n.useRef(),L=n.useRef(),U=n.useRef(),oe=n.useRef([]),ie=n.useRef([]),[ce,Q]=n.useState(!1),[ae,ue]=n.useState(null),[Ae,me]=n.useState(null),[Pe,pe]=n.useState(null),[_,v]=n.useState([]),H=n.useRef(),de=e=>{const s=Array.from(e.target.files).map(o=>({file:o,url:URL.createObjectURL(o)}));v(o=>[...o,...s])},fe=e=>{e.preventDefault();const s=Array.from(e.dataTransfer.files).map(o=>({file:o,url:URL.createObjectURL(o)}));v(o=>[...o,...s])},ge=e=>{e.preventDefault()},he=(e,t)=>{e.preventDefault(),_[t].id?v(o=>o.map((f,S)=>S===t?{...f,toDelete:!0}:f)):v(o=>o.filter((f,S)=>S!==t))};n.useEffect(()=>{if(a&&a.images){const e=a.images.map(t=>({id:t.id,url:`/storage/images/item_image/${t.url}`}));v(e)}},[a]);const W=e=>{var t,s;if(console.log(e),b(e||null),e!=null&&e.id?Q(!0):Q(!1),j.current.value=(e==null?void 0:e.id)||"",$(i.current).val((e==null?void 0:e.category_id)||null).trigger("change"),$(c.current).val((e==null?void 0:e.shop_id)||null).trigger("change"),$(d.current).val((e==null?void 0:e.collection_id)||null).trigger("change"),se(l.current,(t=e==null?void 0:e.subcategory)==null?void 0:t.id,(s=e==null?void 0:e.subcategory)==null?void 0:s.name),$(u.current).val((e==null?void 0:e.brand_id)||null).trigger("change"),w.current.value=(e==null?void 0:e.name)||"",m.current.value=(e==null?void 0:e.color)||"",I.current.value=(e==null?void 0:e.summary)||"",P.current.value=(e==null?void 0:e.price)||0,B.current.value=(e==null?void 0:e.weight)||0,O.current.value=(e==null?void 0:e.discount)||0,se(M.current,(e==null?void 0:e.tags)??[],"id","name"),k.current.value=null,E.current.value=null,k.image.src=`/storage/images/item/${(e==null?void 0:e.banner)??"undefined"}`,E.image.src=`/storage/images/item/${(e==null?void 0:e.image)??"undefined"}`,q.image.src=`/storage/images/item/${(e==null?void 0:e.texture)??"undefined"}`,L.editor.root.innerHTML=(e==null?void 0:e.description)??"",e!=null&&e.images){const o=e.images.map(f=>({id:f.id,url:`/api/items/gallery/media/${f.url}`}));v(o)}else v([]);U.current.value=e==null?void 0:e.stock,$(x.current).modal("show")},xe=async e=>{e.preventDefault();const t={id:j.current.value||void 0,category_id:i.current.value,shop_id:c.current.value,collection_id:d.current.value||null,subcategory_id:l.current.value,brand_id:u.current.value,name:w.current.value,color:m.current.value,summary:I.current.value,price:P.current.value,weight:B.current.value,discount:O.current.value,tags:$(M.current).val(),description:L.current.value,sotck:U.current.value},s=new FormData;for(const h in t)s.append(h,t[h]);s.append("features",JSON.stringify(ve)),s.append("specifications",JSON.stringify(ye));const o=E.current.files[0];o&&s.append("image",o);const f=q.current.files[0];f&&s.append("texture",f);const S=k.current.files[0];S&&s.append("banner",S),_.forEach((h,K)=>{h.toDelete||(h.file?s.append(`gallery[${K}]`,h.file):s.append(`gallery_ids[${K}]`,h.id))});const X=_.filter(h=>h.toDelete).map(h=>parseInt(h.id,10));X.length>0&&s.append("deleted_images",JSON.stringify(X)),console.log(s),await T.save(s)&&($(p.current).dxDataGrid("instance").refresh(),$(x.current).modal("hide"),v([]))},be=async({id:e,value:t})=>{await T.boolean({id:e,field:"visible",value:t})&&$(p.current).dxDataGrid("instance").refresh()},G=async({id:e,field:t,value:s})=>{await T.boolean({id:e,field:t,value:s})&&$(p.current).dxDataGrid("instance").refresh()},je=async e=>{const{isConfirmed:t}=await De.fire({title:"Eliminar curso",text:"¿Estás seguro de eliminar este curso?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await T.delete(e)||$(p.current).dxDataGrid("instance").refresh()},[ve,Re]=n.useState([]),[ye,we]=n.useState([]),Se=["General","Principal","Otro"],[Be,Oe]=n.useState(!1),z=n.useRef(),Ce=()=>{$(z.current).modal("show")};return r.jsxs(r.Fragment,{children:[r.jsx(Te,{gridRef:p,title:"Items",rest:T,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(p.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>W()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",text:"Importar Datos",hint:"Importar Datos",onClick:()=>Ce()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:t})=>{var s,o,f;e.html(J.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{className:"d-block fst-italic text-muted",children:(s=t.collection)==null?void 0:s.name}),r.jsx("b",{className:"d-block",children:(o=t.category)==null?void 0:o.name}),r.jsx("small",{className:"text-muted",children:(f=t.subcategory)==null?void 0:f.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",minWidth:"300px",cellTemplate:(e,{data:t})=>{e.html(J.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{children:t.name}),r.jsx("br",{}),r.jsx("span",{className:"truncate",children:t.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:t})=>{e.html(J.renderToString(r.jsxs(r.Fragment,{children:[t.discount>0&&r.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:[re(),te(t.price)]}),r.jsxs("span",{children:[re(),te(t.discount>0?t.discount:t.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{N(e,r.jsx("img",{src:`/storage/images/item/${t.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:s=>s.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{N(e,r.jsx(D,{checked:t.is_new,onChange:s=>G({id:t.id,field:"is_new",value:s.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{N(e,r.jsx(D,{checked:t.offering,onChange:s=>G({id:t.id,field:"offering",value:s.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{N(e,r.jsx(D,{checked:t.recommended,onChange:s=>G({id:t.id,field:"recommended",value:s.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{N(e,r.jsx(D,{checked:t.featured,onChange:s=>G({id:t.id,field:"featured",value:s.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{N(e,r.jsx(D,{checked:t.visible,onChange:s=>be({id:t.id,value:s.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(ee({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>W(t)})),e.append(ee({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>je(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(Y,{modalRef:x,title:ce?"Editar curso":"Agregar curso",onSubmit:xe,size:"xl",children:[r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:j,type:"hidden"}),r.jsxs("div",{className:"col-md-3",children:[r.jsx(A,{eRef:c,label:"Tienda",required:!0,dropdownParent:"#principal-container",onChange:e=>me(e.target.value),children:F.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(A,{eRef:i,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>ue(e.target.value),children:R.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(A,{eRef:d,label:"Colección",dropdownParent:"#principal-container",onChange:e=>pe(e.target.value),children:y.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(Z,{eRef:l,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",ae],dropdownParent:"#principal-container"}),r.jsx(A,{eRef:u,label:"Marca",required:!0,dropdownParent:"#principal-container",children:g.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(C,{label:"Stock",eRef:U,type:"number"}),r.jsx(C,{eRef:B,label:"Peso",type:"number",step:"0.01",required:!0}),r.jsx(C,{eRef:P,label:"Precio",type:"number",step:"0.01",required:!0}),r.jsx(C,{eRef:O,label:"Descuento",type:"number",step:"0.01"}),r.jsx(Z,{id:"tags",eRef:M,searchAPI:"/api/admin/tags/paginate",searchBy:"name",label:"Tags",dropdownParent:"#principal-container",tags:!0,multiple:!0})]}),r.jsxs("div",{className:"col-md-4",children:[r.jsx(C,{eRef:w,label:"Nombre",required:!0}),r.jsx(C,{eRef:m,label:"Color",required:!0}),r.jsx(V,{eRef:q,label:"Imagen Textura",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsx(Fe,{eRef:I,label:"Resumen",rows:3,required:!0}),r.jsx(ne,{ref:oe,label:"Características",structure:"",onChange:Re}),r.jsx(ne,{ref:ie,label:"Especificaciones",structure:{type:"",title:"",description:""},onChange:we,typeOptions:Se})]}),r.jsx("div",{className:"col-md-5",children:r.jsxs("div",{className:"row",children:[r.jsx(V,{eRef:k,label:"Banner",aspect:2/1,col:"col-12"}),r.jsx(V,{eRef:E,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[r.jsx("label",{className:"form-label",children:"Galeria"}),r.jsx("input",{id:"input-item-gallery",ref:H,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:de}),r.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"209px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>H.current.click(),onDrop:fe,onDragOver:ge,children:r.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),r.jsx("div",{className:"col-md-12 col-sm-6",children:r.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:_.map((e,t)=>r.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[r.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),r.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:s=>he(s,t),children:"×"})]},t))})})]})})]}),r.jsx("hr",{className:"my-1"}),r.jsx(ke,{eRef:L,label:"Descripcion"})]}),r.jsx(Y,{modalRef:z,title:"Importar Datos",size:"sm",children:r.jsx(_e,{gridRef:p,modalRef:z})})]})};$e((R,g)=>{Ie.createRoot(R).render(r.jsx(Ne,{...g,title:"Items",children:r.jsx(Ge,{...g})}))});
