var T=Object.defineProperty;var U=(i,r,o)=>r in i?T(i,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[r]=o;var y=(i,r,o)=>U(i,typeof r!="symbol"?r+"":r,o);import{j as e}from"./AboutHeader-ClKiNAEV.js";import{r as l}from"./index-DFv2mRv-.js";import{c as W}from"./ReactAppend-D9rqaU78.js";import"./RepositoryDropzone-DAT-gqkr.js";import{m}from"./main-rZoj-gSW.js";import{i as N}from"./tippy-react.esm-CGYKl-Jd.js";import{S as O}from"./ProductCard-NsyC22vv.js";import{G as w}from"./Global-BM4Id4Pw.js";import{M as K}from"./Modal-tOR4k_s7.js";import{I as B}from"./InputFormGroup-C-k79te8.js";import{B as X}from"./ModalImportItem-DaJ_kNWW.js";import{C as Z}from"./CreateReactScript-DK5CBHAx.js";import{B as H}from"./Base-3dtYWcq-.js";import"./index-Sd7so-oN.js";import"./___vite-browser-external_commonjs-proxy-BQdpDcDf.js";import"./index.esm-BAuPgmiI.js";/* empty css               *//* empty css              */import"./General-BmbBKdsB.js";import"./Logout-CnsEv7kI.js";import"./MenuItemContainer-EpS2kX4S.js";class J extends X{constructor(){super(...arguments);y(this,"path","admin/repository");y(this,"hasFiles",!0)}}const p=new J,Q=100*1024*1024,V=i=>i.startsWith("image/")?"mdi-image":i.startsWith("video/")?"mdi-video":i.startsWith("audio/")?"mdi-music":i.includes("pdf")?"mdi-file-pdf":i.includes("word")?"mdi-file-word":i.includes("sheet")?"mdi-file-excel":"mdi-file",Y=i=>{if(i===0)return"0 Bytes";const r=1024,o=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(i)/Math.log(r));return parseFloat((i/Math.pow(r,d)).toFixed(2))+" "+o[d]},ee=({files:i,height:r="calc(100vh - 240px)",selectable:o,multiple:d=!0,selectedFiles:M=[],setSelectedFiles:f=()=>{}})=>{const x=l.useRef(),h=l.useRef(),g=l.useRef(),j=l.useRef(),R=l.useRef(),[k,v]=l.useState(!1),[C,D]=l.useState(!1),[b,u]=l.useState(i||[]),E=t=>{t.preventDefault(),t.stopPropagation(),v(!0)},_=t=>{t.preventDefault(),t.stopPropagation(),v(!1)},P=async t=>{t.preventDefault(),t.stopPropagation(),v(!1);const s=Array.from(t.dataTransfer.files);F(s)},A=t=>{const s=Array.from(t.target.files);F(s),h.current.value=null},F=async t=>{D(!0);for(const s of t){if(s.size>Q){m.Notify.add({title:"Error",type:"danger",body:`El archivo ${s.name} excede el límite de 40MB`,icon:"/assets/img/icon.svg"});continue}const n=new FormData;n.append("name",s.name),n.append("file",s);try{const a=await p.save(n);a&&(u(c=>[...c,a]),m.Notify.add({title:"Operación correcta",body:`Archivo ${s.name} subido correctamente`,icon:"/assets/img/icon.svg"}))}catch{m.Notify.add({title:"Error",type:"danger",body:`Error al subir ${s.name}`,icon:"/assets/img/icon.svg"})}}D(!1)},L=t=>{g.current.value=t.id,R.current.value=t.name,j.current.value=t.name,$(x.current).modal("show")},I=async t=>{t.preventDefault();const s=new FormData;s.append("id",g.current.value),s.append("name",j.current.value);const n=await p.save(s);n&&(u(a=>a.map(c=>c.id===n.id?n:c)),$(x.current).modal("hide"))},S=({name:t,file:s,relative:n=!1})=>{const a=n?`/cloud/${s}`:`${w.APP_URL}/cloud/${s}`;m.Clipboard.copy(a,()=>{m.Notify.add({title:"Enlace copiado",body:`${n?"La ruta":"El enlace"} al archivo ${t} ha sido copiado al portapapeles`,icon:"/assets/img/icon.svg"})})},z=async t=>{const{isConfirmed:s}=await O.fire({title:"¿Estás seguro?",text:"¿Estás seguro de que deseas eliminar este archivo?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!s||!await p.delete(t)||u(a=>a.filter(c=>c.id!==t))},q=async()=>{const t=await p.paginate({isLoadingAll:!0});t&&u(t.data)};l.useEffect(()=>{b.length==0&&q()},[null]);const G=(t,s)=>{const n=t.target.checked;if(!d)return f([s]);f(n?a=>[...a,s]:a=>a.filter(c=>c.id!==s.id))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${k?"dragging":""}`,onDragEnter:E,onDragOver:E,onDragLeave:_,onDrop:P,children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("input",{type:"file",ref:h,className:"d-none",multiple:!0,onChange:A}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>h.current.click(),disabled:C,type:"button",children:C?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-loading mdi-spin me-1"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-upload me-1"}),"Subir archivos"]})})]}),e.jsx("div",{className:"repository-dropzone",style:{height:r,userSelect:"none"},children:k?e.jsxs("div",{className:"drop-overlay",children:[e.jsx("i",{className:"mdi mdi-cloud-upload mdi-48px mb-2"}),e.jsx("h4",{children:"Suelta los archivos aquí"})]}):b.length>0?e.jsx("div",{className:"d-flex flex-wrap align-items-center justify-content-center gap-2",children:b.map((t,s)=>{const n=M.find(a=>a.id===t.id);return e.jsxs("div",{className:"card my-0",style:{width:"140px",height:"max-content",boxShadow:"5px 5px 10px rgba(0, 0, 0, 0.2)"},children:[e.jsxs("label",{href:`${w.APP_URL}/cloud/${t.file}`,className:"rounded position-relative w-100 bg-dark d-flex align-items-center justify-content-center text-white cursor-pointer",style:{aspectRatio:5/3},onClick:()=>{if(!o){const a=document.createElement("a");a.href=`${w.APP_URL}/cloud/${t.file}`,a.target="_blank",a.click(),a.remove()}},children:[o&&e.jsx("input",{name:"input-file-selectable",type:d?"checkbox":"radio",className:"position-absolute form-check-input m-0",style:{top:"6px",left:"6px"},checked:!!n,onChange:a=>G(a,t)}),t.file_mimetype.startsWith("image/")&&t.file_mimetype!=="image/svg+xml"?e.jsx("img",{className:"rounded img-fluid w-100 h-100",src:`/cloud/${t.file}`,alt:t.name,style:{objectFit:"cover",objectPosition:"center",aspectRatio:5/3}}):e.jsx("i",{className:`mdi ${V(t.file_mimetype)} mdi-36px`})]}),e.jsxs("div",{className:"card-body p-1",children:[e.jsx("small",{className:"d-block text-truncate w-100 my-0",title:t.name,children:e.jsx("b",{children:t.name})}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center",children:[e.jsx("small",{className:"card-text",children:Y(t.file_size)}),!o&&e.jsxs("div",{className:"d-flex gap-1",children:[e.jsxs("div",{className:"dropdown d-inline",children:[e.jsx(N,{content:"Copiar enlace",children:e.jsx("i",{className:"mdi mdi-link cursor-pointer","data-bs-toggle":"dropdown"})}),e.jsxs("ul",{className:"dropdown-menu",children:[e.jsx("li",{children:e.jsxs("a",{className:"dropdown-item",href:"#",onClick:()=>S(t),children:[e.jsx("i",{className:"mdi mdi-link-variant me-1"}),"Copiar enlace"]})}),e.jsx("li",{children:e.jsxs("a",{className:"dropdown-item",href:"#",onClick:()=>S({...t,relative:!0}),children:[e.jsx("i",{className:"mdi mdi-folder-outline me-1"}),"Copiar ruta relativa"]})})]})]}),e.jsx(N,{content:"Cambiar nombre",children:e.jsx("i",{className:"mdi mdi-pencil cursor-pointer",onClick:()=>L(t)})}),e.jsx(N,{content:"Eliminar",children:e.jsx("i",{className:"mdi mdi-delete cursor-pointer text-danger",onClick:()=>z(t.id)})})]})]})]})]},s)})}):e.jsxs("div",{className:"text-center p-5",children:[e.jsx("i",{className:"mdi mdi-folder-multiple-outline mdi-48px mb-2"}),e.jsx("h4",{children:"Arrastra archivos aquí o usa el botón de subir"}),e.jsx("small",{className:"text-muted",children:"Tamaño máximo por archivo: 40MB"})]})})]}),e.jsxs(K,{modalRef:x,title:"Modificar nombre",onSubmit:I,zIndex:1070,children:[e.jsx("input",{ref:g,type:"hidden"}),e.jsx(B,{eRef:R,label:"Nombre anterior",disabled:!0}),e.jsx(B,{eRef:j,label:"Nombre nuevo",required:!0})]})]})},te=({files:i})=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"repository-container",children:e.jsx(ee,{files:i})})});Z((i,r)=>{W(i).render(e.jsx(H,{...r,title:"Repositorio",children:e.jsx(te,{...r})}))});
