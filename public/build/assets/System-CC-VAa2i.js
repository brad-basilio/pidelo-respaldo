var se=Object.defineProperty;var ne=(s,r,n)=>r in s?se(s,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[r]=n;var D=(s,r,n)=>(ne(s,typeof r!="symbol"?r+"":r,n),n);import{j as e}from"./AboutHeader-Bdo2C3ON.js";import{r as o}from"./index-DFv2mRv-.js";import{c as te}from"./ReactAppend-CwiwA4iz.js";import{C as ie}from"./CreateReactScript-D-eDfVKV.js";import{i as W}from"./tippy-react.esm-BVvHiWwH.js";import{m as C}from"./main-BBbUrZUL.js";import{B as re}from"./BasicEditing-Ce9hwHaI.js";import{S as le}from"./SwitchFormGroup-CHRdLToT.js";import{G as Z}from"./Global-mC9lKANG.js";import{S as V}from"./SortByAfterField-BaS5rBg8.js";import{I as Q}from"./InputFormGroup-Di7UVG_e.js";import{M as q}from"./Modal-C9s5p_Ex.js";import{S as I}from"./SelectFormGroup-BrarcXCi.js";import{S as ae}from"./SetSelectValue-UxyCmHse.js";import{a as ce,M as U}from"./MenuItemContainer-xrd2f-pb.js";import{M as oe}from"./Modal-41duzYEO.js";import"./index-DgyC5pTR.js";import"./index.esm-B502ZfUP.js";import"./___vite-browser-external_commonjs-proxy-BQdpDcDf.js";/* empty css               *//* empty css              */class _ extends re{constructor(){super(...arguments);D(this,"path","admin/system");D(this,"savePage",async(n={})=>{try{const{status:i,result:l}=await C.Fetch(`/api/${this.path}/page`,{method:"POST",body:JSON.stringify(n)});if(!i)throw new Error((l==null?void 0:l.message)||"Ocurrio un error inesperado");return l.data??[]}catch(i){return C.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"}),null}});D(this,"updateOrder",async n=>{try{const{status:i,result:l}=await C.Fetch(`/api/${this.path}/order`,{method:"PATCH",body:JSON.stringify(n)});if(!i)throw new Error((l==null?void 0:l.message)??"Ocurrio un error inesperado");return!0}catch(i){C.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"})}});D(this,"deletePage",async n=>{try{const{status:i,result:l}=await C.Fetch(`/api/${this.path}/page/${n}`,{method:"DELETE"});if(!i)throw new Error((l==null?void 0:l.message)||"Ocurrio un error inesperado");return l.data??!0}catch(i){return C.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"}),!1}});D(this,"exportBK",async()=>{try{const{status:n,result:i}=await C.Fetch(`/api/${this.path}/backup`);if(!n)throw new Error((i==null?void 0:i.message)||"Ocurrio un error inesperado");return i}catch(n){return C.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:n.message,type:"danger"}),null}});D(this,"importBK",async n=>{try{const i=await fetch(`/api/${this.path}/backup`,{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(C.Cookies.get("XSRF-TOKEN"))},body:n}),l=JSON.parseable(await i.text());if(!i.ok)throw new Error((l==null?void 0:l.message)||"Ocurrio un error inesperado");return l??!0}catch(i){return C.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"}),null}})}}const J=(s="")=>{s=s.replace(/[^a-zA-Z0-9_{}]/g,"");const r=/{([^}]+)}/g,n=[];let i;for(;(i=r.exec(s))!==null;)n.push(i[1]);return n},me=(s,r)=>{const n=new RegExp(`[${r}]+$`,"g");return s.replace(n,"")},z=new _,ue=s=>{const{id:r,name:n,path:i,extends_base:l=!1,setPages:c,onSEOClicked:m,onParamsClicked:a}=s,[v,u]=o.useState(!1),[g,y]=o.useState(!1),[k,S]=o.useState(!1),h=async j=>{if(n===j.target.value)return u(!1);z.savePage({id:r,name:j.target.value})&&(u(!1),c(f=>f.map(d=>d.id===r?{...d,name:j.target.value}:d)))},b=async j=>{if(i===j.target.value)return y(!1);const w=j.target.value;let f=structuredClone(w);const d=s.using??{model:null,field:null,with:[]};J(w).forEach(p=>{f=f.replace(`{${p}}`,"").replace(`{${p}?}`,""),d[p]=d[p]??{}});const t=me(f,"/");z.savePage({id:r,path:w,pseudo_path:t,using:Object.keys(d).length>0?d:void 0})&&(y(!1),c(p=>p.map(N=>N.id===r?{...N,path:j.target.value}:N)))},E=async j=>{const w=j.target.checked;z.savePage({id:r,extends_base:w})&&(S(!1),c(d=>d.map(t=>t.id===r?{...t,extends_base:w}:t)))},P=async j=>{await z.deletePage(j.id)&&(c(f=>f.filter(d=>d.id!=j.id)),$('[data-bs-toggle="tab"]').removeClass("active"),$(".tab-pane").removeClass("active"),$("#base-template-link").addClass("active"),$("#base-template").addClass("active"))},O=J(i);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dropdown float-end",children:[e.jsx("a",{href:"#",className:"dropdown-toggle arrow-none card-drop","data-bs-toggle":"dropdown","aria-expanded":"false",children:e.jsx("i",{className:"mdi mdi-dots-vertical"})}),e.jsxs("div",{className:"dropdown-menu dropdown-menu-end",children:[e.jsxs("button",{className:"dropdown-item",onClick:()=>m(s),children:[e.jsx("i",{className:"mdi mdi-cloud-search-outline me-1"}),"Editar SEO"]}),O.length>0&&e.jsxs("button",{className:"dropdown-item",onClick:()=>a(s),children:[e.jsx("i",{className:"mdi mdi-code-braces me-1"}),"Parámetros"]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{className:"dropdown-item",onClick:()=>P(s),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar página"]})]})]}),e.jsxs("div",{children:[v?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:n,onBlur:h,autoFocus:!0}):e.jsx(W,{content:"Editar nombre",placement:"left",children:e.jsx("h4",{className:"header-title mb-1 d-block",onClick:()=>u(!0),style:{minWidth:"200px",cursor:"pointer"},children:n||"Sin nombre"})}),g?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:i,style:{minHeight:27,fieldSizing:"content"},onBlur:b,autoFocus:!0}):e.jsx(W,{content:"Editar ruta",placement:"left",children:e.jsx("small",{className:"text-muted d-block mb-1",onClick:()=>y(!0),style:{minWidth:"200px",cursor:"pointer"},children:i||"Sin ruta"})}),e.jsx(le,{label:"Extiende de base",checked:l,onChange:E,disabled:k})]})]})},L=({col:s,label:r,eRef:n,placeholder:i,required:l=!1,rows:c=3,value:m,onChange:a})=>e.jsxs("div",{className:`form-group ${s} mb-2`,children:[e.jsxs("label",{htmlFor:"",children:[r," ",l&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{ref:n,className:"form-control",placeholder:i,required:l,rows:c,defaultValue:m,style:{minHeight:c*27,fieldSizing:"content"},onChange:a})]}),de=new _,he=({dataLoaded:s,setDataLoaded:r,modalRef:n})=>{const i=o.useRef(null),l=o.useRef(null),c=o.useRef(null),m=async a=>{a.preventDefault(),await de.savePage({id:s.id,description:l.current.value,keywords:$(c.current).val()})&&(r(null),$(n.current).modal("hide"))};return o.useEffect(()=>{i.current.value=`${s==null?void 0:s.name} | ${Z.APP_NAME}`,l.current.value=(s==null?void 0:s.description)??"",ae(c.current,(s==null?void 0:s.keywords)??[])},[s]),e.jsx(q,{modalRef:n,title:`Editar SEO - ${s==null?void 0:s.name}`,size:"sm",onSubmit:m,children:e.jsxs("div",{id:"seo-container",children:[e.jsx(Q,{eRef:i,label:"Título",disabled:!0}),e.jsx(L,{eRef:l,label:"Descripción",rows:2}),e.jsx(I,{eRef:c,label:"Palabras clave",tags:!0,multiple:!0,dropdownParent:"#seo-container"})]})})},X=({className:s,system:r,component:n,onComponentClicked:i,onDeleteClicked:l,onEditDataClicked:c})=>{var v;const m=(n==null?void 0:n.options)??[],a=m.find(u=>u.id==r.value);return e.jsxs("div",{className:`dropdown ${s}`,"data-id":r.id,children:[e.jsxs("div",{className:"btn btn-light dropdown-toggle text-truncate w-100 text-start",type:"button",id:`dd-${r.id}`,"data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true",children:[e.jsx("i",{className:"mdi mdi-chevron-down ms-1 float-end"}),e.jsxs("span",{className:"handle-sortable",style:{cursor:"move"},children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"})]}),e.jsx("span",{className:"ms-1",children:r.name})]}),e.jsxs("div",{className:"dropdown-menu","aria-labelledby":`dd-${r.id}`,"data-popper-placement":"bottom-start",children:[m.length>1&&e.jsxs(e.Fragment,{children:[m.filter(u=>u.id!=r.value).map(u=>e.jsxs("button",{className:"dropdown-item",onClick:()=>i({...r,name:`${n.name} - ${u.name}`,value:u.id}),children:[n.name," - ",u.name]})),e.jsx("div",{className:"dropdown-divider"})]}),(((v=a==null?void 0:a.using)==null?void 0:v.filters)||(a==null?void 0:a.data))&&e.jsxs("button",{className:"dropdown-item",onClick:()=>c(r,a),children:[e.jsx("i",{className:"mdi mdi-pencil me-1"}),"Configurar datos"]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>l(r),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar"]})]})]})},pe=new _,fe=({dataLoaded:s,setDataLoaded:r,setSystems:n,modalRef:i})=>{var v,u,g,y,k,S,h,b,E,P,O,j,w;const[l,c]=o.useState((s==null?void 0:s.data)||{}),m={};m.model=o.useRef(null),m.filters=o.useRef(null);const a=async f=>{f.preventDefault();const d=await pe.save({id:s.id,data:l,filters:$(m.filters.current).val()});d&&(r(null),$(i.current).modal("hide"),n(t=>t.map(x=>x.id==s.id?d.data:x)))};return o.useEffect(()=>{var d,t,x;const f={};(d=s==null?void 0:s.component)==null||d.data.forEach(p=>{var N;f[p]=((N=s==null?void 0:s.data)==null?void 0:N[p])??""}),c(f),m.model.current.value=((x=(t=s==null?void 0:s.component)==null?void 0:t.using)==null?void 0:x.model)??"",$(m.filters.current).val((s==null?void 0:s.filters)??[]).trigger("change")},[s]),e.jsxs(q,{modalRef:i,title:s==null?void 0:s.name,onSubmit:a,children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered",children:[e.jsx("li",{className:"nav-item",hidden:!((u=(v=s==null?void 0:s.component)==null?void 0:v.data)!=null&&u.length),children:e.jsx("a",{href:"#tab-info","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link active",children:"Información"})}),e.jsx("li",{className:"nav-item",hidden:!((y=(g=s==null?void 0:s.component)==null?void 0:g.using)!=null&&y.filters),children:e.jsx("a",{href:"#tab-db","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Base de datos"})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"tab-info",hidden:!((S=(k=s==null?void 0:s.component)==null?void 0:k.data)!=null&&S.length),children:(b=(h=s==null?void 0:s.component)==null?void 0:h.data)==null?void 0:b.map((f,d)=>e.jsx(L,{label:f,value:l[f]??"",rows:1,onChange:t=>c({...l,[f]:t.target.value})},d))}),e.jsxs("div",{className:"tab-pane show",id:"tab-db",children:[e.jsx(Q,{eRef:m.model,label:"Modelo",disabled:!0}),e.jsx(I,{eRef:m.filters,label:"Filtros",multiple:!0,dropdownParent:"#tab-db",hidden:!((P=(E=s==null?void 0:s.component)==null?void 0:E.using)!=null&&P.filters),children:(w=(j=(O=s==null?void 0:s.component)==null?void 0:O.using)==null?void 0:j.filters)==null?void 0:w.map((f,d)=>e.jsx("option",{value:f,children:f},d))})]})]})]})},Y=new _,xe=({components:s,onClick:r})=>e.jsx("div",{className:"left-side-menu top-0 pt-2",children:e.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[e.jsx("div",{id:"sidebar-menu",className:"show",children:e.jsxs("ul",{id:"side-menu",children:[e.jsx("li",{className:"menu-title",children:"Lista de componentes"}),s.filter(n=>n.options.length>0).map((n,i)=>e.jsx(ce,{title:n.name,children:n.options.map((l,c)=>e.jsx(U,{name:l.name,icon:l.image,onClick:()=>{const m=$(".tab-pane:visible .components-container > div").last().data("id");r({name:`${n.name} - ${l.name}`,component:n.id,value:l.id,after_component:m})},children:l.name},c))},i)),e.jsx("li",{className:"menu-title",children:"Sistema de respaldo"}),e.jsx(U,{icon:"mdi mdi-cloud-download",onClick:async()=>{const n=await Y.exportBK(),i=new Blob([JSON.stringify(n)],{type:"application/json"}),l=URL.createObjectURL(i),c=document.createElement("a");c.href=l,c.download="backup.json",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(l)},children:"Exportar Backup"}),e.jsx("input",{type:"file",id:"file-input",accept:"application/json",style:{display:"none"},onChange:async n=>{const i=n.target.files[0];if(n.target.value=null,i){const l=new FormData;if(l.append("backup",i),!await Y.importBK(l))return;location.reload()}}}),e.jsx(U,{icon:"mdi mdi-backup-restore",onClick:()=>{document.getElementById("file-input").click()},children:"Importar Backup"})]})}),e.jsx("div",{className:"clearfix"})]})}),be=({page:s,param:r,models:n,setUsing:i})=>{var y,k,S;const l=o.useRef(),c=o.useRef(),m=o.useRef(),[a,v]=o.useState(null),u=h=>{const b=h.target.value,E=n.find(P=>P.name==b)??null;v(E)};o.useEffect(()=>{$(l.current).val(null).trigger("change")},[r]),o.useEffect(()=>{i(h=>({...h,[r]:{...h[r],model:(a==null?void 0:a.name)??null}})),$(c.current).val(null).trigger("change"),$(m.current).val(null).trigger("change")},[a]);const g=`${r}-container`;return e.jsxs("div",{id:g,className:"row",children:[e.jsxs("label",{className:"form-label",children:["Parámetro ",e.jsx("code",{children:r})]}),e.jsx(I,{eRef:l,label:"Modelo",col:"col-md-6",dropdownParent:`#${g}`,onChange:u,children:n.map((h,b)=>e.jsx("option",{children:h.name},b))}),e.jsx(I,{eRef:c,label:"Campo",col:"col-md-6",dropdownParent:`#${g}`,onChange:h=>{i(b=>({...b,[r]:{...b[r],field:h.target.value}}))},children:(y=a==null?void 0:a.fields)==null?void 0:y.map((h,b)=>e.jsx("option",{children:h},b))}),e.jsx("div",{hidden:(((k=a==null?void 0:a.relations)==null?void 0:k.length)??0)==0,children:e.jsx(I,{eRef:m,label:"Relaciones",multiple:!0,dropdownParent:`#${g}`,onChange:h=>{const b=$(h.target).val();i(E=>({...E,[r]:{...E[r],relations:b}}))},children:(S=a==null?void 0:a.relations)==null?void 0:S.map((h,b)=>e.jsx("option",{children:h},b))})})]})},ge=new _,je=({dataLoaded:s,setDataLoaded:r,setPages:n,modalRef:i,models:l})=>{const c=J((s==null?void 0:s.path)??""),[m,a]=o.useState({}),v=async u=>{u.preventDefault();const g=await ge.savePage({id:s.id,using:m});g&&(r(null),n(g),$(i.current).modal("hide"))};return o.useEffect(()=>{a((s==null?void 0:s.using)??{})},[s]),e.jsx(oe,{modalRef:i,title:`Editar parámetros de URL - ${s==null?void 0:s.name}`,onSubmit:v,onClose:()=>r(null),children:c.map((u,g)=>e.jsx(be,{page:s,param:u,models:l,setUsing:a},g))})},G=new _,ve=({systems:s,pages:r,components:n,models:i})=>{const l=o.useRef(null),c=o.useRef(null),m=o.useRef(null),[a,v]=o.useState(s),[u,g]=o.useState(r),[y,k]=o.useState(!1),[S,h]=o.useState(null),[b,E]=o.useState(null),P=async()=>{k(!0);const t=await G.savePage();t&&(k(!1),g(t))},O=async t=>{const p=$(".tab-pane:visible").data("id")??null;t.page_id=p;const N=await G.save(t);if(!N)return;const B=N.data;v(F=>F.some(R=>R.id===B.id)?F.map(R=>R.id===B.id?B:R):[...F,B])},j=async t=>{await G.delete(t.id)&&v(p=>p.filter(N=>N.id!=t.id))};o.useEffect(()=>{document.title=`Sistema | ${Z.APP_NAME}`},[null]),o.useEffect(()=>{const t=$("iframe:visible");t&&($(t).removeAttr("src"),$(t).attr("src",t.data("path")))},[a,u]);const w=async t=>{h(t),$(l.current).modal("show")},f=async t=>{h(t),$(c.current).modal("show")},d=async(t,x)=>{E({...t,component:x}),$(m.current).modal("show")};return o.useEffect(()=>{[...$(".components-container")].forEach(x=>{$(x).sortable({connectWith:".components-container",handle:".handle-sortable",forcePlaceholderSize:!0,update:async function(p,N){const B=[...$(x).children()],F={};if(B.forEach(T=>{const R=$(T).data("id"),M=$(T).prev().data("id")??null,A=a.find(H=>H.id==R);(A==null?void 0:A.after_component)!==M&&(F[R]=M)}),Object.keys(F).length>0){if(!await G.updateOrder(F))return;v(R=>{const M=[...R];return Object.entries(F).forEach(([A,H])=>{const K=M.findIndex(ee=>ee.id==A);K!==-1&&(M[K]={...M[K],after_component:H})}),M})}}}).disableSelection()})},[u,a]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"wrapper",children:[e.jsx(xe,{components:n,onClick:O}),e.jsx("div",{className:"content-page mt-2 pb-3",style:{height:"max-content"},children:e.jsx("div",{className:"content mt-2",children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("button",{className:"button-menu-mobile d-lg-none d-md-block position-absolute ",style:{zIndex:1,border:"none",borderRadius:"0 50% 50% 0",backgroundColor:"#fff",color:"#343a40",top:"50%",left:"0",transform:"translateY(-50%)",padding:"24px 0px 20px 6px ",fontWeight:"bold"},children:"〉"}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card mb-0",children:e.jsxs("div",{className:"card-body",style:{height:"calc(100vh - 48px)"},children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered flex-nowrap",style:{overflowX:"auto",overflowY:"hidden"},children:[e.jsx("li",{className:"nav-item",children:e.jsx("a",{id:"base-template-link",href:"#base-template","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active h-100",children:"Base"})}),u.map((t,x)=>e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:`#page-${t.id}`,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link h-100",style:{whiteSpace:"nowrap"},children:[t.name,e.jsx("small",{className:"d-block text-muted",style:{fontWeight:"normal"},children:t.path})]})},x)),e.jsx("li",{className:"nav-item d-flex justify-content-center align-items-center px-2",children:e.jsx(W,{content:"Agregar página",children:e.jsx("button",{className:"nav-link btn btn-xs btn-white rounded-pill",onClick:P,disabled:y,children:y?e.jsx("i",{className:"mdi mdi-loading mdi-spin"}):e.jsx("i",{className:"mdi mdi-plus"})})})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"base-template",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"d-flex flex-column gap-2",children:V(a).filter(t=>t.page_id==null).map(t=>{const x=n.find(p=>p.id==t.component);if(x==null||x.options,t.component=="content")return e.jsxs("button",{"data-id":t.id,className:"btn btn-light text-truncate w-100 text-start",type:"button",children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("span",{className:"ms-1",children:t.name})]});{const p=n.find(N=>N.id==t.component);return e.jsx(X,{className:"",system:t,component:p,onComponentClicked:O,onDeleteClicked:j,onEditDataClicked:d},t.id)}})})}),e.jsx("div",{className:"col-md-8",children:e.jsx("iframe",{src:"/base-template","data-path":"/base-template",className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 185px)",borderRadius:"4px"}})})]})}),u.map((t,x)=>e.jsx("div",{className:"tab-pane",id:`page-${t.id}`,"data-id":t.id,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx(ue,{...t,models:i,setPages:g,onSEOClicked:w,onParamsClicked:f}),e.jsx("hr",{className:"my-2"}),e.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":t.id,children:V(a).filter(p=>p.page_id==t.id).map(p=>{const N=n.find(B=>B.id==p.component);return e.jsx(X,{className:"",system:p,component:N,onComponentClicked:O,onDeleteClicked:j,onEditDataClicked:d},p.id)})})]}),e.jsx("div",{className:"col-md-8",children:e.jsx("iframe",{src:(t==null?void 0:t.pseudo_path)||t.path,"data-path":(t==null?void 0:t.pseudo_path)||t.path,className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 185px)",borderRadius:"4px"}})})]})},x))]})]})})})})]})})})]}),e.jsx(he,{dataLoaded:S,setDataLoaded:h,modalRef:l}),e.jsx(je,{dataLoaded:S,setDataLoaded:h,setPages:g,modalRef:c,models:i}),e.jsx(fe,{dataLoaded:b,setDataLoaded:E,setSystems:v,modalRef:m})]})};ie((s,r)=>{te(s).render(e.jsx(ve,{...r}))});
